import{d as ie,c as oe,r as n,j as e,U as de,B as x,P as ce,t,b as J}from"./index-DbvXYXc0.js";import{c as me,a as ue,v as he}from"./countries-MbDrB5Lp.js";import{I as u}from"./input-Bf8YvsU0.js";import{L as i}from"./label-DMFTECDG.js";import{C as pe,b as ge,c as xe,d as fe,a as ye}from"./card-6tZ6FSP9.js";import{T as je,a as ve,b as z,c as W}from"./tabs-C3_ONro2.js";import{S as be,a as we,b as Ne,d as Ce,e as V}from"./select-895Ag1Vf.js";import{m as ke}from"./proxy-Rx_HuwO6.js";import{S as Se}from"./shield-Bm-1xR-G.js";import{L as Pe}from"./lock-zaoQmYbf.js";import{A as _e}from"./arrow-right-Deh_fvqM.js";import{R as T}from"./refresh-cw-BkItMj0z.js";import"./index-UZKPKpE4.js";import"./index-B1ZSOLeI.js";import"./index-CB20-cGd.js";import"./index-9AnY3iUi.js";import"./index-DE3TGyh9.js";import"./Combination-B6rQ859v.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";import"./use-presence-CB-MpOZZ.js";const Te=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Oe=ie("user-plus",Te),Re=f=>f.replace(/\D/g,""),Ie=({countries:f,iso2:O,setIso2:R,phone:r,setPhone:o,disabledPhone:p})=>e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("select",{value:O,onChange:d=>R(d.target.value),className:"w-[100px] sm:w-[120px] shrink-0 bg-white dark:bg-gray-800 text-gray-900 dark:text-white p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-[#008C95] focus:border-transparent",disabled:p,children:f.map(d=>e.jsxs("option",{value:d.iso2,children:[d.iso2," (",d.dialCode,")"]},d.iso2))}),e.jsx("input",{type:"tel",inputMode:"numeric",value:r,onChange:d=>o(Re(d.target.value)),placeholder:"70123456",className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-white bg-white dark:bg-gray-800 text-sm focus:ring-2 focus:ring-[#008C95] focus:border-transparent",disabled:p})]}),l={darkBlue:"#0E4C81",teal:"#008C95",limeGreen:"#8AC640"};function ts(){const f=oe(),[O,R]=n.useState("login"),[r,o]=n.useState(!1),[p,d]=n.useState(""),[I,K]=n.useState(""),[j,$]=n.useState(""),[w,Q]=n.useState("LB"),[L,A]=n.useState(!1),[v,B]=n.useState(""),[X,F]=n.useState(!1),[U,N]=n.useState(!1),[C,k]=n.useState(0),[c,h]=n.useState({username:"",email:"",first_name:"",last_name:"",password:"",password_confirmation:"",role:"admin",business_type:""}),q=n.useMemo(()=>me.map(a=>({name:a.name,iso2:a.iso2,dialCode:a.dialCode.startsWith("+")?a.dialCode:`+${a.dialCode}`})).sort((a,s)=>a.name.localeCompare(s.name)),[]),Y=n.useMemo(()=>{const a=new Map;for(const s of q)a.set(s.iso2,s.dialCode);return a},[q]),E=a=>Y.get(a)||"+961";n.useEffect(()=>{let a;return C>0&&(a=setInterval(()=>{k(s=>s<=1?(N(!0),0):s-1)},1e3)),()=>clearInterval(a)},[C]);const Z=()=>{$(""),A(!1),B(""),F(!1),N(!1),k(0),h({username:"",email:"",first_name:"",last_name:"",password:"",password_confirmation:"",role:"admin",business_type:""})},ee=()=>{A(!1),B(""),F(!1),N(!1),k(0),$("")},H=async()=>{if(!j)return t.error("Please enter a phone number.");const a=`${E(w)}${j.replace(/^0+/,"")}`;if(!/^\+\d{8,15}$/.test(a))return t.error("Please enter a valid phone number with country code.");try{o(!0);const s=await ue(a);s.message&&t.success(s.message),s.warning&&t.warning(s.warning),A(!0),N(!1),k(60)}catch(s){s.response?.data?.errors?Object.values(s.response.data.errors).flat().forEach(m=>t.error(m)):t.error(s.response?.data?.message||"Failed to send OTP.")}finally{o(!1)}},se=async()=>{U&&await H()},ae=async()=>{if(!v)return t.error("Please enter the OTP code.");if(v.length!==6)return t.error("OTP code must be 6 digits.");const a=`${E(w)}${j.replace(/^0+/,"")}`;try{o(!0);const s=await he(a,v);s.message?t.success(s.message):t.success("OTP verified! Complete your registration."),F(!0)}catch(s){t.error(s.response?.data?.message||s.response?.data?.error||"Invalid or expired OTP.")}finally{o(!1)}},re=async a=>{if(a.preventDefault(),!p||!I)return t.error("Please fill all fields");try{o(!0);let s={password:I};p.includes("@")?s.email=p:s.phone_number=p;const m=await J.post("/auth/login",s),b=m.data.user;if(b.role!=="admin"){t.error("Access denied. Admin privileges required."),localStorage.removeItem("authToken"),localStorage.removeItem("token"),localStorage.removeItem("user");return}localStorage.setItem("authToken",m.data.token),localStorage.setItem("token",m.data.token),localStorage.setItem("user",JSON.stringify(b)),t.success("Login successful!"),f("/admin")}catch(s){const m=s.response?.data?.message||s.response?.data?.error||"Login failed.";t.error(m)}finally{o(!1)}},te=async a=>{a.preventDefault();const{username:s,email:m,first_name:b,last_name:G,password:S,password_confirmation:D,role:P,business_type:M}=c;if(!s?.trim()||!b?.trim()||!G?.trim()||!S||!D)return t.error("Please fill all required fields");if(P==="agency"&&!M?.trim())return t.error("Business type is required for agency");if(S.length<6)return t.error("Password must be at least 6 characters");if(S!==D)return t.error("Passwords do not match");const ne=`${E(w)}${j.replace(/^0+/,"")}`.replace(/^\+/,"");try{o(!0);const g={phone_number:ne,otp_code:v,username:s.trim(),first_name:b.trim(),last_name:G.trim(),password:S,password_confirmation:D,role:P||"admin"};m?.trim()&&(g.email=m.trim()),P==="agency"&&M?.trim()&&(g.business_type=M.trim());const y=await J.post("/auth/register",g),_=y.data?.user,le=_?.role||P||"admin";localStorage.setItem("authToken",y.data.token),localStorage.setItem("token",y.data.token),localStorage.setItem("user",JSON.stringify(_||y.data.user)),t.success("Account created!"),f(le==="admin"?"/admin":"/Complete-Profile")}catch(g){const y=g.response?.data?.message||g.response?.data?.error||"Registration failed.";g.response?.data?.errors?Object.values(g.response.data.errors).flat().forEach(_=>t.error(_)):t.error(y)}finally{o(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-900 flex items-center justify-center p-4",children:e.jsx(ke.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:e.jsxs(pe,{className:"border-0 shadow-2xl",children:[e.jsxs(ge,{className:"text-center space-y-4 pb-8",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center",style:{background:`linear-gradient(to right, ${l.darkBlue}, ${l.teal})`},children:e.jsx(Se,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{children:[e.jsx(xe,{className:"text-2xl font-bold bg-clip-text text-transparent",style:{backgroundImage:`linear-gradient(to right, ${l.darkBlue}, ${l.teal}, ${l.limeGreen})`},children:"Admin Login"}),e.jsx(fe,{className:"mt-2",children:"Sign in to access the admin dashboard"})]})]}),e.jsxs(ye,{children:[e.jsxs(je,{value:O,onValueChange:R,children:[e.jsxs(ve,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(z,{value:"login",children:"Login"}),e.jsx(z,{value:"register",children:"Register"})]}),e.jsx(W,{value:"login",children:e.jsxs("form",{onSubmit:re,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Email or Phone"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(u,{id:"email",type:"text",placeholder:"admin@example.com or +96170123456",value:p,onChange:a=>d(a.target.value),className:"pl-10",disabled:r,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(u,{id:"password",type:"password",placeholder:"Enter your password",value:I,onChange:a=>K(a.target.value),className:"pl-10",disabled:r,required:!0})]})]}),e.jsx(x,{type:"submit",className:"w-full text-white",style:{background:`linear-gradient(to right, ${l.darkBlue}, ${l.teal})`},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:["Sign In",e.jsx(_e,{className:"w-4 h-4 ml-2"})]})})]})}),e.jsx(W,{value:"register",children:X?e.jsxs("form",{onSubmit:te,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Username *"}),e.jsx(u,{value:c.username,onChange:a=>h(s=>({...s,username:a.target.value})),placeholder:"admin_username",disabled:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Email"}),e.jsx(u,{type:"email",value:c.email,onChange:a=>h(s=>({...s,email:a.target.value})),placeholder:"admin@example.com",disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Role *"}),e.jsxs(be,{value:c.role||"admin",onValueChange:a=>h(s=>({...s,role:a})),children:[e.jsx(we,{children:e.jsx(Ne,{placeholder:"Select role"})}),e.jsxs(Ce,{children:[e.jsx(V,{value:"client",children:"Client"}),e.jsx(V,{value:"agency",children:"Agency"}),e.jsx(V,{value:"admin",children:"Admin"})]})]})]}),c.role==="agency"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Business Type *"}),e.jsx(u,{value:c.business_type,onChange:a=>h(s=>({...s,business_type:a.target.value})),placeholder:"e.g. Car Rental Agency",disabled:r})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"First Name *"}),e.jsx(u,{value:c.first_name,onChange:a=>h(s=>({...s,first_name:a.target.value})),placeholder:"First",disabled:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Last Name *"}),e.jsx(u,{value:c.last_name,onChange:a=>h(s=>({...s,last_name:a.target.value})),placeholder:"Last",disabled:r,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Password *"}),e.jsx(u,{type:"password",value:c.password,onChange:a=>h(s=>({...s,password:a.target.value})),placeholder:"Min 6 characters",disabled:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Confirm Password *"}),e.jsx(u,{type:"password",value:c.password_confirmation,onChange:a=>h(s=>({...s,password_confirmation:a.target.value})),placeholder:"Repeat password",disabled:r,required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:Z,disabled:r,children:"Back"}),e.jsx(x,{type:"submit",className:"flex-1 text-white",style:{background:`linear-gradient(to right, ${l.darkBlue}, ${l.teal})`},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Create Admin Account"]})})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Phone Number"]}),e.jsx(Ie,{countries:q,iso2:w,setIso2:Q,phone:j,setPhone:$,disabledPhone:L})]}),L&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"OTP Code"}),e.jsx(u,{type:"text",inputMode:"numeric",value:v,onChange:a=>{const s=a.target.value.replace(/\D/g,"");s.length<=6&&B(s)},placeholder:"Enter 6-digit OTP",maxLength:6,className:"text-center text-xl font-bold tracking-widest"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:"Check your phone"}),C>0?e.jsxs("span",{children:["Resend in ",C,"s"]}):e.jsxs(x,{type:"button",variant:"link",size:"sm",className:"h-auto p-0 text-xs",onClick:se,disabled:!U||r,children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Resend OTP"]})]})]}),e.jsx("div",{className:"flex gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:ee,disabled:r,children:"Change"}),e.jsx(x,{type:"button",onClick:ae,className:"flex-1 text-white",style:{background:`linear-gradient(to right, ${l.darkBlue}, ${l.teal})`},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Verifying..."]}):"Verify OTP"})]}):e.jsx(x,{type:"button",onClick:H,className:"w-full text-white",style:{background:`linear-gradient(to right, ${l.darkBlue}, ${l.teal})`},disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send OTP"})})]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx(x,{variant:"ghost",onClick:()=>f("/"),className:"text-sm text-gray-600 dark:text-gray-400",children:"‚Üê Back to Home"})})]})]})})})}export{ts as default};
