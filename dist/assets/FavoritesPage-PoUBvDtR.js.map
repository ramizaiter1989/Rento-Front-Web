{"version":3,"file":"FavoritesPage-PoUBvDtR.js","sources":["../../src/pages/FavoritesPage.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { CarCard } from '@/components/CarCard';\nimport { Heart, ArrowRight, RefreshCw, ChevronLeft, ChevronRight } from 'lucide-react';\nimport api from '@/lib/axios';\nimport { toast } from 'sonner';\n\nexport const FavoritesPage = () => {\n  const [favorites, setFavorites] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  const [page, setPage] = useState(1);\n  const [pagination, setPagination] = useState({\n    current_page: 1,\n    last_page: 1,\n    per_page: 20,\n    total: 0,\n    next_page_url: null,\n    prev_page_url: null\n  });\n\n  const mapCar = (carData) => {\n    const feedbacks = carData.feedbacks ?? [];\n    const rating =\n      feedbacks.length > 0\n        ? (\n            feedbacks.reduce((sum, f) => sum + (Number(f.rating) || 0), 0) / feedbacks.length\n          ).toFixed(1)\n        : null;\n\n    return {\n      id: carData.id,\n\n      // naming compatibility\n      make: carData.make,\n      brand: carData.make,\n      model: carData.model,\n      year: carData.year,\n      type: carData.car_category,\n      category: carData.car_category,\n\n      seats: carData.seats,\n      doors: carData.doors,\n      transmission: carData.transmission,\n\n      // keep BOTH because your UI sometimes uses fuel_type\n      fuelType: carData.fuel_type,\n      fuel_type: carData.fuel_type,\n\n      drive: carData.wheels_drive,\n      cylinders: carData.cylinder_number,\n      mileage: carData.mileage,\n      color: carData.color,\n\n      dailyRate: Number(carData.daily_rate),\n      holidayRate: Number(carData.holiday_rate),\n      price: Number(carData.daily_rate),\n\n      hasDeposit: !!carData.is_deposit,\n      deposit: Number(carData.deposit),\n\n      maxMileage: carData.max_driving_mileage,\n      minDays: carData.min_rental_days,\n\n      withDriver: !!carData.with_driver,\n      driverFees: Number(carData.driver_fees),\n\n      location: carData.live_location?.address ?? 'N/A',\n\n      isDelivered: !!carData.is_delivered,\n      deliveryFees: Number(carData.delivery_fees),\n\n      description: carData.notes ?? '',\n      features: carData.features ?? [],\n      addons: carData.car_add_on ?? [],\n\n      rating,\n      reviews: feedbacks.length,\n      feedbacks,\n\n      images: [\n        carData.main_image_url,\n        carData.front_image_url,\n        carData.back_image_url,\n        carData.left_image_url,\n        carData.right_image_url\n      ].filter(Boolean),\n\n      image: carData.main_image_url || carData.front_image_url || ''\n    };\n  };\n\n  const fetchFavorites = useCallback(async (pageToLoad = 1) => {\n    setLoading(true);\n    try {\n      const res = await api.get('/cars/favorites/list', { params: { page: pageToLoad } });\n      const fav = res.data?.favorites;\n\n      const cars = (fav?.data ?? []).map(mapCar);\n\n      setFavorites(cars);\n      setPagination({\n        current_page: fav?.current_page ?? pageToLoad,\n        last_page: fav?.last_page ?? 1,\n        per_page: fav?.per_page ?? 20,\n        total: fav?.total ?? cars.length,\n        next_page_url: fav?.next_page_url ?? null,\n        prev_page_url: fav?.prev_page_url ?? null\n      });\n      setPage(fav?.current_page ?? pageToLoad);\n    } catch (err) {\n      console.error('Favorites fetch error:', err);\n      toast.error('Failed to load favorites. Please try again.');\n      setFavorites([]);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  // âœ… API remove/toggle favorite (used by CarCard heart)\n  const toggleFavorite = useCallback(\n    async (carId) => {\n      // Optimistic remove (we are in Favorites page)\n      const prev = favorites;\n      setFavorites((cur) => cur.filter((c) => c.id !== carId));\n\n      try {\n        await api.post(`/cars/${carId}/favorite`);\n        toast.success('Removed from favorites');\n        window.dispatchEvent(new Event('favoritesUpdated'));\n        // refetch current page to keep pagination correct\n        fetchFavorites(page);\n      } catch (err) {\n        console.error('Toggle favorite error:', err);\n        toast.error('Failed to update favorite. Please try again.');\n        setFavorites(prev); // rollback\n      }\n    },\n    [favorites, fetchFavorites, page]\n  );\n\n  useEffect(() => {\n    fetchFavorites(1);\n\n    const onFavUpdated = () => fetchFavorites(page);\n    window.addEventListener('favoritesUpdated', onFavUpdated);\n\n    return () => window.removeEventListener('favoritesUpdated', onFavUpdated);\n  }, [fetchFavorites, page]);\n\n  const countText = useMemo(() => {\n    if (loading) return 'Loading your favorites...';\n    if (pagination.total === 0) return 'No favorites yet. Start exploring our fleet!';\n    return `You have ${pagination.total} vehicle${pagination.total > 1 ? 's' : ''} in your favorites`;\n  }, [loading, pagination.total]);\n\n  const canPrev = pagination.prev_page_url && page > 1;\n  const canNext = pagination.next_page_url && page < pagination.last_page;\n\n  return (\n    <div className=\"min-h-screen pt-20\">\n      {/* Header */}\n      <section className=\"bg-gradient-to-br from-accent/5 via-secondary/5 to-primary/5 py-12\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"max-w-3xl\">\n            <div className=\"flex items-center gap-3 flex-wrap\">\n              <Badge className=\"mb-2 bg-accent/10 text-accent-foreground border-accent/20\">\n                <Heart className=\"w-3 h-3 mr-1 fill-current\" />\n                Favorites\n              </Badge>\n\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => fetchFavorites(page)}\n                disabled={loading}\n                aria-label=\"Refresh favorites\"\n                className=\"mb-2\"\n              >\n                <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\n                Refresh\n              </Button>\n            </div>\n\n            <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">Your Favorite Vehicles</h1>\n            <p className=\"text-lg text-muted-foreground\">{countText}</p>\n\n            {!loading && pagination.total > 0 && (\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                Page {pagination.current_page} of {pagination.last_page}\n              </p>\n            )}\n          </div>\n        </div>\n      </section>\n\n      <div className=\"container mx-auto px-4 py-12\">\n        {loading ? (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6\">\n            {Array.from({ length: 6 }).map((_, i) => (\n              <Card key={i} className=\"p-6\">\n                <div className=\"h-40 rounded-xl bg-muted animate-pulse mb-4\" />\n                <div className=\"h-4 bg-muted rounded animate-pulse w-2/3 mb-2\" />\n                <div className=\"h-4 bg-muted rounded animate-pulse w-1/2\" />\n              </Card>\n            ))}\n          </div>\n        ) : favorites.length > 0 ? (\n          <>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6\">\n              {favorites.map((car) => (\n                <CarCard\n                  key={car.id}\n                  car={car}\n                  forceFavorite\n                  onToggleFavoriteApi={() => toggleFavorite(car.id)}\n                />\n              ))}\n            </div>\n\n            {/* Pagination */}\n            {(pagination.last_page ?? 1) > 1 && (\n              <div className=\"flex items-center justify-center gap-3 mt-10\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => fetchFavorites(page - 1)}\n                  disabled={!canPrev || loading}\n                  aria-label=\"Previous page\"\n                >\n                  <ChevronLeft className=\"w-4 h-4 mr-2\" />\n                  Prev\n                </Button>\n\n                <span className=\"text-sm text-muted-foreground\">\n                  Page <span className=\"font-semibold\">{pagination.current_page}</span> /{' '}\n                  <span className=\"font-semibold\">{pagination.last_page}</span>\n                </span>\n\n                <Button\n                  variant=\"outline\"\n                  onClick={() => fetchFavorites(page + 1)}\n                  disabled={!canNext || loading}\n                  aria-label=\"Next page\"\n                >\n                  Next\n                  <ChevronRight className=\"w-4 h-4 ml-2\" />\n                </Button>\n              </div>\n            )}\n          </>\n        ) : (\n          <Card className=\"p-12 text-center max-w-2xl mx-auto\">\n            <div className=\"w-24 h-24 rounded-full bg-muted mx-auto mb-6 flex items-center justify-center\">\n              <Heart className=\"w-12 h-12 text-muted-foreground\" />\n            </div>\n            <h2 className=\"text-3xl font-bold mb-4\">No Favorites Yet</h2>\n            <p className=\"text-muted-foreground mb-8 max-w-md mx-auto\">\n              Start adding vehicles to your favorites to keep track of the cars you love.\n              Click the heart icon on any vehicle card to add it here.\n            </p>\n            <Link to=\"/cars\">\n              <Button size=\"lg\" className=\"bg-primary hover:bg-primary-light text-primary-foreground\">\n                Browse Our Fleet\n                <ArrowRight className=\"w-5 h-5 ml-2\" />\n              </Button>\n            </Link>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n};\n"],"names":["FavoritesPage","favorites","setFavorites","useState","loading","setLoading","page","setPage","pagination","setPagination","mapCar","carData","feedbacks","rating","sum","f","fetchFavorites","useCallback","pageToLoad","fav","api","cars","err","toast","toggleFavorite","carId","prev","cur","c","useEffect","onFavUpdated","countText","useMemo","canPrev","canNext","jsxs","jsx","Badge","Heart","Button","RefreshCw","_","Card","Fragment","car","CarCard","ChevronLeft","ChevronRight","Link","ArrowRight"],"mappings":"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"}