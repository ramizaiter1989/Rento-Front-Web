import{r as n,b as x,t as u,j as s,H as v,B as g,L as C}from"./index-DbvXYXc0.js";import{C as f}from"./card-6tZ6FSP9.js";import{B as k}from"./badge-De3gxj8m.js";import{C as P}from"./CarCard-DeNaLndm.js";import{R}from"./refresh-cw-BkItMj0z.js";import{C as E}from"./chevron-left-DlVhwfSE.js";import{C as B}from"./chevron-right-DaEW3pZI.js";import{A as S}from"./arrow-right-Deh_fvqM.js";import"./star-BJn2oNt2.js";import"./users-E8rCSFRH.js";import"./settings-C8YQ_pBF.js";import"./fuel-CAXBRakv.js";import"./message-square-LR42VQJg.js";import"./eye--wIqRW1l.js";const K=()=>{const[m,c]=n.useState([]),[o,p]=n.useState(!0),[a,h]=n.useState(1),[t,_]=n.useState({current_page:1,last_page:1,per_page:20,total:0,next_page_url:null,prev_page_url:null}),N=e=>{const i=e.feedbacks??[],r=i.length>0?(i.reduce((d,F)=>d+(Number(F.rating)||0),0)/i.length).toFixed(1):null;return{id:e.id,make:e.make,brand:e.make,model:e.model,year:e.year,type:e.car_category,category:e.car_category,seats:e.seats,doors:e.doors,transmission:e.transmission,fuelType:e.fuel_type,fuel_type:e.fuel_type,drive:e.wheels_drive,cylinders:e.cylinder_number,mileage:e.mileage,color:e.color,dailyRate:Number(e.daily_rate),holidayRate:Number(e.holiday_rate),price:Number(e.daily_rate),hasDeposit:!!e.is_deposit,deposit:Number(e.deposit),maxMileage:e.max_driving_mileage,minDays:e.min_rental_days,withDriver:!!e.with_driver,driverFees:Number(e.driver_fees),location:e.live_location?.address??"N/A",isDelivered:!!e.is_delivered,deliveryFees:Number(e.delivery_fees),description:e.notes??"",features:e.features??[],addons:e.car_add_on??[],rating:r,reviews:i.length,feedbacks:i,images:[e.main_image_url,e.front_image_url,e.back_image_url,e.left_image_url,e.right_image_url].filter(Boolean),image:e.main_image_url||e.front_image_url||""}},l=n.useCallback(async(e=1)=>{p(!0);try{const r=(await x.get("/cars/favorites/list",{params:{page:e}})).data?.favorites,d=(r?.data??[]).map(N);c(d),_({current_page:r?.current_page??e,last_page:r?.last_page??1,per_page:r?.per_page??20,total:r?.total??d.length,next_page_url:r?.next_page_url??null,prev_page_url:r?.prev_page_url??null}),h(r?.current_page??e)}catch(i){console.error("Favorites fetch error:",i),u.error("Failed to load favorites. Please try again."),c([])}finally{p(!1)}},[]),y=n.useCallback(async e=>{const i=m;c(r=>r.filter(d=>d.id!==e));try{await x.post(`/cars/${e}/favorite`),u.success("Removed from favorites"),window.dispatchEvent(new Event("favoritesUpdated")),l(a)}catch(r){console.error("Toggle favorite error:",r),u.error("Failed to update favorite. Please try again."),c(i)}},[m,l,a]);n.useEffect(()=>{l(1);const e=()=>l(a);return window.addEventListener("favoritesUpdated",e),()=>window.removeEventListener("favoritesUpdated",e)},[l,a]);const b=n.useMemo(()=>o?"Loading your favorites...":t.total===0?"No favorites yet. Start exploring our fleet!":`You have ${t.total} vehicle${t.total>1?"s":""} in your favorites`,[o,t.total]),j=t.prev_page_url&&a>1,w=t.next_page_url&&a<t.last_page;return s.jsxs("div",{className:"min-h-screen pt-20",children:[s.jsx("section",{className:"bg-gradient-to-br from-accent/5 via-secondary/5 to-primary/5 py-12",children:s.jsx("div",{className:"container mx-auto px-4",children:s.jsxs("div",{className:"max-w-3xl",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s.jsxs(k,{className:"mb-2 bg-accent/10 text-accent-foreground border-accent/20",children:[s.jsx(v,{className:"w-3 h-3 mr-1 fill-current"}),"Favorites"]}),s.jsxs(g,{variant:"outline",size:"sm",onClick:()=>l(a),disabled:o,"aria-label":"Refresh favorites",className:"mb-2",children:[s.jsx(R,{className:`w-4 h-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]}),s.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Your Favorite Vehicles"}),s.jsx("p",{className:"text-lg text-muted-foreground",children:b}),!o&&t.total>0&&s.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Page ",t.current_page," of ",t.last_page]})]})})}),s.jsx("div",{className:"container mx-auto px-4 py-12",children:o?s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:Array.from({length:6}).map((e,i)=>s.jsxs(f,{className:"p-6",children:[s.jsx("div",{className:"h-40 rounded-xl bg-muted animate-pulse mb-4"}),s.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-2/3 mb-2"}),s.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-1/2"})]},i))}):m.length>0?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:m.map(e=>s.jsx(P,{car:e,forceFavorite:!0,onToggleFavoriteApi:()=>y(e.id)},e.id))}),(t.last_page??1)>1&&s.jsxs("div",{className:"flex items-center justify-center gap-3 mt-10",children:[s.jsxs(g,{variant:"outline",onClick:()=>l(a-1),disabled:!j||o,"aria-label":"Previous page",children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),"Prev"]}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",s.jsx("span",{className:"font-semibold",children:t.current_page})," /"," ",s.jsx("span",{className:"font-semibold",children:t.last_page})]}),s.jsxs(g,{variant:"outline",onClick:()=>l(a+1),disabled:!w||o,"aria-label":"Next page",children:["Next",s.jsx(B,{className:"w-4 h-4 ml-2"})]})]})]}):s.jsxs(f,{className:"p-12 text-center max-w-2xl mx-auto",children:[s.jsx("div",{className:"w-24 h-24 rounded-full bg-muted mx-auto mb-6 flex items-center justify-center",children:s.jsx(v,{className:"w-12 h-12 text-muted-foreground"})}),s.jsx("h2",{className:"text-3xl font-bold mb-4",children:"No Favorites Yet"}),s.jsx("p",{className:"text-muted-foreground mb-8 max-w-md mx-auto",children:"Start adding vehicles to your favorites to keep track of the cars you love. Click the heart icon on any vehicle card to add it here."}),s.jsx(C,{to:"/cars",children:s.jsxs(g,{size:"lg",className:"bg-primary hover:bg-primary-light text-primary-foreground",children:["Browse Our Fleet",s.jsx(S,{className:"w-5 h-5 ml-2"})]})})]})})]})};export{K as FavoritesPage};
