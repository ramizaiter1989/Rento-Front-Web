{"version":3,"file":"CompleteProfilePage-B2zfj1E8.js","sources":["../../src/pages/CompleteProfilePage.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport api from \"@/lib/axios\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  CardTitle,\r\n  CardDescription,\r\n} from \"@/components/ui/card\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Car, AlertCircle, MapPin, Navigation, Search } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Lebanese regions for agency address dropdown (label -> form value)\r\nconst ADDRESS_OPTIONS = [\r\n  { label: \"Beirut\", value: \"beirut\" },\r\n  { label: \"Mount Lebanon\", value: \"mount-liban\" },\r\n  { label: \"North\", value: \"north\" },\r\n  { label: \"South\", value: \"south\" },\r\n  { label: \"Bekaa\", value: \"bekaa\" },\r\n  { label: \"Baalbek\", value: \"baalbek\" },\r\n  { label: \"Keserwan\", value: \"keserwan\" },\r\n  { label: \"Nabatieh\", value: \"nabatieh\" },\r\n  { label: \"Akkar\", value: \"akkar\" },\r\n];\r\n\r\nfunction parseGoogleMapsLink(url) {\r\n  if (!url || typeof url !== \"string\") return null;\r\n  const trimmed = url.trim();\r\n  const atMatch = trimmed.match(/@(-?\\d+\\.?\\d*),(-?\\d+\\.?\\d*)/);\r\n  if (atMatch) return { lat: parseFloat(atMatch[1]), lng: parseFloat(atMatch[2]) };\r\n  const qMatch = trimmed.match(/[?&]q=(-?\\d+\\.?\\d*),(-?\\d+\\.?\\d*)/);\r\n  if (qMatch) return { lat: parseFloat(qMatch[1]), lng: parseFloat(qMatch[2]) };\r\n  const llMatch = trimmed.match(/(?:!3d|!4d|!1d)(-?\\d+\\.?\\d*)/g);\r\n  if (llMatch && llMatch.length >= 2) {\r\n    const lat = parseFloat(String(llMatch[0]).replace(/\\D/g, \"\"));\r\n    const lng = parseFloat(String(llMatch[1]).replace(/\\D/g, \"\"));\r\n    if (!isNaN(lat) && !isNaN(lng)) return { lat, lng };\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default function CompleteProfilePage() {\r\n  const navigate = useNavigate();\r\n\r\n  // =========================\r\n  // DEBUG HELPERS\r\n  // =========================\r\n  const DEBUG = true;\r\n\r\n  const debugId = useMemo(() => {\r\n    return `cp_${Date.now()}_${Math.random().toString(16).slice(2)}`;\r\n  }, []);\r\n\r\n  const log = (...args) => {\r\n    if (!DEBUG) return;\r\n    console.log(`[CompleteProfile ${debugId}]`, ...args);\r\n  };\r\n\r\n  const logAxiosBase = () => {\r\n    try {\r\n      log(\"axios.baseURL =\", api?.defaults?.baseURL);\r\n      log(\"axios.withCredentials =\", api?.defaults?.withCredentials);\r\n      log(\r\n        \"axios.headers.Authorization =\",\r\n        api?.defaults?.headers?.common?.Authorization\r\n      );\r\n    } catch (e) {\r\n      log(\"Failed to read axios defaults\", e);\r\n    }\r\n  };\r\n\r\n  const dumpFormData = (fd) => {\r\n    try {\r\n      const entries = [];\r\n      for (const [k, v] of fd.entries()) {\r\n        if (v instanceof File) {\r\n          entries.push({\r\n            key: k,\r\n            type: \"File\",\r\n            name: v.name,\r\n            size: v.size,\r\n            mime: v.type,\r\n          });\r\n        } else {\r\n          entries.push({ key: k, type: typeof v, value: v });\r\n        }\r\n      }\r\n      log(\"FormData entries =>\", entries);\r\n      return entries;\r\n    } catch (e) {\r\n      log(\"Failed to dump FormData\", e);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // =========================\r\n  // STATE\r\n  // =========================\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [profileStatus, setProfileStatus] = useState(null);\r\n\r\n  const [form, setForm] = useState({\r\n    first_name: \"\",\r\n    last_name: \"\",\r\n    gender: \"\",\r\n    birth_date: \"\",\r\n    city: \"\",\r\n    bio: \"\",\r\n    profile_picture: null,\r\n    id_card_front: null,\r\n    id_card_back: null,\r\n\r\n    // Client-specific\r\n    license_number: \"\",\r\n    driver_license: null,\r\n    profession: \"\",\r\n    avg_salary: \"\",\r\n    promo_code: \"\",\r\n\r\n    // Agency-specific\r\n    business_type: \"\",\r\n    company_number: \"\",\r\n    business_doc: null,\r\n    location: \"\",\r\n    app_fees: \"\",\r\n    contract_form: \"\",\r\n    policies: \"\",\r\n    website: \"\",\r\n  });\r\n\r\n  const [showCompanyFields, setShowCompanyFields] = useState(false);\r\n  const [showMapModal, setShowMapModal] = useState(false);\r\n  const [selectedLocation, setSelectedLocation] = useState(null);\r\n  const [mapCenter, setMapCenter] = useState({ lat: 33.8547, lng: 35.8623 }); // Default: Beirut\r\n  const [googleLinkInput, setGoogleLinkInput] = useState(\"\");\r\n  const [locationSearchQuery, setLocationSearchQuery] = useState(\"\");\r\n  const [locationSearchLoading, setLocationSearchLoading] = useState(false);\r\n  const [mapSearchQuery, setMapSearchQuery] = useState(\"\");\r\n  const [mapSearchLoading, setMapSearchLoading] = useState(false);\r\n\r\n  const isClient = user?.role === \"client\";\r\n  const isAgency = user?.role === \"agency\" || user?.role === \"agency\";\r\n\r\n  const normalizeDate = (d) => {\r\n    if (!d) return \"\";\r\n    return String(d).slice(0, 10);\r\n  };\r\n\r\n  const prefillFromStatus = (status) => {\r\n    const u = status?.user || {};\r\n    const c = status?.client || u?.client || {};\r\n    const a = status?.agency || u?.agency || status?.agency || {};\r\n\r\n    setForm((prev) => ({\r\n      ...prev,\r\n      first_name: u.first_name ?? prev.first_name ?? \"\",\r\n      last_name: u.last_name ?? prev.last_name ?? \"\",\r\n      gender: u.gender ?? prev.gender ?? \"\",\r\n      birth_date: normalizeDate(u.birth_date) || prev.birth_date || \"\",\r\n      city: u.city ?? prev.city ?? \"\",\r\n      bio: u.bio ?? prev.bio ?? \"\",\r\n\r\n      // Client fields (prefill)\r\n      license_number: c.license_number ?? prev.license_number ?? \"\",\r\n      profession: c.profession ?? prev.profession ?? \"\",\r\n      avg_salary: c.avg_salary ?? prev.avg_salary ?? \"\",\r\n      promo_code: c.promo_code ?? prev.promo_code ?? \"\",\r\n\r\n      // Agency fields (prefill)\r\n      business_type: a.business_type ?? prev.business_type ?? \"\",\r\n      company_number: a.company_number ?? prev.company_number ?? \"\",\r\n      location: a.location\r\n        ? typeof a.location === \"string\"\r\n          ? a.location\r\n          : JSON.stringify(a.location)\r\n        : prev.location ?? \"\",\r\n      app_fees: a.app_fees ?? prev.app_fees ?? \"\",\r\n      contract_form: a.contract_form ?? prev.contract_form ?? \"\",\r\n      policies: a.policies ?? prev.policies ?? \"\",\r\n      website: a.website ?? prev.website ?? \"\",\r\n    }));\r\n\r\n    const bt = (a.business_type || \"\").toString();\r\n    setShowCompanyFields(bt === \"company\");\r\n\r\n    // Parse existing location if available\r\n    if (a.location) {\r\n      try {\r\n        const locData = typeof a.location === \"string\" ? JSON.parse(a.location) : a.location;\r\n        if (locData.latitude && locData.longitude) {\r\n          setSelectedLocation({ lat: locData.latitude, lng: locData.longitude });\r\n          setMapCenter({ lat: locData.latitude, lng: locData.longitude });\r\n        }\r\n      } catch (e) {\r\n        log(\"Failed to parse existing location\", e);\r\n      }\r\n    }\r\n  };\r\n\r\n  // =========================\r\n  // LOCATION HANDLERS\r\n  // =========================\r\n  const getCurrentLocation = () => {\r\n    if (!navigator.geolocation) {\r\n      toast.error(\"Geolocation is not supported by your browser\");\r\n      openMapPicker();\r\n      return;\r\n    }\r\n\r\n    toast.info(\"Getting your location...\");\r\n    const options = {\r\n      enableHighAccuracy: true,\r\n      timeout: 15000,\r\n      maximumAge: 60000,\r\n    };\r\n    navigator.geolocation.getCurrentPosition(\r\n      (position) => {\r\n        const location = {\r\n          lat: parseFloat(position.coords.latitude.toFixed(6)),\r\n          lng: parseFloat(position.coords.longitude.toFixed(6)),\r\n        };\r\n        setSelectedLocation(location);\r\n        setMapCenter(location);\r\n        \r\n        // Store as proper JSON structure for backend\r\n        const locationJson = {\r\n          latitude: location.lat,\r\n          longitude: location.lng,\r\n          country: \"Lebanon\"\r\n        };\r\n        setForm((prev) => ({ ...prev, location: JSON.stringify(locationJson) }));\r\n        toast.success(\"Location detected successfully!\");\r\n        log(\"Current location:\", locationJson);\r\n      },\r\n      (error) => {\r\n        log(\"Geolocation error:\", error);\r\n        toast.info(\"Location could not be detected. Select your location on the map.\");\r\n        setShowMapModal(true);\r\n      },\r\n      options\r\n    );\r\n  };\r\n\r\n  const openMapPicker = () => {\r\n    setShowMapModal(true);\r\n  };\r\n\r\n  const handleMapClick = (lat, lng) => {\r\n    const location = {\r\n      lat: parseFloat(lat.toFixed(6)),\r\n      lng: parseFloat(lng.toFixed(6)),\r\n    };\r\n    setSelectedLocation(location);\r\n    log(\"Map clicked location:\", location);\r\n  };\r\n\r\n  const confirmLocationSelection = () => {\r\n    if (selectedLocation) {\r\n      // Store as proper JSON structure for backend\r\n      const locationJson = {\r\n        latitude: selectedLocation.lat,\r\n        longitude: selectedLocation.lng,\r\n        country: \"Lebanon\"\r\n      };\r\n      setForm((prev) => ({ ...prev, location: JSON.stringify(locationJson) }));\r\n      toast.success(\"Location selected!\");\r\n      setShowMapModal(false);\r\n    } else {\r\n      toast.error(\"Please select a location on the map\");\r\n    }\r\n  };\r\n\r\n  const applyGoogleLink = (url) => {\r\n    const coords = parseGoogleMapsLink(url);\r\n    if (coords) {\r\n      const location = { lat: parseFloat(coords.lat.toFixed(6)), lng: parseFloat(coords.lng.toFixed(6)) };\r\n      setSelectedLocation(location);\r\n      setMapCenter(location);\r\n      const locationJson = { latitude: location.lat, longitude: location.lng, country: \"Lebanon\" };\r\n      setForm((prev) => ({ ...prev, location: JSON.stringify(locationJson) }));\r\n      toast.success(\"Location set from Google Maps link.\");\r\n    } else {\r\n      toast.error(\"Could not read coordinates. Use a link with lat,lng (e.g. @33.89,35.50 or ?q=33.89,35.50).\");\r\n    }\r\n  };\r\n\r\n  const searchLocation = async (query, isMapModal) => {\r\n    const q = query.trim();\r\n    if (!q) return;\r\n    if (isMapModal) setMapSearchLoading(true);\r\n    else setLocationSearchLoading(true);\r\n    try {\r\n      const res = await fetch(\r\n        `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`,\r\n        { headers: { Accept: \"application/json\" } }\r\n      );\r\n      const data = await res.json();\r\n      if (data && data[0]) {\r\n        const lat = parseFloat(data[0].lat);\r\n        const lng = parseFloat(data[0].lon);\r\n        const location = { lat, lng };\r\n        setSelectedLocation(location);\r\n        setMapCenter(location);\r\n        const locationJson = { latitude: lat, longitude: lng, country: \"Lebanon\" };\r\n        setForm((prev) => ({ ...prev, location: JSON.stringify(locationJson) }));\r\n        toast.success(\"Location found. Confirm in the modal if needed.\");\r\n      } else {\r\n        toast.error(\"No results found. Try another search.\");\r\n      }\r\n    } catch {\r\n      toast.error(\"Search failed. Try again.\");\r\n    } finally {\r\n      if (isMapModal) setMapSearchLoading(false);\r\n      else setLocationSearchLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleLocationSearch = () => searchLocation(locationSearchQuery, false);\r\n  const handleMapSearch = () => searchLocation(mapSearchQuery, true);\r\n\r\n  // =========================\r\n  // API CALLS\r\n  // =========================\r\n  const checkProfileStatus = async () => {\r\n    try {\r\n      logAxiosBase();\r\n      log(\"GET /profile/status starting...\");\r\n      const res = await api.get(\"/profile/status\", {\r\n        headers: { \"X-Debug-Id\": debugId },\r\n      });\r\n      log(\"GET /profile/status success:\", res.status, res.data);\r\n\r\n      setProfileStatus(res.data);\r\n      prefillFromStatus(res.data);\r\n\r\n      if (res.data?.is_complete) {\r\n        const userData = res.data.user;\r\n        log(\"Profile already complete. Redirecting. role =\", userData?.role);\r\n\r\n        if (userData?.role === \"agency\" || userData?.role === \"agency\") {\r\n          navigate(\"/Dashboard\");\r\n        } else {\r\n          navigate(\"/\");\r\n        }\r\n      }\r\n    } catch (err) {\r\n      log(\"GET /profile/status FAILED\", err);\r\n      if (err?.response) {\r\n        log(\"Status error response:\", err.response.status, err.response.data);\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const storedUser = JSON.parse(localStorage.getItem(\"user\"));\r\n    if (!storedUser) {\r\n      toast.error(\"Please login first\");\r\n      navigate(\"/auth\");\r\n      return;\r\n    }\r\n    setUser(storedUser);\r\n    log(\"Loaded user from localStorage:\", storedUser);\r\n    checkProfileStatus();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [navigate]);\r\n\r\n  // =========================\r\n  // HANDLERS\r\n  // =========================\r\n  const handleChange = (e) => {\r\n    const { name, value, files } = e.target;\r\n\r\n    if (files) {\r\n      const f = files[0] || null;\r\n      setForm((prev) => ({ ...prev, [name]: f }));\r\n      log(\"File changed:\", name, f ? { name: f.name, size: f.size, type: f.type } : null);\r\n      return;\r\n    }\r\n\r\n    setForm((prev) => ({ ...prev, [name]: value }));\r\n    log(\"Field changed:\", name, value);\r\n\r\n    if (name === \"business_type\") {\r\n      setShowCompanyFields(value === \"company\");\r\n    }\r\n  };\r\n\r\n  const handleSelectChange = (name, value) => {\r\n    setForm((prev) => ({ ...prev, [name]: value }));\r\n    log(\"Select changed:\", name, value);\r\n\r\n    if (name === \"business_type\") {\r\n      setShowCompanyFields(value === \"company\");\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    // Base fields validation\r\n    if (!form.first_name || !form.last_name || !form.gender || !form.birth_date || !form.city) {\r\n      toast.error(\"Please fill all required base fields\");\r\n      return false;\r\n    }\r\n\r\n    // ID cards are required\r\n    if (!form.id_card_front || !form.id_card_back) {\r\n      toast.error(\"Please upload both ID card photos\");\r\n      return false;\r\n    }\r\n\r\n    if (isClient) {\r\n      // Client-specific validation\r\n      if (!form.license_number || !form.driver_license || !form.profession || !form.avg_salary) {\r\n        toast.error(\"Please fill all required client fields\");\r\n        return false;\r\n      }\r\n\r\n      // Validate profession enum\r\n      const validClientProfessions = ['employee', 'freelancer', 'business', 'student', 'other'];\r\n      if (!validClientProfessions.includes(form.profession)) {\r\n        toast.error(\"Please select a valid profession\");\r\n        return false;\r\n      }\r\n\r\n      // Validate avg_salary enum\r\n      const validSalaryRanges = ['200-500', '500-1000', '1000-2000', '2000+'];\r\n      if (!validSalaryRanges.includes(form.avg_salary)) {\r\n        toast.error(\"Please select a valid salary range\");\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (isAgency) {\r\n      console.log(\"[CompleteProfile Validate]\", \"Agency validation started\", {\r\n        business_type: form.business_type,\r\n        profession: form.profession,\r\n        hasLocation: !!form.location,\r\n        locationLength: form.location?.length,\r\n      });\r\n      // Agency-specific validation\r\n      if (!form.business_type || !form.profession) {\r\n        console.log(\"[CompleteProfile Validate]\", \"Failed: missing business_type or profession\");\r\n        toast.error(\"Please fill all required agency fields\");\r\n        return false;\r\n      }\r\n\r\n      if (!form.location) {\r\n        console.log(\"[CompleteProfile Validate]\", \"Failed: no location\");\r\n        toast.error(\"Please select your agency location. Opening map...\");\r\n        setShowMapModal(true);\r\n        setTimeout(() => document.getElementById(\"agency-location-section\")?.scrollIntoView({ behavior: \"smooth\" }), 100);\r\n        return false;\r\n      }\r\n\r\n      // Validate business_type enum – must match backend:\r\n      // rental, private, company, marina\r\n      const allowedBusinessTypes = ['rental', 'private', 'company', 'marina'];\r\n      if (!allowedBusinessTypes.includes(form.business_type)) {\r\n        console.log(\"[CompleteProfile Validate]\", \"Failed: invalid business_type\", form.business_type);\r\n        toast.error(\"Please select a valid business type\");\r\n        return false;\r\n      }\r\n\r\n      // Validate profession enum for agency – must match backend:\r\n      // owner, manager\r\n      const validAgencyProfessions = ['owner', 'manager'];\r\n      if (!validAgencyProfessions.includes(form.profession)) {\r\n        console.log(\"[CompleteProfile Validate]\", \"Failed: invalid profession\", form.profession);\r\n        toast.error(\"Please select a valid profession\");\r\n        return false;\r\n      }\r\n\r\n      // Validate location JSON\r\n      try {\r\n        const locationData = JSON.parse(form.location);\r\n        if (!locationData.latitude || !locationData.longitude) {\r\n          console.log(\"[CompleteProfile Validate]\", \"Failed: location missing lat/lng\", locationData);\r\n          toast.error('Invalid location data. Please select your location again');\r\n          return false;\r\n        }\r\n        console.log(\"[CompleteProfile Validate]\", \"Location OK\", locationData);\r\n      } catch (parseErr) {\r\n        console.log(\"[CompleteProfile Validate]\", \"Failed: location parse error\", parseErr, \"raw:\", form.location);\r\n        toast.error('Invalid location format. Please select your location again');\r\n        return false;\r\n      }\r\n\r\n      // Company-specific validation\r\n      if (form.business_type === \"company\") {\r\n        if (!form.company_number || !form.business_doc) {\r\n          console.log(\"[CompleteProfile Validate]\", \"Failed: company fields\", {\r\n            company_number: form.company_number,\r\n            business_doc: !!form.business_doc,\r\n          });\r\n          toast.error(\"Please fill company number and upload business document\");\r\n          return false;\r\n        }\r\n      }\r\n      console.log(\"[CompleteProfile Validate]\", \"Agency validation passed\");\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const debugPrefix = \"[CompleteProfile Submit]\";\r\n    console.log(debugPrefix, \"Submit clicked\", {\r\n      role: user?.role,\r\n      isClient,\r\n      isAgency,\r\n      formKeys: Object.keys(form),\r\n    });\r\n    if (user?.role === \"agency\" || user?.role === \"agency\") {\r\n      console.log(debugPrefix, \"Agency form state\", {\r\n        business_type: form.business_type,\r\n        profession: form.profession,\r\n        location: form.location,\r\n        locationParsed: (() => {\r\n          try {\r\n            return form.location ? JSON.parse(form.location) : null;\r\n          } catch (e) {\r\n            return { parseError: String(e.message) };\r\n          }\r\n        })(),\r\n        company_number: form.company_number,\r\n        business_doc: form.business_doc?.name ?? form.business_doc,\r\n        app_fees: form.app_fees,\r\n        contract_form: form.contract_form,\r\n        policies: form.policies,\r\n        website: form.website,\r\n      });\r\n    }\r\n    log(\"Submit clicked. role =\", user?.role, \"isClient =\", isClient, \"isAgency =\", isAgency);\r\n    logAxiosBase();\r\n\r\n    if (!validateForm()) {\r\n      console.log(debugPrefix, \"Validation failed on client side.\");\r\n      log(\"Validation failed on client side.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const formData = new FormData();\r\n\r\n      // Base fields - ALWAYS LOWERCASE ENUMS\r\n      formData.append(\"first_name\", form.first_name);\r\n      formData.append(\"last_name\", form.last_name);\r\n      formData.append(\"gender\", form.gender.toLowerCase()); // ✅ Lowercase\r\n      formData.append(\"birth_date\", form.birth_date);\r\n      formData.append(\"city\", form.city.toLowerCase()); // ✅ Lowercase\r\n\r\n      // ✅ ALWAYS send bio (even if empty)\r\n      formData.append(\"bio\", form.bio || \"\");\r\n\r\n      // Files (backend requires these as required)\r\n      if (form.id_card_front) formData.append(\"id_card_front\", form.id_card_front);\r\n      if (form.id_card_back) formData.append(\"id_card_back\", form.id_card_back);\r\n\r\n      // Profile picture is optional\r\n      if (form.profile_picture) formData.append(\"profile_picture\", form.profile_picture);\r\n\r\n      if (isClient) {\r\n        formData.append(\"license_number\", form.license_number);\r\n        if (form.driver_license) formData.append(\"driver_license\", form.driver_license);\r\n        formData.append(\"profession\", form.profession.toLowerCase()); // ✅ Lowercase\r\n        formData.append(\"avg_salary\", form.avg_salary); // Already in correct format\r\n        \r\n        // ✅ Only send promo_code if not empty\r\n        if (form.promo_code?.trim()) {\r\n          formData.append(\"promo_code\", form.promo_code.trim());\r\n        }\r\n      } else if (isAgency) {\r\n        console.log(\"[CompleteProfile Submit]\", \"Building agency FormData...\");\r\n        formData.append(\"business_type\", form.business_type.toLowerCase()); // ✅ Lowercase\r\n        formData.append(\"profession\", form.profession.toLowerCase()); // ✅ Lowercase\r\n\r\n        // ✅ Location as JSON string with correct structure\r\n        let locationData;\r\n        try {\r\n          locationData = JSON.parse(form.location);\r\n          const cleanedLocation = JSON.stringify({\r\n            latitude: parseFloat(locationData.latitude),\r\n            longitude: parseFloat(locationData.longitude),\r\n            country: locationData.country || \"Lebanon\"\r\n          });\r\n          formData.append(\"location\", cleanedLocation);\r\n          console.log(\"[CompleteProfile Submit]\", \"Location appended\", { cleanedLocation, locationData });\r\n        } catch (locationErr) {\r\n          console.error(\"[CompleteProfile Submit]\", \"Location parse/append error\", locationErr);\r\n          console.log(\"[CompleteProfile Submit]\", \"form.location raw:\", form.location);\r\n          throw locationErr;\r\n        }\r\n\r\n        // Optional fields - only send if not empty\r\n        if (form.app_fees?.trim()) {\r\n          formData.append(\"app_fees\", form.app_fees.trim());\r\n        }\r\n        if (form.contract_form?.trim()) {\r\n          formData.append(\"contract_form\", form.contract_form.trim());\r\n        }\r\n        if (form.policies?.trim()) {\r\n          formData.append(\"policies\", form.policies.trim());\r\n        }\r\n        if (form.website?.trim()) {\r\n          formData.append(\"website\", form.website.trim());\r\n        }\r\n\r\n        // Company-specific fields\r\n        if (form.business_type === \"company\") {\r\n          formData.append(\"company_number\", form.company_number);\r\n          if (form.business_doc) formData.append(\"business_doc\", form.business_doc);\r\n          console.log(\"[CompleteProfile Submit]\", \"Company fields appended\", {\r\n            company_number: form.company_number,\r\n            business_doc: form.business_doc?.name ?? (form.business_doc ? \"present\" : \"missing\"),\r\n          });\r\n        }\r\n        const entries = [];\r\n        formData.forEach((value, key) => {\r\n          entries.push({ key, value: value instanceof File ? `File: ${value.name}` : value });\r\n        });\r\n        console.log(\"[CompleteProfile Submit]\", \"FormData entries (agency)\", entries);\r\n      }\r\n\r\n      dumpFormData(formData);\r\n\r\n      const apiUrl = api.defaults?.baseURL ? `${api.defaults.baseURL}/profile/complete` : \"/profile/complete\";\r\n      console.log(\"[CompleteProfile Submit]\", \"POST /profile/complete\", { apiUrl, contentType: \"multipart/form-data\" });\r\n      log(\"POST /profile/complete starting...\");\r\n      const res = await api.post(\"/profile/complete\", formData, {\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\",\r\n          \"X-Debug-Id\": debugId,\r\n        },\r\n      });\r\n\r\n      console.log(\"[CompleteProfile Submit]\", \"POST /profile/complete success\", res.status, res.data);\r\n      log(\"POST /profile/complete success:\", res.status, res.data);\r\n\r\n      const updatedUser = res.data.user;\r\n      localStorage.setItem(\"user\", JSON.stringify(updatedUser));\r\n      setUser(updatedUser);\r\n\r\n      toast.success(\"Profile completed successfully!\");\r\n\r\n      log(\"Refreshing status...\");\r\n      const statusCheck = await api.get(\"/profile/status\", {\r\n        headers: { \"X-Debug-Id\": debugId },\r\n      });\r\n\r\n      log(\"GET /profile/status after submit:\", statusCheck.status, statusCheck.data);\r\n      setProfileStatus(statusCheck.data);\r\n\r\n      const isComplete = statusCheck.data.is_complete;\r\n\r\n      setTimeout(() => {\r\n        if (isComplete) {\r\n          if (updatedUser.role === \"agency\" || updatedUser.role === \"agency\") {\r\n            navigate(\"/Dashboard\");\r\n          } else {\r\n            navigate(\"/\");\r\n          }\r\n        } else {\r\n          toast.warning(\"Please complete all required fields\");\r\n        }\r\n      }, 500);\r\n    } catch (err) {\r\n      console.error(\"[CompleteProfile Submit]\", \"Request failed\", err);\r\n      console.log(\"[CompleteProfile Submit]\", \"Error name:\", err?.name, \"message:\", err?.message);\r\n      log(\"POST /profile/complete FAILED:\", err);\r\n\r\n      if (err?.response) {\r\n        console.log(\"[CompleteProfile Submit]\", \"Response status:\", err.response.status);\r\n        console.log(\"[CompleteProfile Submit]\", \"Response data:\", err.response.data);\r\n        console.log(\"[CompleteProfile Submit]\", \"Response headers:\", JSON.stringify(err.response.headers, null, 2));\r\n        log(\"Error response status:\", err.response.status);\r\n        log(\"Error response data:\", err.response.data);\r\n        log(\"Error response headers:\", err.response.headers);\r\n\r\n        // Handle 403 Forbidden\r\n        if (err.response.status === 403) {\r\n          const errorMessage = err.response?.data?.message || err.response?.data?.error || \"You do not have permission to update your profile. Please contact administrator.\";\r\n          toast.error(errorMessage);\r\n          return;\r\n        }\r\n\r\n        if (typeof err.response.data === \"string\") {\r\n          log(\"Error response (string, first 500 chars):\", err.response.data.slice(0, 500));\r\n        }\r\n\r\n        if (err.response?.data?.errors) {\r\n          console.log(\"[CompleteProfile Submit]\", \"Validation errors (422)\", err.response.data.errors);\r\n          const errors = Object.values(err.response.data.errors).flat();\r\n          errors.forEach((error) => toast.error(error));\r\n        } else {\r\n          console.log(\"[CompleteProfile Submit]\", \"Error message:\", err.response?.data?.message);\r\n          toast.error(err.response?.data?.message || \"Failed to complete profile\");\r\n        }\r\n      } else if (err?.request) {\r\n        console.log(\"[CompleteProfile Submit]\", \"No response received (network/CORS)\", err.request);\r\n        log(\"No response received. Request:\", err.request);\r\n        toast.error(\"No response from server. Check network/CORS/auth.\");\r\n      } else {\r\n        log(\"Unknown error:\", err?.message || err);\r\n        toast.error(\"Unexpected error occurred.\");\r\n      }\r\n\r\n      log(\r\n        \"If you see https://.../api/api/... then your axios baseURL already contains /api and your proxy/route also adds /api.\"\r\n      );\r\n      log(\"Fix by adjusting api.defaults.baseURL OR Vite proxy OR route prefix so it becomes /api/profile/complete only once.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-primary/5 to-secondary/5\">\r\n      <div className=\"w-full max-w-3xl\">\r\n        <div className=\"flex flex-col items-center mb-8\">\r\n          <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-lg mb-4\">\r\n            <Car className=\"w-8 h-8 text-primary-foreground\" />\r\n          </div>\r\n          <h1 className=\"text-3xl font-bold gradient-text\">Complete Your Profile</h1>\r\n          <p className=\"text-muted-foreground mt-2\">\r\n            {user?.role === \"client\" ? \"Client Profile\" : \"Agency Profile\"}\r\n          </p>\r\n\r\n          {profileStatus && (\r\n            <div className=\"mt-4 w-full max-w-md\">\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <span className=\"text-sm text-muted-foreground\">Profile Completion</span>\r\n                <span className=\"text-sm font-semibold\">\r\n                  {profileStatus.completion_percentage}%\r\n                </span>\r\n              </div>\r\n              <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                <div\r\n                  className=\"bg-gradient-to-r from-teal-500 to-cyan-500 h-2 rounded-full transition-all\"\r\n                  style={{ width: `${profileStatus.completion_percentage}%` }}\r\n                ></div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <Card className=\"hover-glow shadow-xl\">\r\n          <CardHeader>\r\n            <CardTitle className=\"text-2xl\">\r\n              Complete Your {user?.role === \"client\" ? \"Client\" : \"agency\"} Profile\r\n            </CardTitle>\r\n            <CardDescription>Please fill all required fields to continue</CardDescription>\r\n          </CardHeader>\r\n\r\n          <CardContent>\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n              {/* BASE FIELDS */}\r\n              <div className=\"space-y-4\">\r\n                <h3 className=\"text-lg font-semibold\">Basic Information</h3>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>First Name *</Label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"first_name\"\r\n                      value={form.first_name}\r\n                      onChange={handleChange}\r\n                      required\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>Last Name *</Label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"last_name\"\r\n                      value={form.last_name}\r\n                      onChange={handleChange}\r\n                      required\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>Gender *</Label>\r\n                    <Select\r\n                      value={form.gender}\r\n                      onValueChange={(value) => handleSelectChange(\"gender\", value)}\r\n                    >\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"male\">Male</SelectItem>\r\n                        <SelectItem value=\"female\">Female</SelectItem>\r\n                        <SelectItem value=\"other\">Other</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>Birth Date *</Label>\r\n                    <Input\r\n                      type=\"date\"\r\n                      name=\"birth_date\"\r\n                      value={form.birth_date}\r\n                      onChange={handleChange}\r\n                      max={new Date().toISOString().split(\"T\")[0]}\r\n                      required\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>City *</Label>\r\n                  <Select\r\n                    value={form.city}\r\n                    onValueChange={(value) => handleSelectChange(\"city\", value)}\r\n                  >\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder=\"Select your city\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"beirut\">Beirut</SelectItem>\r\n                      <SelectItem value=\"mount-liban\">Mount Liban</SelectItem>\r\n                      <SelectItem value=\"south\">South</SelectItem>\r\n                      <SelectItem value=\"north\">North</SelectItem>\r\n                      <SelectItem value=\"bekaa\">Bekaa</SelectItem>\r\n                      <SelectItem value=\"other\">Other</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Bio (optional)</Label>\r\n                  <textarea\r\n                    name=\"bio\"\r\n                    value={form.bio}\r\n                    onChange={handleChange}\r\n                    rows={3}\r\n                    className=\"w-full px-3 py-2 rounded-md border border-input bg-background\"\r\n                    placeholder=\"Tell us about yourself...\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>Profile Picture (optional)</Label>\r\n                  <Input\r\n                    type=\"file\"\r\n                    name=\"profile_picture\"\r\n                    onChange={handleChange}\r\n                    accept=\"image/jpeg,image/jpg,image/png\"\r\n                  />\r\n                  {form.profile_picture && (\r\n                    <p className=\"text-xs text-muted-foreground mt-1\">\r\n                      {form.profile_picture.name}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <Label>ID Card - Front *</Label>\r\n                    <Input\r\n                      type=\"file\"\r\n                      name=\"id_card_front\"\r\n                      onChange={handleChange}\r\n                      accept=\"image/jpeg,image/jpg,image/png,application/pdf\"\r\n                      required\r\n                    />\r\n                    {form.id_card_front && (\r\n                      <p className=\"text-xs text-muted-foreground mt-1\">\r\n                        {form.id_card_front.name}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>ID Card - Back *</Label>\r\n                    <Input\r\n                      type=\"file\"\r\n                      name=\"id_card_back\"\r\n                      onChange={handleChange}\r\n                      accept=\"image/jpeg,image/jpg,image/png,application/pdf\"\r\n                      required\r\n                    />\r\n                    {form.id_card_back && (\r\n                      <p className=\"text-xs text-muted-foreground mt-1\">\r\n                        {form.id_card_back.name}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <hr className=\"my-6\" />\r\n\r\n              {/* CLIENT FIELDS */}\r\n              {user?.role === \"client\" && (\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-lg font-semibold\">Client Information</h3>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label>License Number *</Label>\r\n                      <Input\r\n                        type=\"text\"\r\n                        name=\"license_number\"\r\n                        value={form.license_number}\r\n                        onChange={handleChange}\r\n                        required\r\n                      />\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Driver License *</Label>\r\n                      <Input\r\n                        type=\"file\"\r\n                        name=\"driver_license\"\r\n                        onChange={handleChange}\r\n                        accept=\"image/jpeg,image/jpg,image/png,application/pdf\"\r\n                        required\r\n                      />\r\n                      {form.driver_license && (\r\n                        <p className=\"text-xs text-muted-foreground mt-1\">\r\n                          {form.driver_license.name}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label>Profession *</Label>\r\n                      <Select\r\n                        value={form.profession}\r\n                        onValueChange={(value) => handleSelectChange(\"profession\", value)}\r\n                      >\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Choose...\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"employee\">Employee</SelectItem>\r\n                          <SelectItem value=\"freelancer\">Freelancer</SelectItem>\r\n                          <SelectItem value=\"business\">Business</SelectItem>\r\n                          <SelectItem value=\"student\">Student</SelectItem>\r\n                          <SelectItem value=\"other\">Other</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Average Salary *</Label>\r\n                      <Select\r\n                        value={form.avg_salary}\r\n                        onValueChange={(value) => handleSelectChange(\"avg_salary\", value)}\r\n                      >\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Select...\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"200-500\">$200-500</SelectItem>\r\n                          <SelectItem value=\"500-1000\">$500-1000</SelectItem>\r\n                          <SelectItem value=\"1000-2000\">$1000-2000</SelectItem>\r\n                          <SelectItem value=\"2000+\">$2000+</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>Promo Code (optional)</Label>\r\n                    <Input\r\n                      type=\"text\"\r\n                      name=\"promo_code\"\r\n                      value={form.promo_code}\r\n                      onChange={handleChange}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* AGENCY FIELDS */}\r\n              {(user?.role === \"agency\" || user?.role === \"agency\") && (\r\n                <div className=\"space-y-4\">\r\n                  <h3 className=\"text-lg font-semibold\">Agency Information</h3>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <Label>Business Type *</Label>\r\n                      <Select\r\n                        value={form.business_type}\r\n                        onValueChange={(value) => {\r\n                          handleSelectChange(\"business_type\", value);\r\n                          setShowCompanyFields(value === \"company\");\r\n                        }}\r\n                      >\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Select\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"rental\">Rental</SelectItem>\r\n                          <SelectItem value=\"private\">Private</SelectItem>\r\n                          <SelectItem value=\"company\">Company</SelectItem>\r\n                          <SelectItem value=\"marina\">Marina</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n\r\n                    <div>\r\n                      <Label>Profession *</Label>\r\n                      <Select\r\n                        value={form.profession}\r\n                        onValueChange={(value) => handleSelectChange(\"profession\", value)}\r\n                      >\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Choose...\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"manager\">Manager</SelectItem>\r\n                          <SelectItem value=\"owner\">Owner</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {showCompanyFields && (\r\n                    <div className=\"space-y-4 p-4 border rounded-lg bg-muted/30\">\r\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                        <AlertCircle className=\"w-4 h-4\" />\r\n                        <p>Company Details (Required)</p>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Company Number *</Label>\r\n                        <Input\r\n                          type=\"text\"\r\n                          name=\"company_number\"\r\n                          value={form.company_number}\r\n                          onChange={handleChange}\r\n                          required={showCompanyFields}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label>Business Document *</Label>\r\n                        <Input\r\n                          type=\"file\"\r\n                          name=\"business_doc\"\r\n                          onChange={handleChange}\r\n                          accept=\"image/jpeg,image/jpg,image/png,application/pdf\"\r\n                          required={showCompanyFields}\r\n                        />\r\n                        {form.business_doc && (\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            {form.business_doc.name}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div id=\"agency-location-section\">\r\n                    <Label>Address (region) *</Label>\r\n                    <Select\r\n                      value={form.city || \"\"}\r\n                      onValueChange={(value) => handleSelectChange(\"city\", value)}\r\n                    >\r\n                      <SelectTrigger className=\"mb-3\">\r\n                        <SelectValue placeholder=\"Select your region\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {ADDRESS_OPTIONS.map((opt) => (\r\n                          <SelectItem key={opt.value} value={opt.value}>\r\n                            {opt.label}\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n\r\n                    <Label>Location *</Label>\r\n                    <div className=\"space-y-3\">\r\n                      <div>\r\n                        <Label className=\"text-muted-foreground text-xs\">Paste Google Maps link</Label>\r\n                        <div className=\"flex gap-2 mt-1\">\r\n                          <Input\r\n                            placeholder=\"e.g. https://www.google.com/maps/@33.8938,35.5018,17z\"\r\n                            value={googleLinkInput}\r\n                            onChange={(e) => setGoogleLinkInput(e.target.value)}\r\n                            onBlur={(e) => {\r\n                              const v = e.target.value?.trim();\r\n                              if (v) applyGoogleLink(v);\r\n                            }}\r\n                            className=\"flex-1\"\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={() => googleLinkInput.trim() && applyGoogleLink(googleLinkInput)}\r\n                          >\r\n                            Apply\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div>\r\n                        <Label className=\"text-muted-foreground text-xs\">Search address</Label>\r\n                        <div className=\"flex gap-2 mt-1\">\r\n                          <Input\r\n                            placeholder=\"Search address or place...\"\r\n                            value={locationSearchQuery}\r\n                            onChange={(e) => setLocationSearchQuery(e.target.value)}\r\n                            onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), handleLocationSearch())}\r\n                            className=\"flex-1\"\r\n                          />\r\n                          <Button\r\n                            type=\"button\"\r\n                            variant=\"outline\"\r\n                            onClick={handleLocationSearch}\r\n                            disabled={locationSearchLoading}\r\n                          >\r\n                            <Search className=\"w-4 h-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex gap-2 flex-wrap\">\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"outline\"\r\n                          className=\"flex-1 min-w-[140px]\"\r\n                          onClick={getCurrentLocation}\r\n                        >\r\n                          <Navigation className=\"w-4 h-4 mr-2\" />\r\n                          Use Current Location\r\n                        </Button>\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"outline\"\r\n                          className=\"flex-1 min-w-[140px]\"\r\n                          onClick={openMapPicker}\r\n                        >\r\n                          <MapPin className=\"w-4 h-4 mr-2\" />\r\n                          Select on Map\r\n                        </Button>\r\n                      </div>\r\n                      \r\n                      {selectedLocation ? (\r\n                        <div className=\"p-4 bg-primary/10 border-2 border-primary/20 rounded-lg\">\r\n                          <div className=\"flex items-start gap-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0\">\r\n                              <MapPin className=\"w-5 h-5 text-primary\" />\r\n                            </div>\r\n                            <div className=\"flex-1\">\r\n                              <p className=\"font-semibold text-sm mb-1\">Location Selected</p>\r\n                              <p className=\"text-sm text-muted-foreground\">\r\n                                Latitude: {selectedLocation.lat}\r\n                              </p>\r\n                              <p className=\"text-sm text-muted-foreground\">\r\n                                Longitude: {selectedLocation.lng}\r\n                              </p>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"p-4 bg-muted/30 border-2 border-dashed rounded-lg text-center\">\r\n                          <MapPin className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\r\n                          <p className=\"text-sm text-muted-foreground\">\r\n                            No location selected yet\r\n                          </p>\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">\r\n                            Click one of the buttons above to set your location\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n\r\n                      <input\r\n                        type=\"hidden\"\r\n                        name=\"location\"\r\n                        value={form.location}\r\n                        required\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-1 gap-4\">\r\n                    <div>\r\n                      <Label>Website (optional)</Label>\r\n                      <Input\r\n                        type=\"url\"\r\n                        name=\"website\"\r\n                        value={form.website}\r\n                        onChange={handleChange}\r\n                        placeholder=\"https://example.com\"\r\n                      />\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>Contract Form (optional)</Label>\r\n                    <textarea\r\n                      name=\"contract_form\"\r\n                      value={form.contract_form}\r\n                      onChange={handleChange}\r\n                      rows={2}\r\n                      className=\"w-full px-3 py-2 rounded-md border border-input bg-background\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div>\r\n                    <Label>Policies (optional)</Label>\r\n                    <textarea\r\n                      name=\"policies\"\r\n                      value={form.policies}\r\n                      onChange={handleChange}\r\n                      rows={2}\r\n                      className=\"w-full px-3 py-2 rounded-md border border-input bg-background\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <Button\r\n                type=\"submit\"\r\n                className=\"w-full bg-gradient-to-r from-secondary to-accent font-semibold text-lg py-6\"\r\n                disabled={loading}\r\n              >\r\n                {loading ? \"Saving...\" : \"Save Profile\"}\r\n              </Button>\r\n            </form>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Map Modal */}\r\n      <Dialog open={showMapModal} onOpenChange={(open) => { setShowMapModal(open); if (!open) setMapSearchQuery(\"\"); }}>\r\n        <DialogContent className=\"max-w-4xl max-h-[90vh]\">\r\n          <DialogHeader>\r\n            <DialogTitle>Select Your Location</DialogTitle>\r\n            <DialogDescription>\r\n              Search for a place or click on the map to select your business location\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex gap-2 flex-wrap\">\r\n              <div className=\"flex flex-1 min-w-[200px] rounded-md overflow-hidden border border-input\">\r\n                <Input\r\n                  placeholder=\"Search address or place...\"\r\n                  value={mapSearchQuery}\r\n                  onChange={(e) => setMapSearchQuery(e.target.value)}\r\n                  onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), handleMapSearch())}\r\n                  className=\"rounded-r-none border-0 h-10 focus-visible:ring-0\"\r\n                />\r\n                <Button type=\"button\" variant=\"secondary\" onClick={handleMapSearch} disabled={mapSearchLoading} className=\"rounded-l-none h-10 px-4\">\r\n                  <Search className=\"w-4 h-4\" />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n            <div className=\"w-full h-[500px] bg-muted rounded-lg overflow-hidden\">\r\n              <MapComponent\r\n                center={mapCenter}\r\n                selectedLocation={selectedLocation}\r\n                onLocationSelect={handleMapClick}\r\n              />\r\n            </div>\r\n\r\n            {selectedLocation && (\r\n              <div className=\"p-3 bg-muted/50 rounded-md\">\r\n                <p className=\"text-sm\">\r\n                  <span className=\"font-medium\">Selected:</span> {selectedLocation.lat}, {selectedLocation.lng}\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex gap-2 justify-end\">\r\n              <Button variant=\"outline\" onClick={() => setShowMapModal(false)}>\r\n                Cancel\r\n              </Button>\r\n              <Button onClick={confirmLocationSelection}>\r\n                Confirm Location\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Simple Map Component using Leaflet\r\nfunction MapComponent({ center, selectedLocation, onLocationSelect }) {\r\n  const mapRef = React.useRef(null);\r\n  const markerRef = React.useRef(null);\r\n\r\n  useEffect(() => {\r\n    // Load Leaflet dynamically\r\n    if (typeof window !== \"undefined\" && !window.L) {\r\n      const link = document.createElement(\"link\");\r\n      link.rel = \"stylesheet\";\r\n      link.href = \"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\";\r\n      document.head.appendChild(link);\r\n\r\n      const script = document.createElement(\"script\");\r\n      script.src = \"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\";\r\n      script.onload = () => initMap();\r\n      document.head.appendChild(script);\r\n    } else if (window.L) {\r\n      initMap();\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (mapRef.current && window.L) {\r\n      mapRef.current.setView([parseFloat(center.lat), parseFloat(center.lng)], 13);\r\n    }\r\n  }, [center]);\r\n\r\n  useEffect(() => {\r\n    if (selectedLocation && markerRef.current && window.L) {\r\n      markerRef.current.setLatLng([\r\n        parseFloat(selectedLocation.lat),\r\n        parseFloat(selectedLocation.lng),\r\n      ]);\r\n    }\r\n  }, [selectedLocation]);\r\n\r\n  const initMap = () => {\r\n    if (!window.L || mapRef.current) return;\r\n\r\n    const map = window.L.map(\"map-container\").setView(\r\n      [parseFloat(center.lat), parseFloat(center.lng)],\r\n      13\r\n    );\r\n\r\n    window.L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n      attribution: '© OpenStreetMap contributors',\r\n    }).addTo(map);\r\n\r\n    const marker = window.L.marker([parseFloat(center.lat), parseFloat(center.lng)], {\r\n      draggable: true,\r\n    }).addTo(map);\r\n\r\n    marker.on(\"dragend\", (e) => {\r\n      const pos = e.target.getLatLng();\r\n      onLocationSelect(pos.lat, pos.lng);\r\n    });\r\n\r\n    map.on(\"click\", (e) => {\r\n      marker.setLatLng(e.latlng);\r\n      onLocationSelect(e.latlng.lat, e.latlng.lng);\r\n    });\r\n\r\n    mapRef.current = map;\r\n    markerRef.current = marker;\r\n  };\r\n\r\n  return <div id=\"map-container\" className=\"w-full h-full\" />;\r\n}"],"names":["ADDRESS_OPTIONS","parseGoogleMapsLink","url","trimmed","atMatch","qMatch","llMatch","lat","lng","CompleteProfilePage","navigate","useNavigate","debugId","useMemo","log","args","logAxiosBase","api","e","dumpFormData","fd","entries","k","v","user","setUser","useState","loading","setLoading","profileStatus","setProfileStatus","form","setForm","showCompanyFields","setShowCompanyFields","showMapModal","setShowMapModal","selectedLocation","setSelectedLocation","mapCenter","setMapCenter","googleLinkInput","setGoogleLinkInput","locationSearchQuery","setLocationSearchQuery","locationSearchLoading","setLocationSearchLoading","mapSearchQuery","setMapSearchQuery","mapSearchLoading","setMapSearchLoading","isClient","isAgency","normalizeDate","d","prefillFromStatus","status","u","c","a","prev","bt","locData","getCurrentLocation","toast","openMapPicker","options","position","location","locationJson","error","handleMapClick","confirmLocationSelection","applyGoogleLink","coords","searchLocation","query","isMapModal","q","data","handleLocationSearch","handleMapSearch","checkProfileStatus","res","userData","err","useEffect","storedUser","handleChange","name","value","files","f","handleSelectChange","validateForm","locationData","parseErr","handleSubmit","debugPrefix","formData","cleanedLocation","locationErr","key","apiUrl","updatedUser","statusCheck","isComplete","errorMessage","jsxs","jsx","Car","Card","CardHeader","CardTitle","CardDescription","CardContent","Label","Input","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","AlertCircle","opt","Button","Search","Navigation","MapPin","Dialog","open","DialogContent","DialogHeader","DialogTitle","DialogDescription","MapComponent","center","onLocationSelect","mapRef","React","markerRef","link","script","initMap","map","marker","pos"],"mappings":"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"}