import{d as E,c as H,r as i,j as e,C as $,y as P,b as Y,t as I}from"./index-DbvXYXc0.js";import{C as y,a as b}from"./card-6tZ6FSP9.js";import{m as d}from"./proxy-Rx_HuwO6.js";import{W as z}from"./wallet-CWUT53m_.js";import{R as U}from"./refresh-cw-BkItMj0z.js";import{D as V}from"./dollar-sign-o41FEJ1i.js";import{T as Z}from"./trending-up-XqNRnPMJ.js";import{C as J}from"./chevron-right-DaEW3pZI.js";import"./use-presence-CB-MpOZZ.js";const K=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],R=E("percent",K);const Q=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],C=E("receipt",Q),t={darkBlue:"#0E4C81",teal:"#008C95",limeGreen:"#8AC640",darkBlueDim:"rgba(14, 76, 129, 0.1)",tealDim:"rgba(0, 140, 149, 0.1)",limeGreenDim:"rgba(138, 198, 64, 0.1)"},D=u=>{if(u==null||u==="")return"0.00";const g=parseFloat(u);return Number.isNaN(g)?"0.00":g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})};function ie(){const u=H(),[g,B]=i.useState(!0),[M,F]=i.useState(!1),[l,A]=i.useState(null),[j,G]=i.useState([]),[h,O]=i.useState("all"),[k,q]=i.useState(""),[N,L]=i.useState(""),[m,S]=i.useState(null),w=a=>{if(!a)return null;const o=new Date(a);return Number.isNaN(o.getTime())?null:o},W=(a,o)=>{const s=w(a);if(!s)return!1;const c=new Date,x=new Date(c.getFullYear(),c.getMonth(),c.getDate());switch(o.type){case"day":return s>=x;case"week":{const n=new Date(x);return n.setDate(n.getDate()-7),s>=n}case"month":{const n=new Date(x.getFullYear(),x.getMonth(),1);return s>=n}case"custom":{const n=w(o.from),p=w(o.to);if(!n&&!p)return!0;if(n&&s<n)return!1;if(p){const f=new Date(p);if(f.setHours(23,59,59,999),s>f)return!1}return!0}default:return!0}},T=(a,o)=>{if(!Array.isArray(a)||a.length===0)return{total_amount:0,app_fees_amount:0,net_earnings:0,bookings_count:0,cancelled_count:0,rejected_count:0};const s=a.filter(r=>o.type==="all"?!0:W(r.start_datetime||r.created_at||r.updated_at,o)),c=s.filter(r=>["confirmed","accepted","completed"].includes(r.booking_request_status)),x=c.reduce((r,_)=>r+parseFloat(_.total_booking_price||0),0),n=c.reduce((r,_)=>r+(Number(_.app_fees_amount)||0),0),p=s.filter(r=>r.booking_request_status==="cancelled").length,f=s.filter(r=>r.booking_request_status==="rejected").length;return{total_amount:x,app_fees_amount:n,net_earnings:x-n,bookings_count:c.length,cancelled_count:p,rejected_count:f}},v=async()=>{B(!0),F(!1);try{const[{data:a},o]=await Promise.all([P().catch(()=>({data:{}})),Y.get("/driver/bookings")]);A(a);const s=o.data?.data||[];G(s);const c=T(s,{type:"all"});S(c)}catch(a){console.error("Failed to load earnings:",a),F(!0),I.error("Failed to load earnings. Please try again.")}finally{B(!1)}};return i.useEffect(()=>{v()},[]),i.useEffect(()=>{if(!j.length)return;S(T(j,{type:h,from:k,to:N}))},[j,h,k,N]),g&&!l?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-900 pt-20 flex items-center justify-center",children:e.jsx(d.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-14 h-14 rounded-full border-4 border-t-transparent",style:{borderColor:t.tealDim,borderTopColor:t.teal}})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-gray-950 dark:via-gray-900 dark:to-gray-900 pt-20",children:e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(d.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-xl flex items-center justify-center shadow-lg",style:{background:`linear-gradient(135deg, ${t.teal}, ${t.darkBlue})`},children:e.jsx(z,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-clip-text text-transparent",style:{backgroundImage:`linear-gradient(135deg, ${t.darkBlue}, ${t.teal})`},children:"Balance & Earnings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Total amount, app fees, and your net earnings"})]})]}),e.jsxs(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:v,disabled:g,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium border-2 transition-colors",style:{borderColor:t.teal,color:t.teal},children:[e.jsx(U,{className:`w-5 h-5 ${g?"animate-spin":""}`}),"Refresh"]})]})}),M&&!l?e.jsxs(y,{className:"border-2 rounded-2xl p-8 text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Could not load earnings."}),e.jsx(d.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:v,className:"px-5 py-2.5 rounded-xl text-white font-semibold",style:{background:`linear-gradient(135deg, ${t.teal}, ${t.darkBlue})`},children:"Try again"})]}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),"Balance range:"]}),[{id:"all",label:"All time"},{id:"day",label:"Today"},{id:"week",label:"Last 7 days"},{id:"month",label:"This month"},{id:"custom",label:"Custom"}].map(a=>e.jsx("button",{type:"button",onClick:()=>O(a.id),className:`px-3 py-1.5 rounded-full text-xs sm:text-sm border transition-colors ${h===a.id?"bg-teal-600 text-white border-teal-600":"bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"}`,children:a.label},a.id)),h==="custom"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs sm:text-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700",value:k,onChange:a=>q(a.target.value)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"to"}),e.jsx("input",{type:"date",className:"border rounded-lg px-2 py-1 text-xs sm:text-sm bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700",value:N,onChange:a=>L(a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsx(y,{className:"border-2 rounded-2xl overflow-hidden shadow-lg h-full",style:{borderColor:t.tealDim},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl",style:{background:t.tealDim},children:e.jsx(V,{className:"w-6 h-6",style:{color:t.teal}})}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Total booking amount"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["$",D(m?.total_amount??l.total_amount)]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"What clients paid (confirmed + completed)"})]})})}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsx(y,{className:"border-2 rounded-2xl overflow-hidden shadow-lg h-full",style:{borderColor:t.darkBlueDim},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl",style:{background:t.darkBlueDim},children:e.jsx(R,{className:"w-6 h-6",style:{color:t.darkBlue}})}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:"App fees (platform)"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["$",D(m?.app_fees_amount??l.app_fees_amount)]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Deducted from you • Fee: ",l.app_fees_percentage!=null?`${l.app_fees_percentage}%`:"—"]})]})})}),e.jsx(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(y,{className:"border-2 rounded-2xl overflow-hidden shadow-lg h-full",style:{borderColor:t.limeGreenDim},children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-xl",style:{background:t.limeGreenDim},children:e.jsx(Z,{className:"w-6 h-6",style:{color:t.limeGreen}})}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:"Your net earnings"})]}),e.jsxs("p",{className:"text-3xl font-bold",style:{color:t.limeGreen},children:["$",D(m?.net_earnings??l.net_earnings)]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Total amount − app fees"})]})})})]}),e.jsxs(d.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"flex flex-wrap items-center gap-6 p-4 rounded-2xl border-2 bg-white dark:bg-gray-800/50",style:{borderColor:t.tealDim},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5",style:{color:t.teal}}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["From ",e.jsx("strong",{children:m?.bookings_count??l.bookings_count??0})," bookings"]})]}),l.app_fees_percentage!=null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5",style:{color:t.darkBlue}}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Your app fee: ",e.jsxs("strong",{children:[l.app_fees_percentage,"%"]})]})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Cancelled bookings: ",e.jsx("strong",{children:m.cancelled_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:["Rejected bookings: ",e.jsx("strong",{children:m.rejected_count})]})]})]})]}),e.jsx(d.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:"mt-8",children:e.jsx(y,{className:"border-2 rounded-2xl overflow-hidden cursor-pointer hover:shadow-xl transition-all",style:{borderColor:t.tealDim},onClick:()=>u("/Mycars-bookings"),children:e.jsxs(b,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-xl",style:{background:t.tealDim},children:e.jsx($,{className:"w-5 h-5",style:{color:t.teal}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-white",children:"View bookings"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"See amount and app fee per booking"})]})]}),e.jsx(J,{className:"w-5 h-5 text-gray-400"})]})})})]}):null]})})}export{ie as default};
