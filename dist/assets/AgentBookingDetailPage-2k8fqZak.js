import{d as Y,c as Z,l as O,r as o,s as ee,j as e,U as C,e as te,P as re,M as ae,C as se,b as D,t as n,v as le}from"./index-DbvXYXc0.js";import{D as ie,b as oe,c as ne,d as ce}from"./dialog-CvL19ZOf.js";import{m as d}from"./proxy-Rx_HuwO6.js";import{A as de}from"./arrow-left-Bfp2vJNH.js";import{I as P}from"./image-BP72i33q.js";import{C as me}from"./credit-card-BJ0jGHsA.js";import{B as ge}from"./briefcase-BYt3mvcU.js";import{F as xe}from"./file-text-C6sc6Oop.js";import{C as be}from"./check-nqnuVgMJ.js";import{C as pe}from"./circle-x-D4rSEnQD.js";import{M as ye}from"./message-circle-CPCE0lxB.js";import{S as ue}from"./star-BJn2oNt2.js";import"./index-AD6gynWr.js";import"./index-UZKPKpE4.js";import"./index-9AnY3iUi.js";import"./Combination-B6rQ859v.js";import"./index-DE3TGyh9.js";import"./use-presence-CB-MpOZZ.js";const he=[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]],fe=Y("id-card",he),l={darkBlue:"#0E4C81",teal:"#008C95",limeGreen:"#8AC640",tealDim:"rgba(0, 140, 149, 0.1)",limeGreenDim:"rgba(138, 198, 64, 0.1)"},je=r=>{const g={pending:{label:"Pending",color:l.teal,bgColor:l.tealDim,textColor:l.teal,icon:"⏳"},confirmed:{label:"Confirmed",color:l.limeGreen,bgColor:l.limeGreenDim,textColor:l.limeGreen,icon:"✓"},accepted:{label:"Accepted",color:l.darkBlue,bgColor:"rgba(14, 76, 129, 0.1)",textColor:l.darkBlue,icon:"✓"},rejected:{label:"Rejected",color:"#DC2626",bgColor:"rgba(220, 38, 38, 0.1)",textColor:"#DC2626",icon:"✕"},completed:{label:"Completed",color:l.limeGreen,bgColor:l.limeGreenDim,textColor:l.limeGreen,icon:"✓"}};return g[r]||g.pending},y=r=>r?typeof r=="string"&&r.startsWith("http")?r:`/api/storage/${r.replace(/^\//,"")}`:null,T=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",G=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"N/A",ke=r=>r?typeof r=="string"?r:typeof r=="object"&&r.address?r.address:String(r):"N/A";function qe(){const r=Z(),N=O().state||{},{bookingId:x,car:q,bookings:u}=N,[h,b]=o.useState([]),[E,B]=o.useState(!0),[v,f]=o.useState(null),[j,S]=o.useState(null),[i,k]=o.useState({rating:0,template_selections:[],comment:""}),[A,R]=o.useState(!1),[$,H]=o.useState([]);o.useEffect(()=>{(async()=>{B(!0);try{if(x){const{data:a}=await D.get(`/bookings/${x}`);b([a.booking||a])}else if(u&&u.length>0)b(u);else{n.error("No booking data"),r("/Mycars-bookings");return}}catch(a){console.error("Error loading booking:",a),n.error("Failed to load booking"),r("/Mycars-bookings")}finally{B(!1)}})()},[x,u,r]),o.useEffect(()=>{ee().then(({data:t})=>H(t?.agent_rates_client||[])).catch(()=>{})},[]);const U=async t=>{f(t);try{await D.post(`/driver/bookings/${t}/accept`),b(a=>a.map(s=>s.id===t?{...s,booking_request_status:"confirmed"}:s)),n.success("Booking accepted!")}catch{n.error("Failed to accept booking")}finally{f(null)}},z=async t=>{if(confirm("Reject this booking?")){f(t);try{await D.post(`/driver/bookings/${t}/decline`),b(a=>a.filter(s=>s.id!==t)),h.length<=1&&r("/Mycars-bookings"),n.success("Booking rejected")}catch{n.error("Failed to reject booking")}finally{f(null)}}},V=t=>{const a=t?.booking_request_status,s=a==="confirmed"||a==="accepted",c=t?.end_datetime&&new Date(t.end_datetime)<new Date;return!!(s&&c&&!t?.client_rating)},W=t=>S(t),w=()=>{S(null),k({rating:0,template_selections:[],comment:""})},X=t=>{k(a=>({...a,template_selections:a.template_selections.includes(t)?a.template_selections.filter(s=>s!==t):[...a.template_selections,t]}))},J=async()=>{if(!j||i.rating<1||i.rating>5){n.error("Please select a rating (1–5 stars).");return}R(!0);try{await le(j.id,{rating:i.rating,template_selections:i.template_selections,comment:i.comment.slice(0,1e3)}),n.success("Rating submitted."),w(),b(t=>t.map(a=>a.id===j.id?{...a,client_rating:!0}:a))}catch(t){n.error(t.response?.data?.message||"Failed to submit rating.")}finally{R(!1)}},K=(t,a)=>{const s=new Date(t),c=new Date(a);return Math.ceil((c-s)/(1e3*60*60*24))};if(E||h.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-950 dark:via-gray-900 dark:to-black pt-24 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-t-teal-500"})});const p=h[0]?.car||q;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-950 dark:via-gray-900 dark:to-black pt-24 pb-12",children:[e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs(d.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onClick:()=>r("/Mycars-bookings"),className:"flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-teal-600 dark:hover:text-teal-400 mb-6 transition-colors",children:[e.jsx(de,{className:"w-5 h-5"}),"Back to Bookings"]}),h.map((t,a)=>{const s=t.client||{},c=s.profile||{},Q=je(t.booking_request_status),_=t.booking_request_status==="confirmed"||t.booking_request_status==="accepted",F=s.id_card_front_url||s.id_card_front,I=s.id_card_back_url||s.id_card_back,L=c.driver_license_url||c.driver_license,M=s.profile_picture_url||s.profile_picture;return e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.05},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-8",children:[e.jsx("div",{className:"p-6 text-white",style:{background:`linear-gradient(135deg, ${l.teal}, ${l.darkBlue})`},children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[p?.main_image_url&&e.jsx("img",{src:y(p.main_image_url),alt:"",className:"w-16 h-12 object-cover rounded-lg border-2 border-white/30"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:[p?.make," ",p?.model]}),e.jsxs("p",{className:"text-sm opacity-90",children:[p?.year," • ",G(t.start_datetime)," – ",G(t.end_datetime)]})]})]}),e.jsx("span",{className:"px-4 py-2 rounded-xl font-bold text-sm shrink-0",style:{background:"rgba(255,255,255,0.2)",color:"white"},children:Q.label})]})}),e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5",style:{color:l.teal}}),"Client Verification"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 px-3 py-2 border-b border-gray-200 dark:border-gray-600",children:"Profile Photo"}),e.jsx("div",{className:"aspect-square flex items-center justify-center p-2",children:M?e.jsx("img",{src:y(M),alt:"Profile",className:"w-full h-full object-cover rounded-lg"}):e.jsx(C,{className:"w-16 h-16 text-gray-300 dark:text-gray-600"})})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 px-3 py-2 border-b border-gray-200 dark:border-gray-600",children:"ID Card (Front)"}),e.jsx("div",{className:"aspect-[4/3] flex items-center justify-center p-2",children:F?e.jsx("img",{src:y(F),alt:"ID Front",className:"w-full h-full object-contain rounded-lg"}):e.jsx(P,{className:"w-12 h-12 text-gray-300 dark:text-gray-600"})})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 px-3 py-2 border-b border-gray-200 dark:border-gray-600",children:"ID Card (Back)"}),e.jsx("div",{className:"aspect-[4/3] flex items-center justify-center p-2",children:I?e.jsx("img",{src:y(I),alt:"ID Back",className:"w-full h-full object-contain rounded-lg"}):e.jsx(P,{className:"w-12 h-12 text-gray-300 dark:text-gray-600"})})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 overflow-hidden bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 px-3 py-2 border-b border-gray-200 dark:border-gray-600",children:"Driver License"}),e.jsx("div",{className:"aspect-[4/3] flex items-center justify-center p-2",children:L?e.jsx("img",{src:y(L),alt:"Driver License",className:"w-full h-full object-contain rounded-lg"}):e.jsx(me,{className:"w-12 h-12 text-gray-300 dark:text-gray-600"})})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5",style:{color:l.teal}}),"Client Details"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(m,{icon:C,label:"Name",value:`${s.first_name||""} ${s.last_name||""}`.trim()||"N/A"}),e.jsx(m,{icon:te,label:"Email",value:s.email||"N/A"}),e.jsx(m,{icon:re,label:"Phone",value:_?s.phone_number||"N/A":"Hidden until booking accepted",muted:!_}),e.jsx(m,{icon:ae,label:"City",value:s.city||"N/A"}),e.jsx(m,{icon:ge,label:"Profession",value:c.profession||"N/A"}),e.jsx(m,{icon:xe,label:"License #",value:c.license_number||"N/A"})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5",style:{color:l.teal}}),"Rental & Payment"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 p-4 bg-gray-50/50 dark:bg-gray-900/30",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Period"}),e.jsxs("p",{className:"font-semibold",children:[T(t.start_datetime)," – ",T(t.end_datetime)]}),e.jsxs("p",{className:"text-sm mt-2",style:{color:l.teal},children:[K(t.start_datetime,t.end_datetime)," days"]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 p-4 bg-gray-50/50 dark:bg-gray-900/30",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total / Net"}),e.jsxs("p",{className:"font-bold text-lg",style:{color:l.limeGreen},children:["$",t.total_booking_price??"0.00"]}),t.app_fees_amount!=null&&e.jsxs("p",{className:"text-sm",style:{color:l.teal},children:["Net: $",(parseFloat(t.total_booking_price||0)-(t.app_fees_amount||0)).toFixed(2)]})]})]}),t.needs_delivery&&e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Delivery requested"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Pickup: ",ke(t.pickup_location)]})]}),t.booking_request_status==="pending"&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(d.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>U(t.id),disabled:v===t.id,className:"flex-1 py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 text-white disabled:opacity-50",style:{background:`linear-gradient(135deg, ${l.limeGreen}, ${l.teal})`},children:[e.jsx(be,{className:"w-5 h-5"}),v===t.id?"Processing...":"Accept Booking"]}),e.jsxs(d.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>z(t.id),disabled:v===t.id,className:"flex-1 py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 bg-red-500 hover:bg-red-600 text-white disabled:opacity-50",children:[e.jsx(pe,{className:"w-5 h-5"}),"Reject"]})]}),_&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(d.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>r("/BookingChat",{state:{bookingId:t.id}}),className:"w-full sm:w-auto py-3 px-6 rounded-xl font-bold flex items-center justify-center gap-2 bg-sky-500 hover:bg-sky-600 text-white",children:[e.jsx(ye,{className:"w-5 h-5"}),"Chat with client"]})}),V(t)&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(d.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>W(t),className:"py-2.5 px-4 rounded-xl font-bold text-white",style:{background:`linear-gradient(135deg, ${l.teal}, ${l.darkBlue})`},children:"Rate client"})})]})]},t.id)})]}),e.jsx(ie,{open:!!j,onOpenChange:t=>!t&&w(),children:e.jsxs(oe,{className:"sm:max-w-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:[e.jsx(ne,{children:e.jsx(ce,{children:"Rate client"})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Rating *"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(t=>e.jsx("button",{type:"button",onClick:()=>k(a=>({...a,rating:t})),className:`p-2 rounded-lg border-2 ${i.rating>=t?"border-amber-400 bg-amber-50":"border-gray-200"}`,children:e.jsx(ue,{className:`w-6 h-6 ${i.rating>=t?"fill-amber-400 text-amber-400":"text-gray-400"}`})},t))})]}),$.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(t=>e.jsx("button",{type:"button",onClick:()=>X(t.id),className:`px-3 py-1.5 rounded-full text-sm border-2 ${i.template_selections.includes(t.id)?"border-teal-500 bg-teal-50":"border-gray-200"}`,children:t.label},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Comment"}),e.jsx("textarea",{value:i.comment,onChange:t=>k(a=>({...a,comment:t.target.value.slice(0,1e3)})),rows:3,className:"w-full px-3 py-2 rounded-xl border dark:bg-gray-900 dark:border-gray-600"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:w,className:"flex-1 py-2.5 rounded-xl border border-gray-200",children:"Cancel"}),e.jsx("button",{type:"button",onClick:J,disabled:A||i.rating<1,className:"flex-1 py-2.5 rounded-xl font-bold text-white disabled:opacity-50",style:{background:l.teal},children:A?"Submitting…":"Submit"})]})]})]})})]})}function m({icon:r,label:g,value:N,muted:x}){return e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-600 p-3 bg-gray-50/50 dark:bg-gray-900/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(r,{className:"w-4 h-4 text-gray-500"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:g})]}),e.jsx("p",{className:`font-semibold text-sm truncate ${x?"text-gray-400 italic":""}`,children:N||"N/A"})]})}export{qe as AgentBookingDetailPage};
