{"version":3,"file":"BookingChatSystem-QzOo2fZH.js","sources":["../../src/pages/BookingChatSystem.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport Echo from 'laravel-echo';\r\nimport Pusher from 'pusher-js';\r\nimport {\r\n  MessageCircle, Send, Phone, Mail, Calendar, Car, Check, CheckCheck,\r\n  Paperclip, Search, MoreVertical, Star, MapPin, Clock, User, Smile,\r\n  Image as ImageIcon, X, ChevronRight, TrendingUp, Shield\r\n} from 'lucide-react';\r\nimport api from '@/lib/axios';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\n// Logo colors\r\nconst COLORS = {\r\n  darkBlue: '#0E4C81',\r\n  teal: '#008C95',\r\n  limeGreen: '#8AC640',\r\n  darkBlueDim: 'rgba(14, 76, 129, 0.1)',\r\n  tealDim: 'rgba(0, 140, 149, 0.1)',\r\n  limeGreenDim: 'rgba(138, 198, 64, 0.1)',\r\n};\r\n\r\nexport function BookingChatSystem() {\r\n  const [bookings, setBookings] = useState([]);\r\n  const [selectedBooking, setSelectedBooking] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingBookings, setLoadingBookings] = useState(true);\r\n  const [typing, setTyping] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  const chatContainerRef = useRef(null);\r\n  const messagesEndRef = useRef(null);\r\n  const echoRef = useRef(null);\r\n  const currentUserId = useRef(null);\r\n  const location = useLocation();\r\n  const initialBookingIdRef = useRef(location.state?.bookingId ?? null);\r\n\r\n  const [token] = useState(() => localStorage.getItem('token'));\r\n\r\n  // Debug logging\r\n  useEffect(() => {\r\n    console.log('Token:', token);\r\n    console.log('API Base:', import.meta.env.VITE_API_BASE_URL);\r\n  }, []);\r\n\r\n  // ✅ Normalize incoming broadcast payload to match your UI expectations\r\n  const normalizeIncomingMessage = (payload) => {\r\n    // Your backend event (broadcastWith) returns a FLAT payload (not { message: ... })\r\n    // So we normalize it into the message shape used by your UI.\r\n    const createdAt = payload?.created_at ?? payload?.createdAt ?? payload?.data?.created_at ?? null;\r\n\r\n    return {\r\n      id: payload?.id ?? payload?.data?.id ?? `rt-${Date.now()}`,\r\n      booking_id: payload?.booking_id ?? payload?.data?.booking_id ?? selectedBooking?.id,\r\n      sender_id: payload?.sender_id ?? payload?.data?.sender_id ?? payload?.sender?.id,\r\n      receiver_id: payload?.receiver_id ?? payload?.data?.receiver_id ?? null,\r\n      message: payload?.message ?? payload?.data?.message ?? '',\r\n      read_at: payload?.read_at ?? payload?.data?.read_at ?? null,\r\n      created_at: createdAt,\r\n      // Keep sender object if backend sends it\r\n      sender: payload?.sender ?? payload?.data?.sender ?? null,\r\n    };\r\n  };\r\n\r\n  /** ------------------- INITIALIZATION ------------------- **/\r\n  useEffect(() => {\r\n    if (!token) {\r\n      console.error('No token found in localStorage');\r\n      setError('Authentication required. Please log in.');\r\n      return;\r\n    }\r\n\r\n    window.Pusher = Pusher;\r\n\r\n    echoRef.current = new Echo({\r\n      broadcaster: 'pusher',\r\n      key: import.meta.env.VITE_PUSHER_APP_KEY,\r\n      cluster: import.meta.env.VITE_PUSHER_APP_CLUSTER,\r\n      forceTLS: true,\r\n      encrypted: true,\r\n      enabledTransports: ['ws', 'wss'],\r\n      authEndpoint: `${import.meta.env.VITE_API_BASE_URL}/broadcasting/auth`,\r\n      auth: {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          Accept: 'application/json',\r\n        },\r\n      },\r\n    });\r\n\r\n    // ✅ CONNECTION LOGS\r\n    const pusher = echoRef.current.connector.pusher;\r\n\r\n    pusher.connection.bind('initialized', () => console.log('[PUSHER] initialized'));\r\n    pusher.connection.bind('connecting', () => console.log('[PUSHER] connecting...'));\r\n    pusher.connection.bind('connected', () => console.log('[PUSHER] ✅ connected'));\r\n    pusher.connection.bind('disconnected', () => console.log('[PUSHER] disconnected'));\r\n    pusher.connection.bind('unavailable', () => console.log('[PUSHER] unavailable'));\r\n    pusher.connection.bind('failed', () => console.log('[PUSHER] ❌ failed'));\r\n    pusher.connection.bind('error', (err) => console.error('[PUSHER] error:', err));\r\n\r\n    // ✅ Useful info\r\n    console.log('[ECHO] authEndpoint:', `${import.meta.env.VITE_API_BASE_URL}/broadcasting/auth`);\r\n    console.log('[ECHO] cluster:', import.meta.env.VITE_PUSHER_APP_CLUSTER);\r\n    console.log('[ECHO] key:', import.meta.env.VITE_PUSHER_APP_KEY);\r\n\r\n    api.get('/profile')\r\n      .then(({ data }) => {\r\n        currentUserId.current = data.user?.id;\r\n        console.log('Current user ID:', currentUserId.current);\r\n      })\r\n      .catch((err) => {\r\n        console.error('Failed to fetch profile:', err);\r\n        setError('Failed to load user profile');\r\n      });\r\n\r\n    return () => {\r\n      echoRef.current?.disconnect();\r\n    };\r\n  }, [token]);\r\n\r\n  /** ------------------- FETCH BOOKINGS ------------------- **/\r\n  useEffect(() => {\r\n    if (token) fetchBookings();\r\n  }, [token]);\r\n\r\n  const fetchBookings = async () => {\r\n    setLoadingBookings(true);\r\n    setError(null);\r\n    try {\r\n      const { data } = await api.get('/driver/bookings');\r\n      console.log('Bookings response:', data);\r\n      const all = data.data || [];\r\n      // Only show confirmed (or accepted) bookings in chat\r\n      const confirmedOnly = all.filter(\r\n        (b) => b.booking_request_status === 'confirmed' || b.booking_request_status === 'accepted'\r\n      );\r\n      setBookings(confirmedOnly);\r\n    } catch (err) {\r\n      console.error('Failed to fetch bookings:', err);\r\n      setError('Failed to load bookings');\r\n      setBookings([]);\r\n    } finally {\r\n      setLoadingBookings(false);\r\n    }\r\n  };\r\n\r\n  // If navigated here with a specific bookingId in location.state, auto-select that booking once bookings are loaded\r\n  useEffect(() => {\r\n    if (!bookings.length) return;\r\n    const targetId = initialBookingIdRef.current ?? location.state?.bookingId;\r\n    if (!targetId) return;\r\n    if (selectedBooking && String(selectedBooking.id) === String(targetId)) return;\r\n    const found = bookings.find((b) => String(b.id) === String(targetId));\r\n    if (found) {\r\n      setSelectedBooking(found);\r\n    }\r\n  }, [bookings, selectedBooking, location.state]);\r\n\r\n  /** ------------------- SCROLL TO BOTTOM ------------------- **/\r\n  const scrollToBottom = () => {\r\n    const container = chatContainerRef.current;\r\n    if (!container) return;\r\n    container.scrollTop = container.scrollHeight;\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  /** ------------------- LOAD MESSAGES ------------------- **/\r\n  const loadMessages = async (bookingId) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const { data } = await api.get(`/bookings/${bookingId}/chat`);\r\n      const messagesArray = data.data?.data || data.data?.messages || [];\r\n      setMessages(messagesArray);\r\n\r\n      messagesArray.forEach((msg) => {\r\n        if (!msg.read_at && msg.sender_id !== currentUserId.current) {\r\n          markMessageAsRead(msg.id);\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error('Failed to load messages:', err);\r\n      setError('Failed to load messages');\r\n      setMessages([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /** ------------------- ECHO REAL-TIME SETUP ------------------- **/\r\n  useEffect(() => {\r\n    if (!selectedBooking?.id || !echoRef.current) return;\r\n\r\n    const bookingId = selectedBooking.id;\r\n\r\n    // Echo private('booking.1') => Pusher channel is actually \"private-booking.1\"\r\n    const pusherChannelName = `private-booking.${bookingId}`;\r\n\r\n    console.log('[ECHO] subscribing to:', pusherChannelName);\r\n\r\n    const pusher = echoRef.current.connector.pusher;\r\n\r\n    // ✅ subscribe manually to capture subscription status\r\n    const raw = pusher.subscribe(pusherChannelName);\r\n\r\n    raw.bind('pusher:subscription_succeeded', () => {\r\n      console.log('[PUSHER] ✅ subscription_succeeded:', pusherChannelName);\r\n    });\r\n\r\n    raw.bind('pusher:subscription_error', (status) => {\r\n      console.error('[PUSHER] ❌ subscription_error:', pusherChannelName, 'status:', status);\r\n      console.error('-> If status=403, your /broadcasting/auth or channels.php auth is rejecting the user.');\r\n    });\r\n\r\n    // ✅ listen via Echo (normal way) — single listener to avoid duplicate events\r\n    const channel = echoRef.current.private(`booking.${bookingId}`);\r\n\r\n    const handleMessageSent = (payload) => {\r\n      const normalized = normalizeIncomingMessage(payload, bookingId);\r\n      // Dedupe: don't add if we already have this message (e.g. added from API after send)\r\n      setMessages((prev) => {\r\n        const exists = prev.some((m) => String(m.id) === String(normalized.id));\r\n        if (exists) return prev;\r\n        return [...prev, normalized];\r\n      });\r\n      if (normalized.sender_id && normalized.sender_id !== currentUserId.current) {\r\n        markMessageAsRead(bookingId, normalized.id);\r\n      }\r\n    };\r\n\r\n    channel.listen('.message.sent', handleMessageSent);\r\n    channel.listen('message.sent', handleMessageSent);\r\n\r\n\r\n    // (Optional) keep these logs (won't break anything)\r\n    channel.listen('.message.read', (e) => console.log('[ECHO] message.read:', e));\r\n\r\n    loadMessages(bookingId);\r\n\r\n    return () => {\r\n      console.log('[ECHO] leaving:', pusherChannelName);\r\n      echoRef.current?.leave(`booking.${bookingId}`);\r\n      pusher.unsubscribe(pusherChannelName);\r\n    };\r\n  }, [selectedBooking?.id]);\r\n\r\n  /** ------------------- SEND MESSAGE ------------------- **/\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedBooking) return;\r\n\r\n    const messageText = newMessage.trim();\r\n    setNewMessage('');\r\n\r\n    try {\r\n      const { data } = await api.post(`/bookings/${selectedBooking.id}/chat`, {\r\n        booking_id: selectedBooking.id,\r\n        message: messageText,\r\n      });\r\n\r\n      if (data.data) {\r\n        setMessages((prev) => [...prev, data.data]);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to send message:', err);\r\n      setError('Failed to send message');\r\n      setNewMessage(messageText);\r\n    }\r\n  };\r\n\r\n  /** ------------------- MARK MESSAGE AS READ ------------------- **/\r\n  const markMessageAsRead = async (messageId) => {\r\n    try {\r\n      await api.post(`/bookings/${selectedBooking?.id}/chat/mark-read`, {\r\n        message_id: messageId,\r\n      });\r\n    } catch (err) {\r\n      console.error('Failed to mark message as read:', err);\r\n    }\r\n  };\r\n\r\n  /** ------------------- FETCH UNREAD COUNT ------------------- **/\r\n  const fetchUnreadCounts = async () => {\r\n    try {\r\n      if (!bookings?.length) return;\r\n\r\n      const results = await Promise.all(\r\n        bookings.map(async (booking) => {\r\n          try {\r\n            const { data } = await api.get(`/bookings/${booking.id}/chat/unread-count`);\r\n            const count =\r\n              data?.data?.unread_count ??\r\n              data?.data ??\r\n              data?.unread_count ??\r\n              0;\r\n\r\n            return { id: booking.id, count: Number(count) || 0 };\r\n          } catch (e) {\r\n            console.error(`Failed unread count for booking ${booking.id}:`, e);\r\n            return { id: booking.id, count: 0 };\r\n          }\r\n        })\r\n      );\r\n\r\n      const countsById = Object.fromEntries(results.map((r) => [r.id, r.count]));\r\n\r\n      setBookings((prev) =>\r\n        prev.map((b) => ({\r\n          ...b,\r\n          unread_count: countsById[b.id] ?? 0,\r\n        }))\r\n      );\r\n    } catch (err) {\r\n      console.error('Failed to fetch unread counts:', err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      fetchUnreadCounts();\r\n      const interval = setInterval(fetchUnreadCounts, 10000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [token]);\r\n\r\n  /** ------------------- TYPING INDICATOR ------------------- **/\r\n  const typingTimeoutRef = useRef(null);\r\n\r\n  const handleTyping = () => {\r\n    if (!selectedBooking) return;\r\n\r\n    api.post(`/bookings/${selectedBooking.id}/chat/typing`)\r\n      .catch((err) => console.error('Failed to send typing indicator:', err));\r\n\r\n    if (echoRef.current) {\r\n      echoRef.current.private(`booking.${selectedBooking.id}`).whisper('typing', {\r\n        user_id: currentUserId.current,\r\n      });\r\n    }\r\n\r\n    if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n\r\n    typingTimeoutRef.current = setTimeout(() => {\r\n      setTyping(false);\r\n    }, 3000);\r\n  };\r\n\r\n  /** ------------------- TIME FORMAT ------------------- **/\r\n  const formatTime = (dateString) => {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    if (Number.isNaN(date.getTime())) return '';\r\n\r\n    const now = new Date();\r\n    const diffInMinutes = Math.floor((now - date) / 60000);\r\n\r\n    if (diffInMinutes < 1) return 'Just now';\r\n    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\r\n    const diffInHours = Math.floor(diffInMinutes / 60);\r\n    if (diffInHours < 24) return `${diffInHours}h ago`;\r\n    const diffInDays = Math.floor(diffInHours / 24);\r\n    if (diffInDays < 7) return `${diffInDays}d ago`;\r\n\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const formatDateTime = (dateString) => {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    if (Number.isNaN(date.getTime())) return '';\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  // Filter bookings\r\n  const filteredBookings = bookings.filter((booking) => {\r\n    if (!searchQuery) return true;\r\n    const query = searchQuery.toLowerCase();\r\n    const clientName = `${booking.client?.first_name || ''} ${booking.client?.last_name || ''}`.toLowerCase();\r\n    const carName = `${booking.car?.make || ''} ${booking.car?.model || ''}`.toLowerCase();\r\n    return clientName.includes(query) || carName.includes(query);\r\n  });\r\n\r\n  /** ------------------- JSX ------------------- **/\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-black dark:via-gray-900 dark:to-gray-950 pt-20\">\r\n      <div className=\"container mx-auto px-4 py-6\">\r\n\r\n        {/* Header */}\r\n        <motion.div\r\n          initial={{ opacity: 0, y: -20 }}\r\n          animate={{ opacity: 1, y: 0 }}\r\n          className=\"mb-6\"\r\n        >\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div\r\n              className=\"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg\"\r\n              style={{ background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` }}\r\n            >\r\n              <MessageCircle className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <div>\r\n              <h1\r\n                className=\"text-3xl font-bold bg-clip-text text-transparent\"\r\n                style={{ backgroundImage: `linear-gradient(135deg, ${COLORS.darkBlue}, ${COLORS.teal}, ${COLORS.limeGreen})` }}\r\n              >\r\n                Booking Messages\r\n              </h1>\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Stay connected with your clients</p>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Error Banner */}\r\n        <AnimatePresence>\r\n          {error && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className=\"mb-4 p-4 rounded-xl border-2\"\r\n              style={{ background: 'rgba(220, 38, 38, 0.1)', borderColor: '#DC2626' }}\r\n            >\r\n              <p className=\"text-red-800 dark:text-red-200 flex items-center gap-2\">\r\n                <X className=\"w-5 h-5\" />\r\n                {error}\r\n              </p>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 h-[calc(100vh-180px)]\">\r\n\r\n          {/* Bookings List */}\r\n          <div className=\"lg:col-span-1 bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700\">\r\n\r\n            {/* Search Header */}\r\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search conversations...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 dark:text-white text-sm\"\r\n                  style={{ focusRing: COLORS.teal }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Bookings List */}\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {loadingBookings ? (\r\n                <div className=\"flex justify-center items-center h-full\">\r\n                  <div\r\n                    className=\"animate-spin rounded-full h-10 w-10 border-4 border-t-transparent\"\r\n                    style={{ borderColor: COLORS.tealDim, borderTopColor: 'transparent' }}\r\n                  />\r\n                </div>\r\n              ) : filteredBookings.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-full p-8 text-gray-400\">\r\n                  <MessageCircle className=\"w-16 h-16 mb-3\" style={{ color: COLORS.teal, opacity: 0.3 }} />\r\n                  <p className=\"text-center font-medium\">No bookings found</p>\r\n                  <p className=\"text-xs text-center mt-1\">Try adjusting your search</p>\r\n                </div>\r\n              ) : (\r\n                filteredBookings.map((booking) => (\r\n                  <motion.div\r\n                    key={booking.id}\r\n                    whileHover={{ x: 5 }}\r\n                    onClick={() => setSelectedBooking(booking)}\r\n                    className={`p-4 border-b border-gray-200 dark:border-gray-700 cursor-pointer transition-all ${\r\n                      selectedBooking?.id === booking.id\r\n                        ? 'border-l-4'\r\n                        : 'hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                    }`}\r\n                    style={selectedBooking?.id === booking.id ? {\r\n                      background: COLORS.tealDim,\r\n                      borderLeftColor: COLORS.teal\r\n                    } : {}}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <div className=\"relative\">\r\n                        <img\r\n                          src={booking.client?.profile_picture\r\n                            ? `/api/storage/${booking.client.profile_picture}`\r\n                            : '/default-avatar.png'}\r\n                          alt={booking.client?.first_name || 'Client'}\r\n                          className=\"w-12 h-12 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                        />\r\n                        {booking.unread_count > 0 && (\r\n                          <motion.div\r\n                            animate={{ scale: [1, 1.2, 1] }}\r\n                            transition={{ duration: 1, repeat: Infinity }}\r\n                            className=\"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-lg\"\r\n                            style={{ background: COLORS.limeGreen }}\r\n                          >\r\n                            <span className=\"text-xs text-white font-bold\">{booking.unread_count}</span>\r\n                          </motion.div>\r\n                        )}\r\n                      </div>\r\n                      <div className=\"flex-1 min-w-0\">\r\n                        <div className=\"flex items-center justify-between mb-1\">\r\n                          <h3 className=\"font-semibold text-gray-900 dark:text-white truncate flex items-center gap-1\">\r\n                            {booking.client?.first_name || 'N/A'} {booking.client?.last_name || ''}\r\n                            {booking.client?.verified_by_admin && (\r\n                              <Shield className=\"w-3 h-3\" style={{ color: COLORS.teal }} />\r\n                            )}\r\n                          </h3>\r\n                          {booking.unread_count > 0 && (\r\n                            <ChevronRight className=\"w-4 h-4\" style={{ color: COLORS.teal }} />\r\n                          )}\r\n                        </div>\r\n                        <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate flex items-center gap-1\">\r\n                          <Car className=\"w-3 h-3\" />\r\n                          {booking.car?.make || 'N/A'} {booking.car?.model || ''}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </motion.div>\r\n                ))\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Chat Area */}\r\n          <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700\">\r\n            {selectedBooking ? (\r\n              <>\r\n                {/* Chat Header */}\r\n                <div\r\n                  className=\"p-4 text-white relative overflow-hidden\"\r\n                  style={{ background: `linear-gradient(135deg, ${COLORS.darkBlue}, ${COLORS.teal}, ${COLORS.limeGreen})` }}\r\n                >\r\n                  <div className=\"absolute top-0 right-0 w-48 h-48 bg-white/10 rounded-full blur-3xl\"></div>\r\n                  <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full blur-2xl\"></div>\r\n\r\n                  <div className=\"relative z-10\">\r\n                    <div className=\"flex items-center justify-between mb-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <img\r\n                          src={selectedBooking.client?.profile_picture\r\n                            ? `/api/storage/${selectedBooking.client.profile_picture}`\r\n                            : '/default-avatar.png'}\r\n                          alt={selectedBooking.client?.first_name || 'Client'}\r\n                          className=\"w-12 h-12 rounded-full object-cover border-2 border-white shadow-lg\"\r\n                        />\r\n                        <div>\r\n                          <h2 className=\"text-lg font-bold flex items-center gap-2\">\r\n                            {selectedBooking.client?.first_name || 'N/A'} {selectedBooking.client?.last_name || ''}\r\n                            {selectedBooking.client?.verified_by_admin && (\r\n                              <Shield className=\"w-4 h-4\" />\r\n                            )}\r\n                          </h2>\r\n                          <p className=\"text-xs opacity-90\">@{selectedBooking.client?.username || 'unknown'}</p>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {selectedBooking.client?.phone_number && (\r\n                          <motion.a\r\n                            whileHover={{ scale: 1.1 }}\r\n                            whileTap={{ scale: 0.9 }}\r\n                            href={`tel:${selectedBooking.client.phone_number}`}\r\n                            className=\"p-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors\"\r\n                          >\r\n                            <Phone className=\"w-4 h-4\" />\r\n                          </motion.a>\r\n                        )}\r\n                        {selectedBooking.client?.email && (\r\n                          <motion.a\r\n                            whileHover={{ scale: 1.1 }}\r\n                            whileTap={{ scale: 0.9 }}\r\n                            href={`mailto:${selectedBooking.client.email}`}\r\n                            className=\"p-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors\"\r\n                          >\r\n                            <Mail className=\"w-4 h-4\" />\r\n                          </motion.a>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"p-3 bg-white/10 backdrop-blur-sm rounded-xl\">\r\n                      <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Car className=\"w-4 h-4\" />\r\n                          <span className=\"truncate\">{selectedBooking.car?.make || 'N/A'} {selectedBooking.car?.model || ''}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Calendar className=\"w-4 h-4\" />\r\n                          <span className=\"truncate\">{selectedBooking.start_datetime ? formatDateTime(selectedBooking.start_datetime) : 'N/A'}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Messages */}\r\n                <div\r\n                  ref={chatContainerRef}\r\n                  className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50/50 to-white dark:from-gray-900/50 dark:to-gray-800\"\r\n                  style={{ maxHeight: 'calc(100vh - 450px)' }}\r\n                >\r\n                  {loading ? (\r\n                    <div className=\"flex justify-center items-center h-full\">\r\n                      <div\r\n                        className=\"animate-spin rounded-full h-10 w-10 border-4 border-t-transparent\"\r\n                        style={{ borderColor: COLORS.tealDim, borderTopColor: 'transparent' }}\r\n                      />\r\n                    </div>\r\n                  ) : messages.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\r\n                      <div\r\n                        className=\"w-20 h-20 rounded-full flex items-center justify-center mb-4\"\r\n                        style={{ background: COLORS.tealDim }}\r\n                      >\r\n                        <MessageCircle className=\"w-10 h-10\" style={{ color: COLORS.teal }} />\r\n                      </div>\r\n                      <p className=\"text-lg font-medium\">No messages yet</p>\r\n                      <p className=\"text-sm\">Start the conversation!</p>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      {messages.map((message, index) => {\r\n                        const isOwner =\r\n                          message.sender_id === currentUserId.current ||\r\n                          message.sender?.id === currentUserId.current;\r\n\r\n                        const showAvatar =\r\n                          index === 0 || messages[index - 1].sender_id !== message.sender_id;\r\n\r\n                        return (\r\n                          <motion.div\r\n                            key={message.id}\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            className={`flex items-end gap-2 ${isOwner ? 'justify-end' : 'justify-start'}`}\r\n                          >\r\n                            {!isOwner && showAvatar && (\r\n                              <img\r\n                                src={message.sender?.profile_picture\r\n                                  ? `/api/storage/${message.sender.profile_picture}`\r\n                                  : '/default-avatar.png'}\r\n                                alt={message.sender?.first_name || 'User'}\r\n                                className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                              />\r\n                            )}\r\n                            {!isOwner && !showAvatar && <div className=\"w-8\"></div>}\r\n\r\n                            <div className={`flex flex-col ${isOwner ? 'items-end' : 'items-start'} max-w-[70%]`}>\r\n                              <motion.div\r\n                                whileHover={{ scale: 1.02 }}\r\n                                className={`rounded-2xl px-4 py-2 shadow-md ${\r\n                                  isOwner\r\n                                    ? 'text-white rounded-br-none'\r\n                                    : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-none border border-gray-200 dark:border-gray-600'\r\n                                }`}\r\n                                style={isOwner ? { background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` } : {}}\r\n                              >\r\n                                <p className=\"text-sm whitespace-pre-wrap break-words leading-relaxed\">{message.message}</p>\r\n                              </motion.div>\r\n                              <div className=\"flex items-center gap-1 mt-1 px-1\">\r\n                                <span className=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                                  {formatTime(message.created_at)}\r\n                                </span>\r\n                                {isOwner && (\r\n                                  <span>\r\n                                    {message.read_at ? (\r\n                                      <CheckCheck className=\"w-3 h-3\" style={{ color: COLORS.teal }} />\r\n                                    ) : (\r\n                                      <Check className=\"w-3 h-3 text-gray-400\" />\r\n                                    )}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n\r\n                            {isOwner && showAvatar && (\r\n                              <img\r\n                                src={message.sender?.profile_picture\r\n                                  ? `/api/storage/${message.sender.profile_picture}`\r\n                                  : '/default-avatar.png'}\r\n                                alt={message.sender?.first_name || 'You'}\r\n                                className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                              />\r\n                            )}\r\n                            {isOwner && !showAvatar && <div className=\"w-8\"></div>}\r\n                          </motion.div>\r\n                        );\r\n                      })}\r\n                      <div ref={messagesEndRef} />\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Typing Indicator */}\r\n                  <AnimatePresence>\r\n                    {typing && (\r\n                      <motion.div\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        className=\"flex items-center gap-2\"\r\n                      >\r\n                        <img\r\n                          src={selectedBooking.client?.profile_picture\r\n                            ? `/api/storage/${selectedBooking.client.profile_picture}`\r\n                            : '/default-avatar.png'}\r\n                          alt={selectedBooking.client?.first_name || 'Client'}\r\n                          className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                        />\r\n                        <div className=\"bg-white dark:bg-gray-700 rounded-2xl rounded-bl-none px-4 py-3 border border-gray-200 dark:border-gray-600\">\r\n                          <div className=\"flex gap-1\">\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.teal, animationDelay: '0ms' }}></div>\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.darkBlue, animationDelay: '150ms' }}></div>\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.limeGreen, animationDelay: '300ms' }}></div>\r\n                          </div>\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </div>\r\n\r\n                {/* Message Input */}\r\n                <div className=\"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\r\n                  <div className=\"flex items-end gap-2\">\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.1 }}\r\n                      whileTap={{ scale: 0.9 }}\r\n                      onClick={() => console.log('Attach file')}\r\n                      className=\"p-2 rounded-xl transition-colors\"\r\n                      style={{ background: COLORS.tealDim, color: COLORS.teal }}\r\n                    >\r\n                      <Paperclip className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.1 }}\r\n                      whileTap={{ scale: 0.9 }}\r\n                      onClick={() => console.log('Send emoji')}\r\n                      className=\"p-2 rounded-xl transition-colors\"\r\n                      style={{ background: COLORS.limeGreenDim, color: COLORS.limeGreen }}\r\n                    >\r\n                      <Smile className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n                    <div className=\"flex-1 relative\">\r\n                      <textarea\r\n                        value={newMessage}\r\n                        onChange={(e) => {\r\n                          setNewMessage(e.target.value);\r\n                          // handleTyping();\r\n                        }}\r\n                        onKeyPress={(e) => {\r\n                          if (e.key === 'Enter' && !e.shiftKey) {\r\n                            e.preventDefault();\r\n                            sendMessage(e);\r\n                          }\r\n                        }}\r\n                        placeholder=\"Type your message...\"\r\n                        rows={1}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 dark:bg-gray-700 dark:text-white resize-none\"\r\n                        style={{ focusRing: COLORS.teal }}\r\n                      />\r\n                    </div>\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.05 }}\r\n                      whileTap={{ scale: 0.95 }}\r\n                      onClick={sendMessage}\r\n                      disabled={!newMessage.trim()}\r\n                      className=\"p-3 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl\"\r\n                      style={{ background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` }}\r\n                    >\r\n                      <Send className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n                  </div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <div className=\"flex-1 flex flex-col items-center justify-center\">\r\n                <motion.div\r\n                  initial={{ scale: 0.9, opacity: 0 }}\r\n                  animate={{ scale: 1, opacity: 1 }}\r\n                  className=\"text-center\"\r\n                >\r\n                  <div\r\n                    className=\"w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto\"\r\n                    style={{ background: `linear-gradient(135deg, ${COLORS.tealDim}, ${COLORS.limeGreenDim})` }}\r\n                  >\r\n                    <MessageCircle className=\"w-12 h-12\" style={{ color: COLORS.teal }} />\r\n                  </div>\r\n                  <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\r\n                    Select a Booking\r\n                  </h3>\r\n                  <p className=\"text-gray-600 dark:text-gray-400\">\r\n                    Choose a conversation to start chatting\r\n                  </p>\r\n                </motion.div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["COLORS","BookingChatSystem","bookings","setBookings","useState","selectedBooking","setSelectedBooking","messages","setMessages","newMessage","setNewMessage","loading","setLoading","loadingBookings","setLoadingBookings","typing","setTyping","error","setError","searchQuery","setSearchQuery","chatContainerRef","useRef","messagesEndRef","echoRef","currentUserId","location","useLocation","initialBookingIdRef","token","useEffect","normalizeIncomingMessage","payload","createdAt","Pusher","Echo","pusher","err","api","data","fetchBookings","confirmedOnly","b","targetId","found","scrollToBottom","container","loadMessages","bookingId","messagesArray","msg","markMessageAsRead","pusherChannelName","raw","status","channel","handleMessageSent","normalized","prev","m","e","sendMessage","messageText","messageId","fetchUnreadCounts","results","booking","count","countsById","r","interval","formatTime","dateString","date","diffInMinutes","diffInHours","diffInDays","formatDateTime","filteredBookings","query","clientName","carName","jsxs","jsx","motion","MessageCircle","AnimatePresence","X","Search","Shield","ChevronRight","Car","Fragment","Phone","Mail","Calendar","message","index","isOwner","showAvatar","CheckCheck","Check","Paperclip","Smile","Send"],"mappings":"8kBAaA,MAAMA,EAAS,CACb,SAAU,UACV,KAAM,UACN,UAAW,UAEX,QAAS,yBACT,aAAc,yBAChB,EAEO,SAASC,IAAoB,CAClC,KAAM,CAACC,EAAUC,CAAW,EAAIC,EAAAA,SAAS,CAAA,CAAE,EACrC,CAACC,EAAiBC,CAAkB,EAAIF,EAAAA,SAAS,IAAI,EACrD,CAACG,EAAUC,CAAW,EAAIJ,EAAAA,SAAS,CAAA,CAAE,EACrC,CAACK,EAAYC,CAAa,EAAIN,EAAAA,SAAS,EAAE,EACzC,CAACO,EAASC,CAAU,EAAIR,EAAAA,SAAS,EAAK,EACtC,CAACS,EAAiBC,CAAkB,EAAIV,EAAAA,SAAS,EAAI,EACrD,CAACW,EAAQC,EAAS,EAAIZ,EAAAA,SAAS,EAAK,EACpC,CAACa,EAAOC,CAAQ,EAAId,EAAAA,SAAS,IAAI,EACjC,CAACe,EAAaC,CAAc,EAAIhB,EAAAA,SAAS,EAAE,EAE3CiB,EAAmBC,EAAAA,OAAO,IAAI,EAC9BC,EAAiBD,EAAAA,OAAO,IAAI,EAC5BE,EAAUF,EAAAA,OAAO,IAAI,EACrBG,EAAgBH,EAAAA,OAAO,IAAI,EAC3BI,EAAWC,EAAA,EACXC,EAAsBN,EAAAA,OAAOI,EAAS,OAAO,WAAa,IAAI,EAE9D,CAACG,CAAK,EAAIzB,EAAAA,SAAS,IAAM,aAAa,QAAQ,OAAO,CAAC,EAG5D0B,EAAAA,UAAU,IAAM,CACd,QAAQ,IAAI,SAAUD,CAAK,EAC3B,QAAQ,IAAI,YAAa,8BAAiC,CAC5D,EAAG,CAAA,CAAE,EAGL,MAAME,EAA4BC,GAAY,CAG5C,MAAMC,EAAYD,GAAS,YAAcA,GAAS,WAAaA,GAAS,MAAM,YAAc,KAE5F,MAAO,CACL,GAAIA,GAAS,IAAMA,GAAS,MAAM,IAAM,MAAM,KAAK,IAAA,CAAK,GACxD,WAAYA,GAAS,YAAcA,GAAS,MAAM,YAAc3B,GAAiB,GACjF,UAAW2B,GAAS,WAAaA,GAAS,MAAM,WAAaA,GAAS,QAAQ,GAC9E,YAAaA,GAAS,aAAeA,GAAS,MAAM,aAAe,KACnE,QAASA,GAAS,SAAWA,GAAS,MAAM,SAAW,GACvD,QAASA,GAAS,SAAWA,GAAS,MAAM,SAAW,KACvD,WAAYC,EAEZ,OAAQD,GAAS,QAAUA,GAAS,MAAM,QAAU,IAAA,CAExD,EAGAF,EAAAA,UAAU,IAAM,CACd,GAAI,CAACD,EAAO,CACV,QAAQ,MAAM,gCAAgC,EAC9CX,EAAS,yCAAyC,EAClD,MACF,CAEA,OAAO,OAASgB,GAEhBV,EAAQ,QAAU,IAAIW,GAAK,CACzB,YAAa,SACb,IAAK,uBACL,QAAS,MACT,SAAU,GACV,UAAW,GACX,kBAAmB,CAAC,KAAM,KAAK,EAC/B,aAAc,iDACd,KAAM,CACJ,QAAS,CACP,cAAe,UAAUN,CAAK,GAC9B,OAAQ,kBAAA,CACV,CACF,CACD,EAGD,MAAMO,EAASZ,EAAQ,QAAQ,UAAU,OAEzC,OAAAY,EAAO,WAAW,KAAK,cAAe,IAAM,QAAQ,IAAI,sBAAsB,CAAC,EAC/EA,EAAO,WAAW,KAAK,aAAc,IAAM,QAAQ,IAAI,wBAAwB,CAAC,EAChFA,EAAO,WAAW,KAAK,YAAa,IAAM,QAAQ,IAAI,sBAAsB,CAAC,EAC7EA,EAAO,WAAW,KAAK,eAAgB,IAAM,QAAQ,IAAI,uBAAuB,CAAC,EACjFA,EAAO,WAAW,KAAK,cAAe,IAAM,QAAQ,IAAI,sBAAsB,CAAC,EAC/EA,EAAO,WAAW,KAAK,SAAU,IAAM,QAAQ,IAAI,mBAAmB,CAAC,EACvEA,EAAO,WAAW,KAAK,QAAUC,GAAQ,QAAQ,MAAM,kBAAmBA,CAAG,CAAC,EAG9E,QAAQ,IAAI,uBAAwB,gDAAwD,EAC5F,QAAQ,IAAI,kBAAmB,KAAuC,EACtE,QAAQ,IAAI,cAAe,sBAAmC,EAE9DC,EAAI,IAAI,UAAU,EACf,KAAK,CAAC,CAAE,KAAAC,KAAW,CAClBd,EAAc,QAAUc,EAAK,MAAM,GACnC,QAAQ,IAAI,mBAAoBd,EAAc,OAAO,CACvD,CAAC,EACA,MAAOY,GAAQ,CACd,QAAQ,MAAM,2BAA4BA,CAAG,EAC7CnB,EAAS,6BAA6B,CACxC,CAAC,EAEI,IAAM,CACXM,EAAQ,SAAS,WAAA,CACnB,CACF,EAAG,CAACK,CAAK,CAAC,EAGVC,EAAAA,UAAU,IAAM,CACVD,GAAOW,EAAA,CACb,EAAG,CAACX,CAAK,CAAC,EAEV,MAAMW,EAAgB,SAAY,CAChC1B,EAAmB,EAAI,EACvBI,EAAS,IAAI,EACb,GAAI,CACF,KAAM,CAAE,KAAAqB,CAAA,EAAS,MAAMD,EAAI,IAAI,kBAAkB,EACjD,QAAQ,IAAI,qBAAsBC,CAAI,EAGtC,MAAME,GAFMF,EAAK,MAAQ,CAAA,GAEC,OACvBG,GAAMA,EAAE,yBAA2B,aAAeA,EAAE,yBAA2B,UAAA,EAElFvC,EAAYsC,CAAa,CAC3B,OAASJ,EAAK,CACZ,QAAQ,MAAM,4BAA6BA,CAAG,EAC9CnB,EAAS,yBAAyB,EAClCf,EAAY,CAAA,CAAE,CAChB,QAAA,CACEW,EAAmB,EAAK,CAC1B,CACF,EAGAgB,EAAAA,UAAU,IAAM,CACd,GAAI,CAAC5B,EAAS,OAAQ,OACtB,MAAMyC,EAAWf,EAAoB,SAAWF,EAAS,OAAO,UAEhE,GADI,CAACiB,GACDtC,GAAmB,OAAOA,EAAgB,EAAE,IAAM,OAAOsC,CAAQ,EAAG,OACxE,MAAMC,EAAQ1C,EAAS,KAAMwC,GAAM,OAAOA,EAAE,EAAE,IAAM,OAAOC,CAAQ,CAAC,EAChEC,GACFtC,EAAmBsC,CAAK,CAE5B,EAAG,CAAC1C,EAAUG,EAAiBqB,EAAS,KAAK,CAAC,EAG9C,MAAMmB,EAAiB,IAAM,CAC3B,MAAMC,EAAYzB,EAAiB,QAC9ByB,IACLA,EAAU,UAAYA,EAAU,aAClC,EAEAhB,EAAAA,UAAU,IAAM,CACde,EAAA,CACF,EAAG,CAACtC,CAAQ,CAAC,EAGb,MAAMwC,EAAe,MAAOC,GAAc,CACxCpC,EAAW,EAAI,EACfM,EAAS,IAAI,EACb,GAAI,CACF,KAAM,CAAE,KAAAqB,GAAS,MAAMD,EAAI,IAAI,aAAaU,CAAS,OAAO,EACtDC,EAAgBV,EAAK,MAAM,MAAQA,EAAK,MAAM,UAAY,CAAA,EAChE/B,EAAYyC,CAAa,EAEzBA,EAAc,QAASC,GAAQ,CACzB,CAACA,EAAI,SAAWA,EAAI,YAAczB,EAAc,SAClD0B,EAAkBD,EAAI,EAAE,CAE5B,CAAC,CACH,OAASb,EAAK,CACZ,QAAQ,MAAM,2BAA4BA,CAAG,EAC7CnB,EAAS,yBAAyB,EAClCV,EAAY,CAAA,CAAE,CAChB,QAAA,CACEI,EAAW,EAAK,CAClB,CACF,EAGAkB,EAAAA,UAAU,IAAM,CACd,GAAI,CAACzB,GAAiB,IAAM,CAACmB,EAAQ,QAAS,OAE9C,MAAMwB,EAAY3C,EAAgB,GAG5B+C,EAAoB,mBAAmBJ,CAAS,GAEtD,QAAQ,IAAI,yBAA0BI,CAAiB,EAEvD,MAAMhB,EAASZ,EAAQ,QAAQ,UAAU,OAGnC6B,EAAMjB,EAAO,UAAUgB,CAAiB,EAE9CC,EAAI,KAAK,gCAAiC,IAAM,CAC9C,QAAQ,IAAI,qCAAsCD,CAAiB,CACrE,CAAC,EAEDC,EAAI,KAAK,4BAA8BC,GAAW,CAChD,QAAQ,MAAM,iCAAkCF,EAAmB,UAAWE,CAAM,EACpF,QAAQ,MAAM,uFAAuF,CACvG,CAAC,EAGD,MAAMC,EAAU/B,EAAQ,QAAQ,QAAQ,WAAWwB,CAAS,EAAE,EAExDQ,EAAqBxB,GAAY,CACrC,MAAMyB,EAAa1B,EAAyBC,CAAkB,EAE9DxB,EAAakD,GACIA,EAAK,KAAMC,GAAM,OAAOA,EAAE,EAAE,IAAM,OAAOF,EAAW,EAAE,CAAC,EACnDC,EACZ,CAAC,GAAGA,EAAMD,CAAU,CAC5B,EACGA,EAAW,WAAaA,EAAW,YAAchC,EAAc,SACjE0B,EAAkBH,EAAWS,EAAW,EAAE,CAE9C,EAEA,OAAAF,EAAQ,OAAO,gBAAiBC,CAAiB,EACjDD,EAAQ,OAAO,eAAgBC,CAAiB,EAIhDD,EAAQ,OAAO,gBAAkBK,GAAM,QAAQ,IAAI,uBAAwBA,CAAC,CAAC,EAE7Eb,EAAaC,CAAS,EAEf,IAAM,CACX,QAAQ,IAAI,kBAAmBI,CAAiB,EAChD5B,EAAQ,SAAS,MAAM,WAAWwB,CAAS,EAAE,EAC7CZ,EAAO,YAAYgB,CAAiB,CACtC,CACF,EAAG,CAAC/C,GAAiB,EAAE,CAAC,EAGxB,MAAMwD,EAAc,MAAOD,GAAM,CAE/B,GADAA,EAAE,eAAA,EACE,CAACnD,EAAW,KAAA,GAAU,CAACJ,EAAiB,OAE5C,MAAMyD,EAAcrD,EAAW,KAAA,EAC/BC,EAAc,EAAE,EAEhB,GAAI,CACF,KAAM,CAAE,KAAA6B,GAAS,MAAMD,EAAI,KAAK,aAAajC,EAAgB,EAAE,QAAS,CACtE,WAAYA,EAAgB,GAC5B,QAASyD,CAAA,CACV,EAEGvB,EAAK,MACP/B,EAAakD,GAAS,CAAC,GAAGA,EAAMnB,EAAK,IAAI,CAAC,CAE9C,OAASF,EAAK,CACZ,QAAQ,MAAM,0BAA2BA,CAAG,EAC5CnB,EAAS,wBAAwB,EACjCR,EAAcoD,CAAW,CAC3B,CACF,EAGMX,EAAoB,MAAOY,GAAc,CAC7C,GAAI,CACF,MAAMzB,EAAI,KAAK,aAAajC,GAAiB,EAAE,kBAAmB,CAChE,WAAY0D,CAAA,CACb,CACH,OAAS1B,EAAK,CACZ,QAAQ,MAAM,kCAAmCA,CAAG,CACtD,CACF,EAGM2B,EAAoB,SAAY,CACpC,GAAI,CACF,GAAI,CAAC9D,GAAU,OAAQ,OAEvB,MAAM+D,EAAU,MAAM,QAAQ,IAC5B/D,EAAS,IAAI,MAAOgE,GAAY,CAC9B,GAAI,CACF,KAAM,CAAE,KAAA3B,GAAS,MAAMD,EAAI,IAAI,aAAa4B,EAAQ,EAAE,oBAAoB,EACpEC,EACJ5B,GAAM,MAAM,cACZA,GAAM,MACNA,GAAM,cACN,EAEF,MAAO,CAAE,GAAI2B,EAAQ,GAAI,MAAO,OAAOC,CAAK,GAAK,CAAA,CACnD,OAASP,EAAG,CACV,eAAQ,MAAM,mCAAmCM,EAAQ,EAAE,IAAKN,CAAC,EAC1D,CAAE,GAAIM,EAAQ,GAAI,MAAO,CAAA,CAClC,CACF,CAAC,CAAA,EAGGE,EAAa,OAAO,YAAYH,EAAQ,IAAKI,GAAM,CAACA,EAAE,GAAIA,EAAE,KAAK,CAAC,CAAC,EAEzElE,EAAauD,GACXA,EAAK,IAAKhB,IAAO,CACf,GAAGA,EACH,aAAc0B,EAAW1B,EAAE,EAAE,GAAK,CAAA,EAClC,CAAA,CAEN,OAASL,EAAK,CACZ,QAAQ,MAAM,iCAAkCA,CAAG,CACrD,CACF,EAEAP,EAAAA,UAAU,IAAM,CACd,GAAID,EAAO,CACTmC,EAAA,EACA,MAAMM,EAAW,YAAYN,EAAmB,GAAK,EACrD,MAAO,IAAM,cAAcM,CAAQ,CACrC,CACF,EAAG,CAACzC,CAAK,CAAC,EAGeP,EAAAA,OAAO,IAAI,EAsBpC,MAAMiD,EAAcC,GAAe,CACjC,GAAI,CAACA,EAAY,MAAO,GACxB,MAAMC,EAAO,IAAI,KAAKD,CAAU,EAChC,GAAI,OAAO,MAAMC,EAAK,QAAA,CAAS,EAAG,MAAO,GAGzC,MAAMC,EAAgB,KAAK,WADX,KACwBD,GAAQ,GAAK,EAErD,GAAIC,EAAgB,EAAG,MAAO,WAC9B,GAAIA,EAAgB,GAAI,MAAO,GAAGA,CAAa,QAC/C,MAAMC,EAAc,KAAK,MAAMD,EAAgB,EAAE,EACjD,GAAIC,EAAc,GAAI,MAAO,GAAGA,CAAW,QAC3C,MAAMC,EAAa,KAAK,MAAMD,EAAc,EAAE,EAC9C,OAAIC,EAAa,EAAU,GAAGA,CAAU,QAEjCH,EAAK,mBAAmB,QAAS,CAAE,MAAO,QAAS,IAAK,UAAW,CAC5E,EAEMI,EAAkBL,GAAe,CACrC,GAAI,CAACA,EAAY,MAAO,GACxB,MAAMC,EAAO,IAAI,KAAKD,CAAU,EAChC,OAAI,OAAO,MAAMC,EAAK,QAAA,CAAS,EAAU,GAClCA,EAAK,mBAAmB,QAAS,CACtC,MAAO,QACP,IAAK,UACL,KAAM,UACN,OAAQ,SAAA,CACT,CACH,EAGMK,EAAmB5E,EAAS,OAAQgE,GAAY,CACpD,GAAI,CAAC/C,EAAa,MAAO,GACzB,MAAM4D,EAAQ5D,EAAY,YAAA,EACpB6D,EAAa,GAAGd,EAAQ,QAAQ,YAAc,EAAE,IAAIA,EAAQ,QAAQ,WAAa,EAAE,GAAG,YAAA,EACtFe,EAAU,GAAGf,EAAQ,KAAK,MAAQ,EAAE,IAAIA,EAAQ,KAAK,OAAS,EAAE,GAAG,YAAA,EACzE,OAAOc,EAAW,SAASD,CAAK,GAAKE,EAAQ,SAASF,CAAK,CAC7D,CAAC,EAGD,aACG,MAAA,CAAI,UAAU,4HACb,SAAAG,EAAAA,KAAC,MAAA,CAAI,UAAU,8BAGb,SAAA,CAAAC,EAAAA,IAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,UAAU,OAEV,SAAAF,EAAAA,KAAC,MAAA,CAAI,UAAU,+BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,UAAU,kEACV,MAAO,CAAE,WAAY,2BAA2BnF,EAAO,IAAI,KAAKA,EAAO,QAAQ,GAAA,EAE/E,SAAAmF,EAAAA,IAACE,EAAA,CAAc,UAAU,qBAAqB,CAAA,CAAA,SAE/C,MAAA,CACC,SAAA,CAAAF,EAAAA,IAAC,KAAA,CACC,UAAU,mDACV,MAAO,CAAE,gBAAiB,2BAA2BnF,EAAO,QAAQ,KAAKA,EAAO,IAAI,KAAKA,EAAO,SAAS,GAAA,EAC1G,SAAA,kBAAA,CAAA,QAGA,IAAA,CAAE,UAAU,2CAA2C,SAAA,mCAAgC,CAAA,EAC1F,CAAA,EACF,CAAA,CAAA,EAIFmF,EAAAA,IAACG,GACE,SAAArE,GACCkE,EAAAA,IAACC,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,GAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,GAAA,EACvB,UAAU,+BACV,MAAO,CAAE,WAAY,yBAA0B,YAAa,SAAA,EAE5D,SAAAF,EAAAA,KAAC,IAAA,CAAE,UAAU,yDACX,SAAA,CAAAC,EAAAA,IAACI,GAAA,CAAE,UAAU,UAAU,EACtBtE,CAAA,EACH,CAAA,CAAA,EAGN,EAEAiE,EAAAA,KAAC,MAAA,CAAI,UAAU,8DAGb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0IAGb,SAAA,CAAAC,EAAAA,IAAC,OAAI,UAAU,oDACb,SAAAD,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAC,EAAAA,IAACK,GAAA,CAAO,UAAU,2EAA2E,EAC7FL,EAAAA,IAAC,QAAA,CACC,KAAK,OACL,YAAY,0BACZ,MAAOhE,EACP,SAAWyC,GAAMxC,EAAewC,EAAE,OAAO,KAAK,EAC9C,UAAU,oKACV,MAAO,CAAE,UAAW5D,EAAO,IAAA,CAAK,CAAA,CAClC,CAAA,CACF,CAAA,CACF,EAGAmF,EAAAA,IAAC,OAAI,UAAU,yBACZ,WACCA,EAAAA,IAAC,MAAA,CAAI,UAAU,0CACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,oEACV,MAAO,CAAE,YAAanF,EAAO,QAAS,eAAgB,aAAA,CAAc,CAAA,EAExE,EACE8E,EAAiB,SAAW,EAC9BI,OAAC,MAAA,CAAI,UAAU,qEACb,SAAA,CAAAC,EAAAA,IAACE,EAAA,CAAc,UAAU,iBAAiB,MAAO,CAAE,MAAOrF,EAAO,KAAM,QAAS,EAAA,EAAO,QACtF,IAAA,CAAE,UAAU,0BAA0B,SAAA,oBAAiB,QACvD,IAAA,CAAE,UAAU,2BAA2B,SAAA,4BAAyB,CAAA,EACnE,EAEA8E,EAAiB,IAAKZ,GACpBiB,EAAAA,IAACC,EAAO,IAAP,CAEC,WAAY,CAAE,EAAG,CAAA,EACjB,QAAS,IAAM9E,EAAmB4D,CAAO,EACzC,UAAW,mFACT7D,GAAiB,KAAO6D,EAAQ,GAC5B,aACA,yCACN,GACA,MAAO7D,GAAiB,KAAO6D,EAAQ,GAAK,CAC1C,WAAYlE,EAAO,QACnB,gBAAiBA,EAAO,IAAA,EACtB,CAAA,EAEJ,SAAAkF,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,WACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,IAAKjB,EAAQ,QAAQ,gBACjB,gBAAgBA,EAAQ,OAAO,eAAe,GAC9C,sBACJ,IAAKA,EAAQ,QAAQ,YAAc,SACnC,UAAU,0EAAA,CAAA,EAEXA,EAAQ,aAAe,GACtBiB,EAAAA,IAACC,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,CAAC,EAAG,IAAK,CAAC,CAAA,EAC5B,WAAY,CAAE,SAAU,EAAG,OAAQ,GAAA,EACnC,UAAU,2FACV,MAAO,CAAE,WAAYpF,EAAO,SAAA,EAE5B,eAAC,OAAA,CAAK,UAAU,+BAAgC,WAAQ,YAAA,CAAa,CAAA,CAAA,CACvE,EAEJ,EACAkF,EAAAA,KAAC,MAAA,CAAI,UAAU,iBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,KAAA,CAAG,UAAU,+EACX,SAAA,CAAAhB,EAAQ,QAAQ,YAAc,MAAM,IAAEA,EAAQ,QAAQ,WAAa,GACnEA,EAAQ,QAAQ,mBACfiB,EAAAA,IAACM,EAAA,CAAO,UAAU,UAAU,MAAO,CAAE,MAAOzF,EAAO,IAAA,EAAQ,CAAA,EAE/D,EACCkE,EAAQ,aAAe,GACtBiB,EAAAA,IAACO,GAAA,CAAa,UAAU,UAAU,MAAO,CAAE,MAAO1F,EAAO,IAAA,EAAQ,CAAA,EAErE,EACAkF,EAAAA,KAAC,IAAA,CAAE,UAAU,4EACX,SAAA,CAAAC,EAAAA,IAACQ,EAAA,CAAI,UAAU,UAAU,EACxBzB,EAAQ,KAAK,MAAQ,MAAM,IAAEA,EAAQ,KAAK,OAAS,EAAA,EACtD,CAAA,EACF,CAAA,EACF,CAAA,EAlDKA,EAAQ,EAAA,CAoDhB,EAEL,CAAA,EACF,EAGAiB,MAAC,MAAA,CAAI,UAAU,0IACZ,WACCD,EAAAA,KAAAU,WAAA,CAEE,SAAA,CAAAV,EAAAA,KAAC,MAAA,CACC,UAAU,0CACV,MAAO,CAAE,WAAY,2BAA2BlF,EAAO,QAAQ,KAAKA,EAAO,IAAI,KAAKA,EAAO,SAAS,GAAA,EAEpG,SAAA,CAAAmF,EAAAA,IAAC,MAAA,CAAI,UAAU,qEAAqE,EACpFA,EAAAA,IAAC,MAAA,CAAI,UAAU,uEAAuE,EAEtFD,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,yCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,IAAK9E,EAAgB,QAAQ,gBACzB,gBAAgBA,EAAgB,OAAO,eAAe,GACtD,sBACJ,IAAKA,EAAgB,QAAQ,YAAc,SAC3C,UAAU,qEAAA,CAAA,SAEX,MAAA,CACC,SAAA,CAAA6E,EAAAA,KAAC,KAAA,CAAG,UAAU,4CACX,SAAA,CAAA7E,EAAgB,QAAQ,YAAc,MAAM,IAAEA,EAAgB,QAAQ,WAAa,GACnFA,EAAgB,QAAQ,mBACvB8E,EAAAA,IAACM,EAAA,CAAO,UAAU,UAAU,CAAA,EAEhC,EACAP,EAAAA,KAAC,IAAA,CAAE,UAAU,qBAAqB,SAAA,CAAA,IAAE7E,EAAgB,QAAQ,UAAY,SAAA,EAAU,CAAA,EACpF,CAAA,EACF,EACA6E,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACZ,SAAA,CAAA7E,EAAgB,QAAQ,cACvB8E,EAAAA,IAACC,EAAO,EAAP,CACC,WAAY,CAAE,MAAO,GAAA,EACrB,SAAU,CAAE,MAAO,EAAA,EACnB,KAAM,OAAO/E,EAAgB,OAAO,YAAY,GAChD,UAAU,kFAEV,SAAA8E,EAAAA,IAACU,GAAA,CAAM,UAAU,UAAU,CAAA,CAAA,EAG9BxF,EAAgB,QAAQ,OACvB8E,EAAAA,IAACC,EAAO,EAAP,CACC,WAAY,CAAE,MAAO,GAAA,EACrB,SAAU,CAAE,MAAO,EAAA,EACnB,KAAM,UAAU/E,EAAgB,OAAO,KAAK,GAC5C,UAAU,kFAEV,SAAA8E,EAAAA,IAACW,GAAA,CAAK,UAAU,UAAU,CAAA,CAAA,CAC5B,EAEJ,CAAA,EACF,QAEC,MAAA,CAAI,UAAU,8CACb,SAAAZ,EAAAA,KAAC,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACQ,EAAA,CAAI,UAAU,UAAU,EACzBT,EAAAA,KAAC,OAAA,CAAK,UAAU,WAAY,SAAA,CAAA7E,EAAgB,KAAK,MAAQ,MAAM,IAAEA,EAAgB,KAAK,OAAS,EAAA,EAAG,CAAA,EACpG,EACA6E,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAC,EAAAA,IAACY,GAAA,CAAS,UAAU,UAAU,EAC9BZ,EAAAA,IAAC,OAAA,CAAK,UAAU,WAAY,SAAA9E,EAAgB,eAAiBwE,EAAexE,EAAgB,cAAc,EAAI,MAAM,CAAA,EACtH,CAAA,CAAA,CACF,CAAA,CACF,CAAA,EACF,CAAA,CAAA,CAAA,EAIF6E,EAAAA,KAAC,MAAA,CACC,IAAK7D,EACL,UAAU,wHACV,MAAO,CAAE,UAAW,qBAAA,EAEnB,SAAA,CAAAV,EACCwE,EAAAA,IAAC,MAAA,CAAI,UAAU,0CACb,SAAAA,EAAAA,IAAC,MAAA,CACC,UAAU,oEACV,MAAO,CAAE,YAAanF,EAAO,QAAS,eAAgB,aAAA,CAAc,CAAA,EAExE,EACEO,EAAS,SAAW,EACtB2E,OAAC,MAAA,CAAI,UAAU,iEACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CACC,UAAU,+DACV,MAAO,CAAE,WAAYnF,EAAO,OAAA,EAE5B,SAAAmF,EAAAA,IAACE,GAAc,UAAU,YAAY,MAAO,CAAE,MAAOrF,EAAO,KAAK,CAAG,CAAA,CAAA,QAErE,IAAA,CAAE,UAAU,sBAAsB,SAAA,kBAAe,QACjD,IAAA,CAAE,UAAU,UAAU,SAAA,0BAAuB,CAAA,EAChD,EAEAkF,EAAAA,KAAAU,EAAAA,SAAA,CACG,SAAA,CAAArF,EAAS,IAAI,CAACyF,EAASC,IAAU,CAChC,MAAMC,EACJF,EAAQ,YAAcvE,EAAc,SACpCuE,EAAQ,QAAQ,KAAOvE,EAAc,QAEjC0E,EACJF,IAAU,GAAK1F,EAAS0F,EAAQ,CAAC,EAAE,YAAcD,EAAQ,UAE3D,OACEd,EAAAA,KAACE,EAAO,IAAP,CAEC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,UAAW,wBAAwBc,EAAU,cAAgB,eAAe,GAE3E,SAAA,CAAA,CAACA,GAAWC,GACXhB,EAAAA,IAAC,MAAA,CACC,IAAKa,EAAQ,QAAQ,gBACjB,gBAAgBA,EAAQ,OAAO,eAAe,GAC9C,sBACJ,IAAKA,EAAQ,QAAQ,YAAc,OACnC,UAAU,wEAAA,CAAA,EAGb,CAACE,GAAW,CAACC,SAAe,MAAA,CAAI,UAAU,MAAM,SAEhD,MAAA,CAAI,UAAW,iBAAiBD,EAAU,YAAc,aAAa,eACpE,SAAA,CAAAf,EAAAA,IAACC,EAAO,IAAP,CACC,WAAY,CAAE,MAAO,IAAA,EACrB,UAAW,mCACTc,EACI,6BACA,qHACN,GACA,MAAOA,EAAU,CAAE,WAAY,2BAA2BlG,EAAO,IAAI,KAAKA,EAAO,QAAQ,GAAA,EAAQ,CAAA,EAEjG,eAAC,IAAA,CAAE,UAAU,0DAA2D,WAAQ,OAAA,CAAQ,CAAA,CAAA,EAE1FkF,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAC,MAAC,QAAK,UAAU,2CACb,SAAAZ,EAAWyB,EAAQ,UAAU,EAChC,EACCE,SACE,OAAA,CACE,SAAAF,EAAQ,QACPb,MAACiB,GAAA,CAAW,UAAU,UAAU,MAAO,CAAE,MAAOpG,EAAO,IAAA,EAAQ,QAE9DqG,GAAA,CAAM,UAAU,uBAAA,CAAwB,CAAA,CAE7C,CAAA,EAEJ,CAAA,EACF,EAECH,GAAWC,GACVhB,EAAAA,IAAC,MAAA,CACC,IAAKa,EAAQ,QAAQ,gBACjB,gBAAgBA,EAAQ,OAAO,eAAe,GAC9C,sBACJ,IAAKA,EAAQ,QAAQ,YAAc,MACnC,UAAU,wEAAA,CAAA,EAGbE,GAAW,CAACC,GAAchB,EAAAA,IAAC,MAAA,CAAI,UAAU,MAAM,CAAA,CAAA,EArD3Ca,EAAQ,EAAA,CAwDnB,CAAC,EACDb,EAAAA,IAAC,MAAA,CAAI,IAAK5D,EAAgB,CAAA,EAC5B,EAIF4D,EAAAA,IAACG,GACE,SAAAvE,GACCmE,EAAAA,KAACE,EAAO,IAAP,CACC,QAAS,CAAE,QAAS,EAAG,EAAG,EAAA,EAC1B,QAAS,CAAE,QAAS,EAAG,EAAG,CAAA,EAC1B,KAAM,CAAE,QAAS,EAAG,EAAG,EAAA,EACvB,UAAU,0BAEV,SAAA,CAAAD,EAAAA,IAAC,MAAA,CACC,IAAK9E,EAAgB,QAAQ,gBACzB,gBAAgBA,EAAgB,OAAO,eAAe,GACtD,sBACJ,IAAKA,EAAgB,QAAQ,YAAc,SAC3C,UAAU,wEAAA,CAAA,QAEX,MAAA,CAAI,UAAU,8GACb,SAAA6E,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAC,EAAAA,IAAC,MAAA,CAAI,UAAU,sCAAsC,MAAO,CAAE,WAAYnF,EAAO,KAAM,eAAgB,KAAA,EAAS,EAChHmF,EAAAA,IAAC,MAAA,CAAI,UAAU,sCAAsC,MAAO,CAAE,WAAYnF,EAAO,SAAU,eAAgB,OAAA,EAAW,EACtHmF,EAAAA,IAAC,MAAA,CAAI,UAAU,sCAAsC,MAAO,CAAE,WAAYnF,EAAO,UAAW,eAAgB,OAAA,EAAW,CAAA,CAAA,CACzH,CAAA,CACF,CAAA,CAAA,CAAA,EAGN,CAAA,CAAA,CAAA,QAID,MAAA,CAAI,UAAU,8EACb,SAAAkF,EAAAA,KAAC,MAAA,CAAI,UAAU,uBACb,SAAA,CAAAC,EAAAA,IAACC,EAAO,OAAP,CACC,WAAY,CAAE,MAAO,GAAA,EACrB,SAAU,CAAE,MAAO,EAAA,EACnB,QAAS,IAAM,QAAQ,IAAI,aAAa,EACxC,UAAU,mCACV,MAAO,CAAE,WAAYpF,EAAO,QAAS,MAAOA,EAAO,IAAA,EAEnD,SAAAmF,EAAAA,IAACmB,GAAA,CAAU,UAAU,UAAU,CAAA,CAAA,EAEjCnB,EAAAA,IAACC,EAAO,OAAP,CACC,WAAY,CAAE,MAAO,GAAA,EACrB,SAAU,CAAE,MAAO,EAAA,EACnB,QAAS,IAAM,QAAQ,IAAI,YAAY,EACvC,UAAU,mCACV,MAAO,CAAE,WAAYpF,EAAO,aAAc,MAAOA,EAAO,SAAA,EAExD,SAAAmF,EAAAA,IAACoB,GAAA,CAAM,UAAU,UAAU,CAAA,CAAA,EAE7BpB,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAA,EAAAA,IAAC,WAAA,CACC,MAAO1E,EACP,SAAWmD,GAAM,CACflD,EAAckD,EAAE,OAAO,KAAK,CAE9B,EACA,WAAaA,GAAM,CACbA,EAAE,MAAQ,SAAW,CAACA,EAAE,WAC1BA,EAAE,eAAA,EACFC,EAAYD,CAAC,EAEjB,EACA,YAAY,uBACZ,KAAM,EACN,UAAU,yJACV,MAAO,CAAE,UAAW5D,EAAO,IAAA,CAAK,CAAA,EAEpC,EACAmF,EAAAA,IAACC,EAAO,OAAP,CACC,WAAY,CAAE,MAAO,IAAA,EACrB,SAAU,CAAE,MAAO,GAAA,EACnB,QAASvB,EACT,SAAU,CAACpD,EAAW,KAAA,EACtB,UAAU,mIACV,MAAO,CAAE,WAAY,2BAA2BT,EAAO,IAAI,KAAKA,EAAO,QAAQ,GAAA,EAE/E,SAAAmF,EAAAA,IAACqB,GAAA,CAAK,UAAU,UAAU,CAAA,CAAA,CAC5B,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CACF,EAEArB,EAAAA,IAAC,MAAA,CAAI,UAAU,mDACb,SAAAD,EAAAA,KAACE,EAAO,IAAP,CACC,QAAS,CAAE,MAAO,GAAK,QAAS,CAAA,EAChC,QAAS,CAAE,MAAO,EAAG,QAAS,CAAA,EAC9B,UAAU,cAEV,SAAA,CAAAD,EAAAA,IAAC,MAAA,CACC,UAAU,uEACV,MAAO,CAAE,WAAY,2BAA2BnF,EAAO,OAAO,KAAKA,EAAO,YAAY,GAAA,EAEtF,SAAAmF,EAAAA,IAACE,GAAc,UAAU,YAAY,MAAO,CAAE,MAAOrF,EAAO,KAAK,CAAG,CAAA,CAAA,QAErE,KAAA,CAAG,UAAU,wDAAwD,SAAA,mBAEtE,QACC,IAAA,CAAE,UAAU,mCAAmC,SAAA,0CAEhD,CAAA,CAAA,CAAA,CACF,CACF,CAAA,CAEJ,CAAA,EACF,CAAA,CAAA,CACF,CAAA,CACF,CAEJ"}