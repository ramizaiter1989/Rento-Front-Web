import{c as te,r as d,j as e,B as f,b as B}from"./index-DbvXYXc0.js";import{b as ae,N as ie}from"./adminApi-C-vdNBvN.js";import{C as z,a as V}from"./card-6tZ6FSP9.js";import{I as m}from"./input-Bf8YvsU0.js";import{S as re,a as le,b as ne,d as ce,e as $}from"./select-895Ag1Vf.js";import{B as I}from"./badge-De3gxj8m.js";import{u as M}from"./use-toast-BTZLQfF-.js";import{D as de,b as oe,c as me,d as xe}from"./dialog-CvL19ZOf.js";import{L as o}from"./label-DMFTECDG.js";import{S as ue}from"./search-DsOkoVxz.js";import{U as he}from"./users-E8rCSFRH.js";import{C as pe}from"./circle-pJ_qQuI9.js";import{E as je}from"./eye--wIqRW1l.js";import{S as fe}from"./square-pen-CxEXnCdu.js";import{T as ge}from"./trash-2-DiSdLuQ2.js";import{C as ve}from"./chevron-left-DlVhwfSE.js";import{C as be}from"./chevron-right-DaEW3pZI.js";import"./index-UZKPKpE4.js";import"./index-CB20-cGd.js";import"./Combination-B6rQ859v.js";import"./index-9AnY3iUi.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";import"./index-AD6gynWr.js";import"./index-DE3TGyh9.js";const ts=()=>{te();const{toast:s}=M(),r=20,[x,c]=d.useState([]),[a,u]=d.useState({current_page:1,last_page:1,per_page:r,total:0}),[p,g]=d.useState(1),[j,l]=d.useState(null),[h,v]=d.useState(!0),[T,C]=d.useState(null),[G,N]=d.useState(!1),[P,_]=d.useState(""),[F,D]=d.useState(null),[A,q]=d.useState(""),[y,H]=d.useState([]),[S,K]=d.useState("all"),[Y,Z]=d.useState(!1),R=d.useCallback(async()=>{v(!0);try{const t={page:p,per_page:r,sort_by:"created_at",sort_order:"desc"};A.trim()&&(t.search=A.trim()),y.length===1?t.role=y[0]:y.length>1&&(t.role=y.join(",")),S==="active"?t.status=!0:S==="blocked"&&(t.status=!1);const i=await ae(t),n=i.data?.users??i.data,b=Array.isArray(n)?n:n?.data??[];c(Array.isArray(b)?b:[]);const w=n?.current_page!=null?{current_page:n.current_page,last_page:n.last_page??1,per_page:n.per_page??r,total:n.total??0}:{current_page:p,last_page:1,per_page:r,total:0};u(se=>({...se,current_page:w.current_page??p,last_page:w.last_page??1,per_page:w.per_page??r,total:w.total??0}))}catch{s({title:"Error",description:"Failed to load users",variant:"destructive"}),c([])}finally{v(!1)}},[p,A,y,S]);d.useEffect(()=>{R()},[R]),d.useEffect(()=>{g(1)},[A,y,S]),d.useEffect(()=>{(async()=>{try{const i=await ie({minutes:30}),n=i.data??i,b=n?.online_users??n?.users??n?.data??[];l(n?.online_users_count??(Array.isArray(b)?b.length:0))}catch{l(0)}})()},[]);const U=async t=>{try{const{data:i}=await B.get(`/admin/users/${t}`);return i.user}catch{return s({title:"Error",description:"Failed to fetch user details",variant:"destructive"}),null}},J="/avatar.png",Q="https://rento-lb.com/api/storage/",X=t=>{const i=t?.profile_picture;if(!i)return J;if(i.startsWith("http"))return i;const n=i.startsWith("/")?i.slice(1):i;return Q+n},L=[...x].sort((t,i)=>new Date(i.created_at||0)-new Date(t.created_at||0)),ee=async t=>{if(confirm("Delete this user?"))try{await B.delete(`/admin/users/${t}`),c(i=>i.filter(n=>n.id!==t)),u(i=>({...i,total:Math.max(0,(i.total??0)-1)})),s({title:"User deleted"})}catch{s({title:"Error",description:"Delete failed",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{open:G,onOpenChange:N,children:e.jsxs(oe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(me,{children:e.jsx(xe,{children:P==="edit-user"?"Edit User":"User Details"})}),P==="view-user"&&T&&e.jsx(Ae,{user:T,onEdit:()=>{D({...T}),_("edit-user")},onClose:()=>N(!1)}),P==="edit-user"&&F&&e.jsx(Se,{user:F,setUser:D,onClose:()=>{N(!1),_("view-user")},onSaved:t=>{C(t),D({...t}),_("view-user")}})]})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Users"})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx(ue,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search user...",className:"pl-9",value:A,onChange:t=>q(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Total:"}),e.jsx("span",{className:"font-semibold text-foreground",children:a.total})]}),j!==null&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-2.5 h-2.5 fill-green-500 text-green-500"}),e.jsx("span",{children:"Online now:"}),e.jsx("span",{className:"font-semibold text-foreground",children:j})]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>Z(t=>!t),children:"Filters"})]})]}),Y&&e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 rounded-lg border p-4 bg-background",children:[e.jsxs(re,{value:S,onValueChange:K,children:[e.jsx(le,{children:e.jsx(ne,{placeholder:"Status"})}),e.jsxs(ce,{children:[e.jsx($,{value:"all",children:"All"}),e.jsx($,{value:"active",children:"Active"}),e.jsx($,{value:"blocked",children:"Blocked"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3 text-sm",children:["client","agency","admin"].map(t=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y.includes(t),onChange:i=>{const n=i.target.checked;H(b=>n?[...b,t]:b.filter(w=>w!==t))}}),e.jsx("span",{className:"capitalize",children:t})]},t))})]}),e.jsx(z,{children:e.jsxs(V,{className:"p-4",children:[h?e.jsx("p",{className:"p-6 text-muted-foreground text-center",children:"Loading users..."}):L.length===0?e.jsx("p",{className:"p-6 text-muted-foreground text-center",children:"No users found"}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:L.map(t=>e.jsx(z,{className:"overflow-hidden border-2 hover:shadow-md transition-shadow",children:e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 cursor-pointer",title:Ne(t),role:"button",tabIndex:0,onClick:()=>O(t.id,U,C,_,N),onKeyDown:i=>i.key==="Enter"&&O(t.id,U,C,_,N),children:[e.jsx("img",{src:X(t),alt:t.username||"User",className:"h-12 w-12 rounded-full object-cover ring-2 ring-muted",onError:i=>{i.currentTarget.onerror=null,i.currentTarget.src="/avatar.png"}}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold truncate",children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:t.username||`User #${t.id}`}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t.phone_number||"â€”"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-3",children:[e.jsx(I,{variant:"outline",className:"capitalize",children:t.role}),t.update_access?e.jsx(I,{className:"bg-green-500",children:"Active"}):e.jsx(I,{variant:"destructive",children:"Blocked"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:async()=>{const i=await U(t.id);i&&(C(i),_("view-user"),N(!0))},title:"View Details",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:async()=>{const i=await U(t.id);i&&(C(i),D({...i}),_("edit-user"),N(!0))},title:"Edit User",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(f,{size:"icon",variant:"ghost","aria-label":"Delete user",className:"text-red-500 hover:text-red-600",onClick:()=>ee(t.id),title:"Remove User",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},t.id))}),a.last_page>1&&!h&&L.length>0&&e.jsxs("div",{className:"flex flex-col items-center gap-3 mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Page ",e.jsx("span",{className:"font-semibold text-foreground",children:a.current_page})," of"," ",e.jsx("span",{className:"font-semibold text-foreground",children:a.last_page})," (",a.total," users)"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[e.jsx(f,{variant:"outline",size:"sm",disabled:a.current_page<=1,onClick:()=>g(t=>t-1),children:e.jsx(ve,{size:16})}),Array.from({length:a.last_page},(t,i)=>i+1).filter(t=>t===1||t===a.last_page||Math.abs(t-a.current_page)<=2).map(t=>e.jsx(f,{size:"sm",variant:t===a.current_page?"default":"outline",onClick:()=>g(t),children:t},t)),e.jsx(f,{variant:"outline",size:"sm",disabled:a.current_page>=a.last_page,onClick:()=>g(t=>t+1),children:e.jsx(be,{size:16})})]})]})]})})]})};function Ne(s){if(!s)return"";const r=s.client||{},x=r.qualification_code||{};return[`User ID : ${s.id??"N/A"}`,`Age : ${x.age??"N/A"}`,`Gender : ${s.gender??"N/A"}`,`City : ${s.city??"N/A"}`,`Bio : ${s.bio??"N/A"}`,`Profession : ${r.profession??"N/A"}`,`Email : ${s.email??"N/A"}`,`License number : ${r.license_number??"N/A"}`,`Average rating : ${r.average_rating??"N/A"}`,`OTP verification : ${s.otp_verification??"N/A"}`].join(`
`)}async function O(s,r,x,c,a){const u=await r(s);u&&(x(u),c("view-user"),a(!0))}function W(s){if(!s)return"N/A";const r=new Date(s);return Number.isNaN(r.getTime())?String(s):r.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}function E(s){if(!s)return"N/A";const r=new Date(s);return Number.isNaN(r.getTime())?String(s):r.toLocaleString("en-US",{timeZone:"Asia/Beirut",month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}const _e="https://rento-lb.com/api/storage/",ye="/avatar.png";function we(s,r=null){if(!s)return r;if(s.startsWith("http"))return s;const x=s.startsWith("/")?s.slice(1):s;return _e+x}function Ce(s){return s?String(s).toLowerCase().split("?")[0].endsWith(".pdf"):!1}function k({title:s,path:r,fallback:x=null}){const c=we(r,x);if(!c)return e.jsx("div",{className:"text-sm text-muted-foreground",children:"N/A"});if(Ce(c)){const a=`${c}#toolbar=0&navpanes=0&scrollbar=0`;return e.jsx("iframe",{title:s,src:a,className:"w-full max-w-[260px] h-[180px] rounded-md border bg-white"})}return e.jsx("img",{src:c,alt:s,className:"w-full max-w-[260px] h-[180px] object-cover rounded-md border",onError:a=>{x&&(a.currentTarget.onerror=null,a.currentTarget.src=x)}})}function Ae({user:s,onEdit:r,onClose:x}){const c=s?.client||{};function a({label:g,value:j}){return e.jsxs("div",{className:"flex items-center gap-2 test-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[g," :"]}),e.jsx("span",{className:"text-foreground",children:j??"N/A"})]})}const u=({label:g,value:j,tone:l="neutral"})=>{const h=l==="teal"?"bg-teal-600 text-white":l==="red"?"bg-red-600 text-white":"bg-muted text-foreground";return e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx("span",{className:" text-muted-foreground",children:g}),e.jsx("span",{className:`inline-flex items-center justify-center px-2 h-5 rounded text-xs font-semibold leading-none ${h}`,children:j})]})},p=s?.status?"Active":"Inactive";return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-10 gap-y-3",children:[e.jsx(a,{label:"ID",value:s?.id}),e.jsx(a,{label:"Username",value:s?.username}),e.jsx(a,{label:"Email",value:s?.email}),e.jsx(a,{label:"Phone Number",value:s?.phone_number}),e.jsx(a,{label:"First Name",value:s?.first_name}),e.jsx(a,{label:"Last Name",value:s?.last_name}),e.jsx(a,{label:"Gender",value:s?.gender}),e.jsx(a,{label:"Birth Date",value:W(s?.birth_date)}),e.jsx(a,{label:"City",value:s?.city}),e.jsx(a,{label:"Role",value:s?.role}),e.jsx("div",{className:"flex flex-wrap items-center gap-8 pt-1",children:e.jsx(u,{label:"Status:",value:p,tone:s?.status?"teal":"red"})}),e.jsx("div",{className:"flex flex-wrap items-center gap-8 pt-1",children:e.jsx(u,{label:"Verified by Admin:",value:s?.verified_by_admin?"Yes":"No",tone:s?.verified_by_admin?"teal":"red"})}),e.jsx("div",{className:"flex flex-wrap items-center gap-8 pt-1",children:e.jsx(u,{label:"Is Locked:",value:s?.is_locked?"Locked":"Unlocked",tone:s?.is_locked?"red":"teal"})}),e.jsx(a,{label:"Created At",value:E(s?.created_at)}),e.jsx(a,{label:"Updated At",value:E(s?.updated_at)})]}),e.jsx("div",{className:"grid grid-cols-2 gap-x-10 gap-y-3",children:e.jsx(a,{label:"Bio",value:s?.bio})}),e.jsx("div",{className:"border-t pt-3"}),e.jsx("div",{className:"text-sm font-semibold",children:"Client Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-10 gap-y-3",children:[e.jsx(a,{label:"License Number",value:c?.license_number}),e.jsx(a,{label:"Profession",value:c?.profession}),e.jsx(a,{label:"Average Salary",value:c?.avg_salary}),e.jsx(a,{label:"Promo Code",value:c?.promo_code})]}),e.jsx("div",{className:"border-t pt-3"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm font-semibold",children:"Documents"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Profile Picture"}),e.jsx(k,{title:"Profile Picture",path:s?.profile_picture,fallback:ye})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Driver License"}),e.jsx(k,{title:"Driver License",path:c?.driver_license})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"ID Card Front"}),e.jsx(k,{title:"ID Card Front",path:s?.id_card_front})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"ID Card Back"}),e.jsx(k,{title:"ID Card Back",path:s?.id_card_back})]})]})]}),e.jsxs("div",{className:"pt-3 flex gap-2",children:[e.jsx(f,{className:"flex-1",onClick:r,children:"Edit User"}),e.jsx(f,{variant:"outline",className:"w-28",onClick:x,children:"Close"})]})]})}function Se({user:s,setUser:r,onClose:x,onSaved:c}){const{toast:a}=M(),u=(l,h)=>r(v=>({...v,[l]:h})),p=s?.client||{},g=async()=>{try{const l={verified_by_admin:!!s?.verified_by_admin,status:!!s?.status,is_locked:!!s?.is_locked,update_access:!!s?.update_access},{data:h}=await B.put(`/admin/users/${s.id}`,l),v=h.user??h.data??s;a({title:"Saved",description:"User updated successfully"}),c?.(v)}catch{a({title:"Error",description:"Failed to update user",variant:"destructive"})}},j=({label:l,value:h,onChange:v})=>e.jsxs("div",{className:"flex items-center justify-between gap-3 py-2",children:[e.jsx("div",{className:"text-sm",children:l}),e.jsx("button",{type:"button",role:"switch","aria-checked":!!h,onClick:()=>v(!h),className:["relative inline-flex h-5 w-10 items-center rounded-full transition-colors",h?"bg-teal-600":"bg-muted","focus:outline-none focus:ring-2 focus:ring-teal-500/40"].join(" "),children:e.jsx("span",{className:["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",h?"translate-x-5":"translate-x-1","shadow"].join(" ")})})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-10 gap-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"ID"}),e.jsx(m,{value:s?.id??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Username"}),e.jsx(m,{value:s?.username??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Email"}),e.jsx(m,{value:s?.email??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Phone Number"}),e.jsx(m,{value:s?.phone_number??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"First Name"}),e.jsx(m,{value:s?.first_name??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Last Name"}),e.jsx(m,{value:s?.last_name??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Gender"}),e.jsx(m,{value:s?.gender??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Birth Date"}),e.jsx(m,{value:W(s?.birth_date),disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"City"}),e.jsx(m,{value:s?.city??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Role"}),e.jsx(m,{value:s?.role??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Created At"}),e.jsx(m,{value:E(s?.created_at),disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Updated At"}),e.jsx(m,{value:E(s?.updated_at),disabled:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(o,{children:"Bio"}),e.jsx("textarea",{className:"w-full border rounded-md p-2 min-h-[90px]",value:s?.bio??"",disabled:!0})]})]}),e.jsx("div",{className:"border-t pt-3"}),e.jsx("div",{className:"text-sm font-semibold",children:"Client Details (Read-only)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-10 gap-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"License Number"}),e.jsx(m,{value:p?.license_number??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Profession"}),e.jsx(m,{value:p?.profession??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Average Salary"}),e.jsx(m,{value:p?.avg_salary??"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Promo Code"}),e.jsx(m,{value:p?.promo_code??"",disabled:!0})]})]}),e.jsx("div",{className:"border-t pt-3"}),e.jsx("div",{className:"text-sm font-semibold",children:"Editable Fields"}),e.jsxs("div",{className:"rounded-md border p-3 space-y-1",children:[s?.verified_by_admin&&e.jsx(j,{label:"Verified by Admin (can revoke only)",value:s?.verified_by_admin,onChange:l=>u("verified_by_admin",l)}),e.jsx(j,{label:"Status (Active)",value:s?.status,onChange:l=>u("status",l)}),e.jsx(j,{label:"Is Locked",value:s?.is_locked,onChange:l=>u("is_locked",l)}),e.jsx(j,{label:"Update Access Allow Profile Updates",value:s?.update_access,onChange:l=>u("update_access",l)})]}),e.jsxs("div",{className:"pt-3 flex gap-2 justify-end",children:[e.jsx(f,{className:"w-36",onClick:g,children:"Update User"}),e.jsx(f,{variant:"outline",className:"w-28",onClick:x,children:"Cancel"})]})]})}export{ts as default,O as openUserView};
