{"version":3,"file":"AdsPopup-DHWrj0LY.js","sources":["../../src/lib/adsApi.js","../../src/components/AdsPopup.jsx"],"sourcesContent":["/**\n * Ads API Service\n * Public endpoints for ads display and tracking.\n * Uses a dedicated axios instance WITHOUT auth interceptor so expired/invalid\n * tokens don't cause 401 errors on these public-only routes.\n */\n\nimport axios from 'axios';\n\nlet baseURL = import.meta.env.VITE_API_URL || 'https://rento-lb.com/api/api';\nbaseURL = baseURL.trim().replace(/\\/+$/, '');\n\nconst publicApi = axios.create({\n  baseURL,\n  headers: {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n  },\n});\n\n/**\n * Get active ads for public display (no auth required)\n * @returns {Promise<Array>} Active ads array\n */\nexport const getActiveAds = async () => {\n  try {\n    const response = await publicApi.get('/ads');\n    return response.data?.ads || [];\n  } catch (error) {\n    return [];\n  }\n};\n\n/**\n * Get single ad (public - no auth required)\n * @param {number} adId\n */\nexport const getAd = async (adId) => {\n  try {\n    const response = await publicApi.get(`/ads/${adId}`);\n    return response.data;\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Track ad view (public - no auth required)\n * @param {number} adId\n */\nexport const trackAdView = async (adId) => {\n  try {\n    await publicApi.post(`/ads/${adId}/view`);\n  } catch {\n    // Silently fail - tracking shouldn't break the UI\n  }\n};\n\n/**\n * Track ad click (public - no auth required)\n * @param {number} adId\n */\nexport const trackAdClick = async (adId) => {\n  try {\n    await publicApi.post(`/ads/${adId}/click`);\n  } catch {\n    // Silently fail - tracking shouldn't break the UI\n  }\n};\n\nexport default { getActiveAds, getAd, trackAdView, trackAdClick };\n","/**\r\n * Ads Popup Component\r\n * Shows ads after 2 minutes of loading the website\r\n * User can close it, and if multiple active ads exist, displays randomly\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { X } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { getActiveAds, trackAdView, trackAdClick } from '@/lib/adsApi';\r\n\r\nexport default function AdsPopup() {\r\n  const [showPopup, setShowPopup] = useState(false);\r\n  const [currentAd, setCurrentAd] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Check if popup was already shown in this session\r\n    const popupShown = sessionStorage.getItem('adsPopupShown');\r\n    if (popupShown) return;\r\n\r\n    // Function to fetch and display random ad\r\n    const fetchAndShowAd = async () => {\r\n      try {\r\n        const activeAds = await getActiveAds();\r\n\r\n        if (activeAds.length > 0) {\r\n          // Select random ad\r\n          const randomAd = activeAds[Math.floor(Math.random() * activeAds.length)];\r\n          setCurrentAd(randomAd);\r\n          setShowPopup(true);\r\n          \r\n          // Track view\r\n          if (randomAd.id) {\r\n            await trackAdView(randomAd.id);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching ads:', error);\r\n      }\r\n    };\r\n\r\n    // Set timeout for 2 minutes (120000 ms)\r\n    const timer = setTimeout(() => {\r\n      fetchAndShowAd();\r\n    }, 20000); // 2 minutes\r\n\r\n    return () => clearTimeout(timer);\r\n  }, []);\r\n\r\n  const handleClose = () => {\r\n    setShowPopup(false);\r\n    sessionStorage.setItem('adsPopupShown', 'true');\r\n  };\r\n\r\n  const handleClick = async () => {\r\n    if (currentAd?.id) {\r\n      try {\r\n        // Track click\r\n        await trackAdClick(currentAd.id);\r\n      } catch (err) {\r\n        console.error('Error tracking ad click:', err);\r\n      } finally {\r\n        // Open target URL if exists\r\n        if (currentAd.target_url) {\r\n          window.open(currentAd.target_url, '_blank');\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!showPopup || !currentAd) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in\">\r\n      <div className=\"relative bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full mx-4 animate-scale-in\">\r\n        {/* Close Button */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          onClick={handleClose}\r\n          className=\"absolute top-2 right-2 z-10\"\r\n        >\r\n          <X className=\"w-5 h-5\" />\r\n        </Button>\r\n\r\n        {/* Ad Content */}\r\n        <div className=\"p-6\">\r\n          {currentAd.image_url && (\r\n            <div \r\n              className=\"cursor-pointer mb-4 rounded-lg overflow-hidden\"\r\n              onClick={handleClick}\r\n            >\r\n              <img\r\n                src={currentAd.image_url.startsWith('http') \r\n                  ? currentAd.image_url \r\n                  : `/api/storage/${currentAd.image_url}`}\r\n                alt={currentAd.ads_text || 'Advertisement'}\r\n                className=\"w-full h-auto object-contain max-h-96\"\r\n              />\r\n            </div>\r\n          )}\r\n          \r\n          {currentAd.ads_text && (\r\n            <div \r\n              className=\"text-center cursor-pointer\"\r\n              onClick={handleClick}\r\n            >\r\n              <p className=\"text-lg font-semibold mb-2\">{currentAd.ads_text}</p>\r\n            </div>\r\n          )}\r\n\r\n          {currentAd.target_url && (\r\n            <div className=\"mt-4 text-center\">\r\n              <Button\r\n                onClick={handleClick}\r\n                className=\"bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white\"\r\n              >\r\n                Visit Website\r\n              </Button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["baseURL","publicApi","axios","getActiveAds","trackAdView","adId","trackAdClick","AdsPopup","showPopup","setShowPopup","useState","currentAd","setCurrentAd","useEffect","fetchAndShowAd","activeAds","randomAd","error","timer","handleClose","handleClick","err","jsxs","jsx","Button","X"],"mappings":"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"}