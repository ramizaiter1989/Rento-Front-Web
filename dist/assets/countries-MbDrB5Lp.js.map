{"version":3,"file":"countries-MbDrB5Lp.js","sources":["../../src/lib/otpApi.js"],"sourcesContent":["/**\r\n * OTP API Service (Send & Resend OTP – v1.0, Feb 2026)\r\n *\r\n * Send / Resend: POST /api/auth/send-otp\r\n * Body: { phone_number, device_id } (both required; device_id max 64 chars).\r\n * Rate limits: 1 request/minute, 10 requests/day per device_id.\r\n * Responses: 200 { message }, 422 { errors }, 429 (Retry-After), 5xx { error }.\r\n */\r\n\r\nimport api from './axios';\r\n\r\nconst DEVICE_ID_KEY = 'rento_device_id';\r\nconst DEVICE_ID_MAX_LEN = 64;\r\n\r\n/**\r\n * Generate a simple UUID v4-style string (no crypto dependency required).\r\n * @returns {string}\r\n */\r\nfunction generateUuid() {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n    const r = (Math.random() * 16) | 0;\r\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\n/**\r\n * Get or create a stable device identifier for this browser (used for send-OTP rate limiting).\r\n * Stored in localStorage; max 64 characters per API.\r\n * @returns {string} device_id (max 64 chars)\r\n */\r\nexport function getOrCreateDeviceId() {\r\n  try {\r\n    let id = typeof localStorage !== 'undefined' ? localStorage.getItem(DEVICE_ID_KEY) : null;\r\n    if (!id || id.length > DEVICE_ID_MAX_LEN) {\r\n      id = generateUuid();\r\n      if (id.length > DEVICE_ID_MAX_LEN) id = id.slice(0, DEVICE_ID_MAX_LEN);\r\n      if (typeof localStorage !== 'undefined') localStorage.setItem(DEVICE_ID_KEY, id);\r\n    }\r\n    return id;\r\n  } catch {\r\n    return generateUuid().slice(0, DEVICE_ID_MAX_LEN);\r\n  }\r\n}\r\n\r\n/**\r\n * Send OTP for registration (and resend – same endpoint).\r\n * POST /api/auth/send-otp\r\n * @param {string} phoneNumber - E.164-style with or without + (e.g. \"+9613123456\" or \"9613123456\")\r\n * @param {string} [deviceId] - Optional; if omitted, getOrCreateDeviceId() is used. Max 64 chars.\r\n * @returns {Promise<{ message?: string }>} Success: { message: \"OTP sent successfully\" }\r\n * @throws Axios error with response: 422 (errors), 429 (rate limited), 5xx (server/SMS error)\r\n */\r\nexport const sendOtp = async (phoneNumber, deviceId) => {\r\n  const phone = typeof phoneNumber === 'string' && phoneNumber.trim()\r\n    ? (phoneNumber.trim().startsWith('+') ? phoneNumber.trim() : `+${phoneNumber.trim()}`)\r\n    : '';\r\n  const device = (deviceId && String(deviceId).slice(0, DEVICE_ID_MAX_LEN)) || getOrCreateDeviceId();\r\n\r\n  const response = await api.post('/auth/send-otp', {\r\n    phone_number: phone,\r\n    device_id: device,\r\n  });\r\n\r\n  return response.data;\r\n};\r\n\r\n/**\r\n * Send OTP for password reset\r\n * @param {string} phoneNumber - Phone number with country code, with or without + (e.g. +96170123456)\r\n * @returns {Promise} Response with OTP sent confirmation\r\n */\r\nexport const sendForgotPasswordOtp = async (phoneNumber) => {\r\n  // API accepts with or without +; backend normalizes. Send with + per doc.\r\n  const normalized = phoneNumber.trim().startsWith('+') ? phoneNumber.trim() : `+${phoneNumber.trim()}`;\r\n  const response = await api.post('/auth/forgot-password', {\r\n    phone_number: normalized\r\n  });\r\n  return response.data;\r\n};\r\n\r\n/**\r\n * Verify OTP code\r\n * @param {string} phoneNumber - Phone number with country code\r\n * @param {string} otpCode - 6-digit OTP code\r\n * @returns {Promise} Response with verification confirmation\r\n */\r\nexport const verifyOtp = async (phoneNumber, otpCode) => {\r\n  // Remove + sign if present (API expects format without +)\r\n  const cleanPhone = phoneNumber.replace(/^\\+/, '');\r\n  \r\n  const response = await api.post('/auth/verify-otp', {\r\n    phone_number: cleanPhone,\r\n    otp_code: otpCode\r\n  });\r\n  \r\n  return response.data;\r\n};\r\n\r\nexport default {\r\n  getOrCreateDeviceId,\r\n  sendOtp,\r\n  sendForgotPasswordOtp,\r\n  verifyOtp,\r\n};\r\n\r\n"],"names":["DEVICE_ID_KEY","DEVICE_ID_MAX_LEN","generateUuid","c","r","getOrCreateDeviceId","id","sendOtp","phoneNumber","deviceId","phone","device","api","sendForgotPasswordOtp","normalized","verifyOtp","otpCode","cleanPhone"],"mappings":"wCAWA,MAAMA,EAAgB,kBAChBC,EAAoB,GAM1B,SAASC,GAAe,CACtB,MAAO,uCAAuC,QAAQ,QAAUC,GAAM,CACpE,MAAMC,EAAK,KAAK,OAAM,EAAK,GAAM,EAEjC,OADUD,IAAM,IAAMC,EAAKA,EAAI,EAAO,GAC7B,SAAS,EAAE,CACtB,CAAC,CACH,CAOO,SAASC,GAAsB,CACpC,GAAI,CACF,IAAIC,EAAK,OAAO,aAAiB,IAAc,aAAa,QAAQN,CAAa,EAAI,KACrF,OAAI,CAACM,GAAMA,EAAG,OAASL,KACrBK,EAAKJ,EAAY,EACbI,EAAG,OAASL,IAAmBK,EAAKA,EAAG,MAAM,EAAGL,CAAiB,GACjE,OAAO,aAAiB,KAAa,aAAa,QAAQD,EAAeM,CAAE,GAE1EA,CACT,MAAQ,CACN,OAAOJ,EAAY,EAAG,MAAM,EAAGD,CAAiB,CAClD,CACF,CAUY,MAACM,EAAU,MAAOC,EAAaC,IAAa,CACtD,MAAMC,EAAQ,OAAOF,GAAgB,UAAYA,EAAY,KAAI,EAC5DA,EAAY,KAAI,EAAG,WAAW,GAAG,EAAIA,EAAY,KAAI,EAAK,IAAIA,EAAY,KAAI,CAAE,GACjF,GACEG,EAAUF,GAAY,OAAOA,CAAQ,EAAE,MAAM,EAAGR,CAAiB,GAAMI,IAO7E,OALiB,MAAMO,EAAI,KAAK,iBAAkB,CAChD,aAAcF,EACd,UAAWC,CACf,CAAG,GAEe,IAClB,EAOaE,EAAwB,MAAOL,GAAgB,CAE1D,MAAMM,EAAaN,EAAY,KAAI,EAAG,WAAW,GAAG,EAAIA,EAAY,KAAI,EAAK,IAAIA,EAAY,KAAI,CAAE,GAInG,OAHiB,MAAMI,EAAI,KAAK,wBAAyB,CACvD,aAAcE,CAClB,CAAG,GACe,IAClB,EAQaC,EAAY,MAAOP,EAAaQ,IAAY,CAEvD,MAAMC,EAAaT,EAAY,QAAQ,MAAO,EAAE,EAOhD,OALiB,MAAMI,EAAI,KAAK,mBAAoB,CAClD,aAAcK,EACd,SAAUD,CACd,CAAG,GAEe,IAClB"}