import{c as _e,r as f,t as i,j as e,a as ve,B as w,M as z,b as P,R as te}from"./index-DbvXYXc0.js";import{I as h}from"./input-Bf8YvsU0.js";import{L as d}from"./label-DMFTECDG.js";import{C as Ce,b as Se,c as Ne,d as we,a as Pe}from"./card-6tZ6FSP9.js";import{S as D,a as O,b as E,d as R,e as p}from"./select-895Ag1Vf.js";import{D as Le,b as ke,c as Fe,d as De,e as Oe}from"./dialog-CvL19ZOf.js";import{C as Ee}from"./circle-alert-CwItFlME.js";import{S as re}from"./search-DsOkoVxz.js";import{N as Re}from"./navigation-CqPPssKH.js";import"./index-UZKPKpE4.js";import"./index-CB20-cGd.js";import"./Combination-B6rQ859v.js";import"./index-9AnY3iUi.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";import"./index-AD6gynWr.js";import"./index-DE3TGyh9.js";const Me=[{label:"Beirut",value:"beirut"},{label:"Mount Lebanon",value:"mount-liban"},{label:"North",value:"north"},{label:"South",value:"south"},{label:"Bekaa",value:"bekaa"},{label:"Baalbek",value:"baalbek"},{label:"Keserwan",value:"keserwan"},{label:"Nabatieh",value:"nabatieh"},{label:"Akkar",value:"akkar"}];function Ie(m){if(!m||typeof m!="string")return null;const y=m.trim(),r=y.match(/@(-?\d+\.?\d*),(-?\d+\.?\d*)/);if(r)return{lat:parseFloat(r[1]),lng:parseFloat(r[2])};const b=y.match(/[?&]q=(-?\d+\.?\d*),(-?\d+\.?\d*)/);if(b)return{lat:parseFloat(b[1]),lng:parseFloat(b[2])};const j=y.match(/(?:!3d|!4d|!1d)(-?\d+\.?\d*)/g);if(j&&j.length>=2){const u=parseFloat(String(j[0]).replace(/\D/g,"")),x=parseFloat(String(j[1]).replace(/\D/g,""));if(!isNaN(u)&&!isNaN(x))return{lat:u,lng:x}}return null}function ts(){const m=_e(),y=f.useMemo(()=>`cp_${Date.now()}_${Math.random().toString(16).slice(2)}`,[]),r=(...o)=>{console.log(`[CompleteProfile ${y}]`,...o)},b=()=>{try{r("axios.baseURL =",P?.defaults?.baseURL),r("axios.withCredentials =",P?.defaults?.withCredentials),r("axios.headers.Authorization =",P?.defaults?.headers?.common?.Authorization)}catch(o){r("Failed to read axios defaults",o)}},j=o=>{try{const t=[];for(const[a,l]of o.entries())l instanceof File?t.push({key:a,type:"File",name:l.name,size:l.size,mime:l.type}):t.push({key:a,type:typeof l,value:l});return r("FormData entries =>",t),t}catch(t){return r("Failed to dump FormData",t),null}},[u,x]=f.useState(null),[_,S]=f.useState(!1),[M,K]=f.useState(null),[s,N]=f.useState({first_name:"",last_name:"",gender:"",birth_date:"",city:"",bio:"",profile_picture:null,id_card_front:null,id_card_back:null,license_number:"",driver_license:null,profession:"",avg_salary:"",promo_code:"",business_type:"",company_number:"",business_doc:null,location:"",app_fees:"",contract_form:"",policies:"",website:""}),[G,T]=f.useState(!1),[ne,I]=f.useState(!1),[v,q]=f.useState(null),[le,V]=f.useState({lat:33.8547,lng:35.8623}),[$,ie]=f.useState(""),[Q,ce]=f.useState(""),[de,Y]=f.useState(!1),[H,X]=f.useState(""),[pe,W]=f.useState(!1),A=u?.role==="client",B=u?.role==="agency"||u?.role==="agency",ue=o=>o?String(o).slice(0,10):"",me=o=>{const t=o?.user||{},a=o?.client||t?.client||{},l=o?.agency||t?.agency||o?.agency||{};N(n=>({...n,first_name:t.first_name??n.first_name??"",last_name:t.last_name??n.last_name??"",gender:t.gender??n.gender??"",birth_date:ue(t.birth_date)||n.birth_date||"",city:t.city??n.city??"",bio:t.bio??n.bio??"",license_number:a.license_number??n.license_number??"",profession:a.profession??n.profession??"",avg_salary:a.avg_salary??n.avg_salary??"",promo_code:a.promo_code??n.promo_code??"",business_type:l.business_type??n.business_type??"",company_number:l.company_number??n.company_number??"",location:l.location?typeof l.location=="string"?l.location:JSON.stringify(l.location):n.location??"",app_fees:l.app_fees??n.app_fees??"",contract_form:l.contract_form??n.contract_form??"",policies:l.policies??n.policies??"",website:l.website??n.website??""}));const c=(l.business_type||"").toString();if(T(c==="company"),l.location)try{const n=typeof l.location=="string"?JSON.parse(l.location):l.location;n.latitude&&n.longitude&&(q({lat:n.latitude,lng:n.longitude}),V({lat:n.latitude,lng:n.longitude}))}catch(n){r("Failed to parse existing location",n)}},fe=()=>{if(!navigator.geolocation){i.error("Geolocation is not supported by your browser"),Z();return}i.info("Getting your location...");const o={enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4};navigator.geolocation.getCurrentPosition(t=>{const a={lat:parseFloat(t.coords.latitude.toFixed(6)),lng:parseFloat(t.coords.longitude.toFixed(6))};q(a),V(a);const l={latitude:a.lat,longitude:a.lng,country:"Lebanon"};N(c=>({...c,location:JSON.stringify(l)})),i.success("Location detected successfully!"),r("Current location:",l)},t=>{r("Geolocation error:",t),i.info("Location could not be detected. Select your location on the map."),I(!0)},o)},Z=()=>{I(!0)},ge=(o,t)=>{const a={lat:parseFloat(o.toFixed(6)),lng:parseFloat(t.toFixed(6))};q(a),r("Map clicked location:",a)},he=()=>{if(v){const o={latitude:v.lat,longitude:v.lng,country:"Lebanon"};N(t=>({...t,location:JSON.stringify(o)})),i.success("Location selected!"),I(!1)}else i.error("Please select a location on the map")},ee=o=>{const t=Ie(o);if(t){const a={lat:parseFloat(t.lat.toFixed(6)),lng:parseFloat(t.lng.toFixed(6))};q(a),V(a);const l={latitude:a.lat,longitude:a.lng,country:"Lebanon"};N(c=>({...c,location:JSON.stringify(l)})),i.success("Location set from Google Maps link.")}else i.error("Could not read coordinates. Use a link with lat,lng (e.g. @33.89,35.50 or ?q=33.89,35.50).")},se=async(o,t)=>{const a=o.trim();if(a){t?W(!0):Y(!0);try{const c=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}&limit=1`,{headers:{Accept:"application/json"}})).json();if(c&&c[0]){const n=parseFloat(c[0].lat),k=parseFloat(c[0].lon),J={lat:n,lng:k};q(J),V(J);const F={latitude:n,longitude:k,country:"Lebanon"};N(U=>({...U,location:JSON.stringify(F)})),i.success("Location found. Confirm in the modal if needed.")}else i.error("No results found. Try another search.")}catch{i.error("Search failed. Try again.")}finally{t?W(!1):Y(!1)}}},ae=()=>se(Q,!1),oe=()=>se(H,!0),xe=async()=>{try{b(),r("GET /profile/status starting...");const o=await P.get("/profile/status",{headers:{"X-Debug-Id":y}});if(r("GET /profile/status success:",o.status,o.data),K(o.data),me(o.data),o.data?.is_complete){const t=o.data.user;r("Profile already complete. Redirecting. role =",t?.role),t?.role==="agency"||t?.role==="agency"?m("/Dashboard"):m("/")}}catch(o){r("GET /profile/status FAILED",o),o?.response&&r("Status error response:",o.response.status,o.response.data)}};f.useEffect(()=>{const o=JSON.parse(localStorage.getItem("user"));if(!o){i.error("Please login first"),m("/auth");return}x(o),r("Loaded user from localStorage:",o),xe()},[m]);const g=o=>{const{name:t,value:a,files:l}=o.target;if(l){const c=l[0]||null;N(n=>({...n,[t]:c})),r("File changed:",t,c?{name:c.name,size:c.size,type:c.type}:null);return}N(c=>({...c,[t]:a})),r("Field changed:",t,a),t==="business_type"&&T(a==="company")},L=(o,t)=>{N(a=>({...a,[o]:t})),r("Select changed:",o,t),o==="business_type"&&T(t==="company")},ye=()=>{if(!s.first_name||!s.last_name||!s.gender||!s.birth_date||!s.city)return i.error("Please fill all required base fields"),!1;if(!s.id_card_front||!s.id_card_back)return i.error("Please upload both ID card photos"),!1;if(A){if(!s.license_number||!s.driver_license||!s.profession||!s.avg_salary)return i.error("Please fill all required client fields"),!1;if(!["employee","freelancer","business","student","other"].includes(s.profession))return i.error("Please select a valid profession"),!1;if(!["200-500","500-1000","1000-2000","2000+"].includes(s.avg_salary))return i.error("Please select a valid salary range"),!1}if(B){if(console.log("[CompleteProfile Validate]","Agency validation started",{business_type:s.business_type,profession:s.profession,hasLocation:!!s.location,locationLength:s.location?.length}),!s.business_type||!s.profession)return console.log("[CompleteProfile Validate]","Failed: missing business_type or profession"),i.error("Please fill all required agency fields"),!1;if(!s.location)return console.log("[CompleteProfile Validate]","Failed: no location"),i.error("Please select your agency location. Opening map..."),I(!0),setTimeout(()=>document.getElementById("agency-location-section")?.scrollIntoView({behavior:"smooth"}),100),!1;if(!["rental","private","company","marina"].includes(s.business_type))return console.log("[CompleteProfile Validate]","Failed: invalid business_type",s.business_type),i.error("Please select a valid business type"),!1;if(!["owner","manager"].includes(s.profession))return console.log("[CompleteProfile Validate]","Failed: invalid profession",s.profession),i.error("Please select a valid profession"),!1;try{const a=JSON.parse(s.location);if(!a.latitude||!a.longitude)return console.log("[CompleteProfile Validate]","Failed: location missing lat/lng",a),i.error("Invalid location data. Please select your location again"),!1;console.log("[CompleteProfile Validate]","Location OK",a)}catch(a){return console.log("[CompleteProfile Validate]","Failed: location parse error",a,"raw:",s.location),i.error("Invalid location format. Please select your location again"),!1}if(s.business_type==="company"&&(!s.company_number||!s.business_doc))return console.log("[CompleteProfile Validate]","Failed: company fields",{company_number:s.company_number,business_doc:!!s.business_doc}),i.error("Please fill company number and upload business document"),!1;console.log("[CompleteProfile Validate]","Agency validation passed")}return!0},be=async o=>{o.preventDefault();const t="[CompleteProfile Submit]";if(console.log(t,"Submit clicked",{role:u?.role,isClient:A,isAgency:B,formKeys:Object.keys(s)}),(u?.role==="agency"||u?.role==="agency")&&console.log(t,"Agency form state",{business_type:s.business_type,profession:s.profession,location:s.location,locationParsed:(()=>{try{return s.location?JSON.parse(s.location):null}catch(a){return{parseError:String(a.message)}}})(),company_number:s.company_number,business_doc:s.business_doc?.name??s.business_doc,app_fees:s.app_fees,contract_form:s.contract_form,policies:s.policies,website:s.website}),r("Submit clicked. role =",u?.role,"isClient =",A,"isAgency =",B),b(),!ye()){console.log(t,"Validation failed on client side."),r("Validation failed on client side.");return}try{S(!0);const a=new FormData;if(a.append("first_name",s.first_name),a.append("last_name",s.last_name),a.append("gender",s.gender.toLowerCase()),a.append("birth_date",s.birth_date),a.append("city",s.city.toLowerCase()),a.append("bio",s.bio||""),s.id_card_front&&a.append("id_card_front",s.id_card_front),s.id_card_back&&a.append("id_card_back",s.id_card_back),s.profile_picture&&a.append("profile_picture",s.profile_picture),A)a.append("license_number",s.license_number),s.driver_license&&a.append("driver_license",s.driver_license),a.append("profession",s.profession.toLowerCase()),a.append("avg_salary",s.avg_salary),s.promo_code?.trim()&&a.append("promo_code",s.promo_code.trim());else if(B){console.log("[CompleteProfile Submit]","Building agency FormData..."),a.append("business_type",s.business_type.toLowerCase()),a.append("profession",s.profession.toLowerCase());let F;try{F=JSON.parse(s.location);const C=JSON.stringify({latitude:parseFloat(F.latitude),longitude:parseFloat(F.longitude),country:F.country||"Lebanon"});a.append("location",C),console.log("[CompleteProfile Submit]","Location appended",{cleanedLocation:C,locationData:F})}catch(C){throw console.error("[CompleteProfile Submit]","Location parse/append error",C),console.log("[CompleteProfile Submit]","form.location raw:",s.location),C}s.app_fees?.trim()&&a.append("app_fees",s.app_fees.trim()),s.contract_form?.trim()&&a.append("contract_form",s.contract_form.trim()),s.policies?.trim()&&a.append("policies",s.policies.trim()),s.website?.trim()&&a.append("website",s.website.trim()),s.business_type==="company"&&(a.append("company_number",s.company_number),s.business_doc&&a.append("business_doc",s.business_doc),console.log("[CompleteProfile Submit]","Company fields appended",{company_number:s.company_number,business_doc:s.business_doc?.name??(s.business_doc?"present":"missing")}));const U=[];a.forEach((C,je)=>{U.push({key:je,value:C instanceof File?`File: ${C.name}`:C})}),console.log("[CompleteProfile Submit]","FormData entries (agency)",U)}j(a);const l=P.defaults?.baseURL?`${P.defaults.baseURL}/profile/complete`:"/profile/complete";console.log("[CompleteProfile Submit]","POST /profile/complete",{apiUrl:l,contentType:"multipart/form-data"}),r("POST /profile/complete starting...");const c=await P.post("/profile/complete",a,{headers:{"Content-Type":"multipart/form-data","X-Debug-Id":y}});console.log("[CompleteProfile Submit]","POST /profile/complete success",c.status,c.data),r("POST /profile/complete success:",c.status,c.data);const n=c.data.user;localStorage.setItem("user",JSON.stringify(n)),x(n),i.success("Profile completed successfully!"),r("Refreshing status...");const k=await P.get("/profile/status",{headers:{"X-Debug-Id":y}});r("GET /profile/status after submit:",k.status,k.data),K(k.data);const J=k.data.is_complete;setTimeout(()=>{J?n.role==="agency"||n.role==="agency"?m("/Dashboard"):m("/"):i.warning("Please complete all required fields")},500)}catch(a){if(console.error("[CompleteProfile Submit]","Request failed",a),console.log("[CompleteProfile Submit]","Error name:",a?.name,"message:",a?.message),r("POST /profile/complete FAILED:",a),a?.response){if(console.log("[CompleteProfile Submit]","Response status:",a.response.status),console.log("[CompleteProfile Submit]","Response data:",a.response.data),console.log("[CompleteProfile Submit]","Response headers:",JSON.stringify(a.response.headers,null,2)),r("Error response status:",a.response.status),r("Error response data:",a.response.data),r("Error response headers:",a.response.headers),a.response.status===403){const l=a.response?.data?.message||a.response?.data?.error||"You do not have permission to update your profile. Please contact administrator.";i.error(l);return}typeof a.response.data=="string"&&r("Error response (string, first 500 chars):",a.response.data.slice(0,500)),a.response?.data?.errors?(console.log("[CompleteProfile Submit]","Validation errors (422)",a.response.data.errors),Object.values(a.response.data.errors).flat().forEach(c=>i.error(c))):(console.log("[CompleteProfile Submit]","Error message:",a.response?.data?.message),i.error(a.response?.data?.message||"Failed to complete profile"))}else a?.request?(console.log("[CompleteProfile Submit]","No response received (network/CORS)",a.request),r("No response received. Request:",a.request),i.error("No response from server. Check network/CORS/auth.")):(r("Unknown error:",a?.message||a),i.error("Unexpected error occurred."));r("If you see https://.../api/api/... then your axios baseURL already contains /api and your proxy/route also adds /api."),r("Fix by adjusting api.defaults.baseURL OR Vite proxy OR route prefix so it becomes /api/profile/complete only once.")}finally{S(!1)}};return u?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background via-primary/5 to-secondary/5",children:[e.jsxs("div",{className:"w-full max-w-3xl",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary to-secondary flex items-center justify-center shadow-lg mb-4",children:e.jsx(ve,{className:"w-8 h-8 text-primary-foreground"})}),e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"Complete Your Profile"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:u?.role==="client"?"Client Profile":"Agency Profile"}),M&&e.jsxs("div",{className:"mt-4 w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Profile Completion"}),e.jsxs("span",{className:"text-sm font-semibold",children:[M.completion_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-teal-500 to-cyan-500 h-2 rounded-full transition-all",style:{width:`${M.completion_percentage}%`}})})]})]}),e.jsxs(Ce,{className:"hover-glow shadow-xl",children:[e.jsxs(Se,{children:[e.jsxs(Ne,{className:"text-2xl",children:["Complete Your ",u?.role==="client"?"Client":"agency"," Profile"]}),e.jsx(we,{children:"Please fill all required fields to continue"})]}),e.jsx(Pe,{children:e.jsxs("form",{onSubmit:be,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"First Name *"}),e.jsx(h,{type:"text",name:"first_name",value:s.first_name,onChange:g,required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Last Name *"}),e.jsx(h,{type:"text",name:"last_name",value:s.last_name,onChange:g,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Gender *"}),e.jsxs(D,{value:s.gender,onValueChange:o=>L("gender",o),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Select"})}),e.jsxs(R,{children:[e.jsx(p,{value:"male",children:"Male"}),e.jsx(p,{value:"female",children:"Female"}),e.jsx(p,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Birth Date *"}),e.jsx(h,{type:"date",name:"birth_date",value:s.birth_date,onChange:g,max:new Date().toISOString().split("T")[0],required:!0})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"City *"}),e.jsxs(D,{value:s.city,onValueChange:o=>L("city",o),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Select your city"})}),e.jsxs(R,{children:[e.jsx(p,{value:"beirut",children:"Beirut"}),e.jsx(p,{value:"mount-liban",children:"Mount Liban"}),e.jsx(p,{value:"south",children:"South"}),e.jsx(p,{value:"north",children:"North"}),e.jsx(p,{value:"bekaa",children:"Bekaa"}),e.jsx(p,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Bio (optional)"}),e.jsx("textarea",{name:"bio",value:s.bio,onChange:g,rows:3,className:"w-full px-3 py-2 rounded-md border border-input bg-background",placeholder:"Tell us about yourself..."})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Profile Picture (optional)"}),e.jsx(h,{type:"file",name:"profile_picture",onChange:g,accept:"image/jpeg,image/jpg,image/png"}),s.profile_picture&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.profile_picture.name})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"ID Card - Front *"}),e.jsx(h,{type:"file",name:"id_card_front",onChange:g,accept:"image/jpeg,image/jpg,image/png,application/pdf",required:!0}),s.id_card_front&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.id_card_front.name})]}),e.jsxs("div",{children:[e.jsx(d,{children:"ID Card - Back *"}),e.jsx(h,{type:"file",name:"id_card_back",onChange:g,accept:"image/jpeg,image/jpg,image/png,application/pdf",required:!0}),s.id_card_back&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.id_card_back.name})]})]})]}),e.jsx("hr",{className:"my-6"}),u?.role==="client"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Client Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"License Number *"}),e.jsx(h,{type:"text",name:"license_number",value:s.license_number,onChange:g,required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Driver License *"}),e.jsx(h,{type:"file",name:"driver_license",onChange:g,accept:"image/jpeg,image/jpg,image/png,application/pdf",required:!0}),s.driver_license&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.driver_license.name})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Profession *"}),e.jsxs(D,{value:s.profession,onValueChange:o=>L("profession",o),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Choose..."})}),e.jsxs(R,{children:[e.jsx(p,{value:"employee",children:"Employee"}),e.jsx(p,{value:"freelancer",children:"Freelancer"}),e.jsx(p,{value:"business",children:"Business"}),e.jsx(p,{value:"student",children:"Student"}),e.jsx(p,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Average Salary *"}),e.jsxs(D,{value:s.avg_salary,onValueChange:o=>L("avg_salary",o),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Select..."})}),e.jsxs(R,{children:[e.jsx(p,{value:"200-500",children:"$200-500"}),e.jsx(p,{value:"500-1000",children:"$500-1000"}),e.jsx(p,{value:"1000-2000",children:"$1000-2000"}),e.jsx(p,{value:"2000+",children:"$2000+"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Promo Code (optional)"}),e.jsx(h,{type:"text",name:"promo_code",value:s.promo_code,onChange:g})]})]}),(u?.role==="agency"||u?.role==="agency")&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Agency Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Business Type *"}),e.jsxs(D,{value:s.business_type,onValueChange:o=>{L("business_type",o),T(o==="company")},children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Select"})}),e.jsxs(R,{children:[e.jsx(p,{value:"rental",children:"Rental"}),e.jsx(p,{value:"private",children:"Private"}),e.jsx(p,{value:"company",children:"Company"}),e.jsx(p,{value:"marina",children:"Marina"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Profession *"}),e.jsxs(D,{value:s.profession,onValueChange:o=>L("profession",o),children:[e.jsx(O,{children:e.jsx(E,{placeholder:"Choose..."})}),e.jsxs(R,{children:[e.jsx(p,{value:"manager",children:"Manager"}),e.jsx(p,{value:"owner",children:"Owner"})]})]})]})]}),G&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("p",{children:"Company Details (Required)"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Company Number *"}),e.jsx(h,{type:"text",name:"company_number",value:s.company_number,onChange:g,required:G})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Business Document *"}),e.jsx(h,{type:"file",name:"business_doc",onChange:g,accept:"image/jpeg,image/jpg,image/png,application/pdf",required:G}),s.business_doc&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.business_doc.name})]})]}),e.jsxs("div",{id:"agency-location-section",children:[e.jsx(d,{children:"Address (region) *"}),e.jsxs(D,{value:s.city||"",onValueChange:o=>L("city",o),children:[e.jsx(O,{className:"mb-3",children:e.jsx(E,{placeholder:"Select your region"})}),e.jsx(R,{children:Me.map(o=>e.jsx(p,{value:o.value,children:o.label},o.value))})]}),e.jsx(d,{children:"Location *"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground text-xs",children:"Paste Google Maps link"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(h,{placeholder:"e.g. https://www.google.com/maps/@33.8938,35.5018,17z",value:$,onChange:o=>ie(o.target.value),onBlur:o=>{const t=o.target.value?.trim();t&&ee(t)},className:"flex-1"}),e.jsx(w,{type:"button",variant:"outline",onClick:()=>$.trim()&&ee($),children:"Apply"})]})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-muted-foreground text-xs",children:"Search address"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(h,{placeholder:"Search address or place...",value:Q,onChange:o=>ce(o.target.value),onKeyDown:o=>o.key==="Enter"&&(o.preventDefault(),ae()),className:"flex-1"}),e.jsx(w,{type:"button",variant:"outline",onClick:ae,disabled:de,children:e.jsx(re,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(w,{type:"button",variant:"outline",className:"flex-1 min-w-[140px]",onClick:fe,children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Use Current Location"]}),e.jsxs(w,{type:"button",variant:"outline",className:"flex-1 min-w-[140px]",onClick:Z,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Select on Map"]})]}),v?e.jsx("div",{className:"p-4 bg-primary/10 border-2 border-primary/20 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(z,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm mb-1",children:"Location Selected"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Latitude: ",v.lat]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Longitude: ",v.lng]})]})]})}):e.jsxs("div",{className:"p-4 bg-muted/30 border-2 border-dashed rounded-lg text-center",children:[e.jsx(z,{className:"w-8 h-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No location selected yet"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Click one of the buttons above to set your location"})]}),e.jsx("input",{type:"hidden",name:"location",value:s.location,required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4",children:e.jsxs("div",{children:[e.jsx(d,{children:"Website (optional)"}),e.jsx(h,{type:"url",name:"website",value:s.website,onChange:g,placeholder:"https://example.com"})]})}),e.jsxs("div",{children:[e.jsx(d,{children:"Contract Form (optional)"}),e.jsx("textarea",{name:"contract_form",value:s.contract_form,onChange:g,rows:2,className:"w-full px-3 py-2 rounded-md border border-input bg-background"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Policies (optional)"}),e.jsx("textarea",{name:"policies",value:s.policies,onChange:g,rows:2,className:"w-full px-3 py-2 rounded-md border border-input bg-background"})]})]}),e.jsx(w,{type:"submit",className:"w-full bg-gradient-to-r from-secondary to-accent font-semibold text-lg py-6",disabled:_,children:_?"Saving...":"Save Profile"})]})})]})]}),e.jsx(Le,{open:ne,onOpenChange:o=>{I(o),o||X("")},children:e.jsxs(ke,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(Fe,{children:[e.jsx(De,{children:"Select Your Location"}),e.jsx(Oe,{children:"Search for a place or click on the map to select your business location"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:e.jsxs("div",{className:"flex flex-1 min-w-[200px] rounded-md overflow-hidden border border-input",children:[e.jsx(h,{placeholder:"Search address or place...",value:H,onChange:o=>X(o.target.value),onKeyDown:o=>o.key==="Enter"&&(o.preventDefault(),oe()),className:"rounded-r-none border-0 h-10 focus-visible:ring-0"}),e.jsx(w,{type:"button",variant:"secondary",onClick:oe,disabled:pe,className:"rounded-l-none h-10 px-4",children:e.jsx(re,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"w-full h-[500px] bg-muted rounded-lg overflow-hidden",children:e.jsx(qe,{center:le,selectedLocation:v,onLocationSelect:ge})}),v&&e.jsx("div",{className:"p-3 bg-muted/50 rounded-md",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Selected:"})," ",v.lat,", ",v.lng]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(w,{variant:"outline",onClick:()=>I(!1),children:"Cancel"}),e.jsx(w,{onClick:he,children:"Confirm Location"})]})]})]})})]}):null}function qe({center:m,selectedLocation:y,onLocationSelect:r}){const b=te.useRef(null),j=te.useRef(null);f.useEffect(()=>{if(typeof window<"u"&&!window.L){const x=document.createElement("link");x.rel="stylesheet",x.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(x);const _=document.createElement("script");_.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",_.onload=()=>u(),document.head.appendChild(_)}else window.L&&u()},[]),f.useEffect(()=>{b.current&&window.L&&b.current.setView([parseFloat(m.lat),parseFloat(m.lng)],13)},[m]),f.useEffect(()=>{y&&j.current&&window.L&&j.current.setLatLng([parseFloat(y.lat),parseFloat(y.lng)])},[y]);const u=()=>{if(!window.L||b.current)return;const x=window.L.map("map-container").setView([parseFloat(m.lat),parseFloat(m.lng)],13);window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors"}).addTo(x);const _=window.L.marker([parseFloat(m.lat),parseFloat(m.lng)],{draggable:!0}).addTo(x);_.on("dragend",S=>{const M=S.target.getLatLng();r(M.lat,M.lng)}),x.on("click",S=>{_.setLatLng(S.latlng),r(S.latlng.lat,S.latlng.lng)}),b.current=x,j.current=_};return e.jsx("div",{id:"map-container",className:"w-full h-full"})}export{ts as default};
