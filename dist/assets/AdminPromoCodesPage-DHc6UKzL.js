import{r as n,t as m,j as e,B as c}from"./index-DbvXYXc0.js";import{B as $,b as q,E as G,C as J,D as K,H as Q}from"./adminApi-C-vdNBvN.js";import{C as W,a as X}from"./card-6tZ6FSP9.js";import{B as Y}from"./badge-De3gxj8m.js";import{T as Z,a as ee,b as g,c as p,d as se,e as o}from"./table-Cdzf11jr.js";import{S as C,a as b,b as k,d as y,e as h}from"./select-895Ag1Vf.js";import{D as E,b as F,c as I,d as O}from"./dialog-CvL19ZOf.js";import{I as j}from"./input-Bf8YvsU0.js";import{L as x}from"./label-DMFTECDG.js";import{A as ae,a as re,b as ie,c as te,d as ne,e as oe,f as le,g as ce}from"./alert-dialog-iBykHA9-.js";import{P as de}from"./plus-CKnT-f47.js";import{U as me}from"./users-E8rCSFRH.js";import{R as pe}from"./refresh-cw-BkItMj0z.js";import{S as xe}from"./square-pen-CxEXnCdu.js";import{T as he}from"./trash-2-DiSdLuQ2.js";import"./index-UZKPKpE4.js";import"./index-CB20-cGd.js";import"./Combination-B6rQ859v.js";import"./index-9AnY3iUi.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";import"./index-AD6gynWr.js";import"./index-DE3TGyh9.js";function Ve(){const[w,N]=n.useState([]),[A,D]=n.useState([]),[R,S]=n.useState(!0),[d,P]=n.useState({broker_id:"all",is_active:"all"}),[_,B]=n.useState({open:!1,title:"",message:"",onConfirm:null}),[i,l]=n.useState({open:!1,type:null,item:null}),[r,t]=n.useState({code:"",broker_id:"",description:"",max_uses:"",commission_percentage:"",is_active:!0,expires_at:"",username:"",phone_number:"",email:"",password:"",password_confirmation:"",first_name:"",last_name:""}),u=n.useCallback(async()=>{S(!0);try{const s={per_page:100};d.broker_id!=="all"&&(s.broker_id=d.broker_id),d.is_active!=="all"&&(s.is_active=d.is_active);const a=await $(s),f=a.data?.data??a.data?.promo_codes??a.data;N(Array.isArray(f)?f:[])}catch(s){console.error(s),m.error("Failed to load promo codes"),N([])}finally{S(!1)}},[d.broker_id,d.is_active]),v=n.useCallback(async()=>{try{const s=await q({role:"broker",per_page:200}),a=s.data?.users?.data??s.data?.users??s.data?.data;D(Array.isArray(a)?a:[])}catch(s){console.error(s),D([])}},[]);n.useEffect(()=>{u()},[u]),n.useEffect(()=>{v()},[v]);const H=s=>{B({open:!0,title:"Delete Promo Code",message:`Are you sure you want to delete "${s.code}"?`,onConfirm:async()=>{try{await G(s.id),m.success("Promo code deleted"),u()}catch(a){m.error(a.response?.data?.message||"Delete failed")}}})},L=s=>{t({code:s.code??"",broker_id:s.broker_id?String(s.broker_id):"",description:s.description??"",max_uses:s.max_uses??"",commission_percentage:s.commission_percentage??"",is_active:s.is_active!==!1,expires_at:s.expires_at?s.expires_at.slice(0,10):""}),l({open:!0,type:"edit",item:s})},U=()=>{t({code:"",broker_id:"",description:"",max_uses:"",commission_percentage:"",is_active:!0,expires_at:""}),l({open:!0,type:"create",item:null})},V=()=>{t({username:"",phone_number:"",email:"",password:"",password_confirmation:"",first_name:"",last_name:""}),l({open:!0,type:"create-broker",item:null})},z=async()=>{try{const s={code:r.code.trim(),broker_id:r.broker_id?parseInt(r.broker_id,10):null,description:r.description.trim()||null,max_uses:r.max_uses?parseInt(r.max_uses,10):null,commission_percentage:r.commission_percentage?parseFloat(r.commission_percentage):0,is_active:r.is_active,expires_at:r.expires_at||null};i.type==="edit"?(await J(i.item.id,s),m.success("Promo code updated")):(await K(s),m.success("Promo code created")),l({open:!1,type:null,item:null}),u()}catch(s){const a=s.response?.data?.message||s.response?.data?.errors&&Object.values(s.response.data.errors).flat().join(" ")||"Failed";m.error(a)}},M=async()=>{try{await Q({username:r.username.trim(),phone_number:r.phone_number.trim(),email:r.email.trim()||void 0,password:r.password,password_confirmation:r.password_confirmation,first_name:r.first_name.trim(),last_name:r.last_name.trim()}),m.success("Broker created"),l({open:!1,type:null,item:null}),v(),u()}catch(s){const a=s.response?.data?.message||s.response?.data?.errors&&Object.values(s.response.data.errors).flat().join(" ")||"Failed";m.error(a)}},T=Array.isArray(w)?w:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Promo Codes"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(c,{onClick:U,children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Create Promo Code"]}),e.jsxs(c,{variant:"outline",onClick:V,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Create Broker"]}),e.jsxs(C,{value:d.broker_id,onValueChange:s=>P(a=>({...a,broker_id:s})),children:[e.jsx(b,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Broker"})}),e.jsxs(y,{children:[e.jsx(h,{value:"all",children:"All brokers"}),A.map(s=>e.jsx(h,{value:String(s.id),children:s.username||[s.first_name,s.last_name].filter(Boolean).join(" ")||`#${s.id}`},s.id))]})]}),e.jsxs(C,{value:d.is_active,onValueChange:s=>P(a=>({...a,is_active:s})),children:[e.jsx(b,{className:"w-[130px]",children:e.jsx(k,{placeholder:"Status"})}),e.jsxs(y,{children:[e.jsx(h,{value:"all",children:"All"}),e.jsx(h,{value:"true",children:"Active"}),e.jsx(h,{value:"false",children:"Inactive"})]})]})]}),e.jsx(c,{variant:"outline",size:"icon",onClick:u,"aria-label":"Refresh",children:e.jsx(pe,{className:"w-4 h-4"})})]}),e.jsx(W,{children:e.jsx(X,{className:"p-0",children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(g,{children:[e.jsx(p,{children:"Code"}),e.jsx(p,{children:"Broker"}),e.jsx(p,{children:"Description"}),e.jsx(p,{children:"Uses"}),e.jsx(p,{children:"Commission %"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Expires"}),e.jsx(p,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(se,{children:R?e.jsx(g,{children:e.jsx(o,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"Loading..."})}):T.length===0?e.jsx(g,{children:e.jsx(o,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No promo codes found"})}):T.map(s=>e.jsxs(g,{children:[e.jsx(o,{className:"font-mono font-semibold",children:s.code}),e.jsx(o,{children:s.broker?s.broker.username||[s.broker.first_name,s.broker.last_name].filter(Boolean).join(" ")||"—":"N/A"}),e.jsx(o,{className:"max-w-[200px] truncate",children:s.description||"—"}),e.jsxs(o,{children:[s.current_uses??0," / ",s.max_uses??"∞"]}),e.jsxs(o,{children:[s.commission_percentage??0,"%"]}),e.jsx(o,{children:e.jsx(Y,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(o,{children:s.expires_at?new Date(s.expires_at).toLocaleDateString():"No expiry"}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>L(s),"aria-label":"Edit",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>H(s),"aria-label":"Delete",className:"text-destructive",children:e.jsx(he,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsx(E,{open:i.open&&(i.type==="create"||i.type==="edit"),onOpenChange:s=>!s&&l({open:!1,type:null,item:null}),children:e.jsxs(F,{className:"max-w-md",children:[e.jsx(I,{children:e.jsx(O,{children:i.type==="edit"?"Edit Promo Code":"Create Promo Code"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Code"}),e.jsx(j,{value:r.code,onChange:s=>t(a=>({...a,code:s.target.value})),placeholder:"PROMO20",disabled:i.type==="edit"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Broker"}),e.jsxs(C,{value:r.broker_id,onValueChange:s=>t(a=>({...a,broker_id:s})),children:[e.jsx(b,{children:e.jsx(k,{placeholder:"Select broker"})}),e.jsxs(y,{children:[e.jsx(h,{value:"",children:"None"}),A.map(s=>e.jsx(h,{value:String(s.id),children:s.username||`#${s.id}`},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Description (optional)"}),e.jsx(j,{value:r.description,onChange:s=>t(a=>({...a,description:s.target.value})),placeholder:"Description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Max uses (optional)"}),e.jsx(j,{type:"number",min:0,value:r.max_uses,onChange:s=>t(a=>({...a,max_uses:s.target.value})),placeholder:"∞"})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Commission %"}),e.jsx(j,{type:"number",min:0,step:.01,value:r.commission_percentage,onChange:s=>t(a=>({...a,commission_percentage:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(x,{children:"Expires at (optional)"}),e.jsx(j,{type:"date",value:r.expires_at,onChange:s=>t(a=>({...a,expires_at:s.target.value}))})]}),i.type==="edit"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"active",checked:r.is_active,onChange:s=>t(a=>({...a,is_active:s.target.checked}))}),e.jsx(x,{htmlFor:"active",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>l({open:!1,type:null,item:null}),children:"Cancel"}),e.jsx(c,{onClick:z,children:i.type==="edit"?"Update":"Create"})]})]})]})}),e.jsx(E,{open:i.open&&i.type==="create-broker",onOpenChange:s=>!s&&l({open:!1,type:null,item:null}),children:e.jsxs(F,{className:"max-w-md",children:[e.jsx(I,{children:e.jsx(O,{children:"Create Broker"})}),e.jsxs("div",{className:"space-y-4",children:[["username","first_name","last_name","phone_number","email","password","password_confirmation"].map(s=>e.jsxs("div",{children:[e.jsx(x,{children:s.replace(/_/g," ")}),e.jsx(j,{type:s.includes("password")?"password":"text",value:r[s],onChange:a=>t(f=>({...f,[s]:a.target.value})),placeholder:s,required:["username","first_name","last_name","phone_number","password","password_confirmation"].includes(s)})]},s)),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>l({open:!1,type:null,item:null}),children:"Cancel"}),e.jsx(c,{onClick:M,children:"Create Broker"})]})]})]})}),e.jsx(ae,{open:_.open,onOpenChange:s=>B(a=>({...a,open:s})),children:e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsx(te,{children:_.title}),e.jsx(ne,{children:_.message})]}),e.jsxs(oe,{children:[e.jsx(le,{children:"Cancel"}),e.jsx(ce,{onClick:_.onConfirm,children:"Confirm"})]})]})})]})}export{Ve as default};
