import{d as ee,r as c,j as e,B as h,b as w,t as p}from"./index-DbvXYXc0.js";import{T as se,a as te,b as P,c as x,d as ne,e as u}from"./table-Cdzf11jr.js";import{I as m}from"./input-Bf8YvsU0.js";import{S as v,a as N,b,d as S,e as d}from"./select-895Ag1Vf.js";import{B as L}from"./badge-De3gxj8m.js";import{D as $,b as T,c as E,d as k,e as I}from"./dialog-CvL19ZOf.js";import{L as _}from"./label-DMFTECDG.js";import{P as ae}from"./plus-CKnT-f47.js";import{R as re}from"./refresh-cw-BkItMj0z.js";import{E as ie}from"./eye--wIqRW1l.js";import{S as ce}from"./square-pen-CxEXnCdu.js";import"./index-UZKPKpE4.js";import"./index-CB20-cGd.js";import"./Combination-B6rQ859v.js";import"./index-9AnY3iUi.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";import"./index-AD6gynWr.js";import"./index-DE3TGyh9.js";const le=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],de=ee("arrow-up-down",le),oe={paid:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",cancelled:"bg-red-100 text-red-700"},ue={income:"bg-blue-100 text-blue-700",expense:"bg-purple-100 text-purple-700"};function me(t,n=14){return t?t.length>n?`${t.slice(0,n)}...`:t:"N/A"}function ze(){const[t,n]=c.useState([]),[V,U]=c.useState(!1),[g,F]=c.useState(""),[C,H]=c.useState(!1),[M,B]=c.useState(!1),[l,q]=c.useState(null),[W,A]=c.useState(!1),[i,j]=c.useState(null),[G,D]=c.useState(!1),[a,o]=c.useState({user_id:"",amount:"",source:"cash",type:"income",status:"pending",due_date:"",description:""}),y=async()=>{U(!0);try{const{data:s}=await w.get("/admin/payments",{params:{per_page:50}});n(s.payments?.data||[])}catch{p.error("Failed to load payments")}finally{U(!1)}};c.useEffect(()=>{y()},[]);const R=c.useMemo(()=>{let s=[...t];return g&&(s=s.filter(r=>`${r.id} ${r.reference_id} ${r.user?.first_name??""} ${r.user?.last_name??""}`.toLowerCase().includes(g.toLowerCase()))),s.sort((r,f)=>C?r.amount-f.amount:f.amount-r.amount),s},[t,g,C]),z=s=>{q(s),B(!0)},Z=s=>{j({...s}),A(!0)},J=async()=>{try{const s={status:i.status,source:i.source,due_date:i.due_date,description:i.description};await w.put(`/admin/payments/${i.id}`,s),p.success("Payment updated"),A(!1),y()}catch{p.error("Failed to update payment")}},K=async()=>{try{const s={user_id:Number(a.user_id),amount:Number(a.amount),source:a.source,type:a.type,status:a.status,due_date:a.due_date,description:a.description};await w.post("/admin/payments",s),p.success("Payment created"),D(!1),o({user_id:"",amount:"",source:"cash",type:"income",status:"pending",due_date:"",description:""}),y()}catch{p.error("Failed to create payment")}},Q="/avatar.png",X="https://rento-lb.com/api/storage/",Y=s=>{const r=s?.user.profile_picture;if(!r)return Q;if(r.startsWith("http"))return r;const f=r.startsWith("/")?r.slice(1):r;return X+f};return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Payments"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{size:"sm",onClick:()=>D(!0),children:[e.jsx(ae,{size:16,className:"mr-1"}),"Add Payment"]}),e.jsx(m,{placeholder:"Search…",className:"h-8 w-48 text-xs",value:g,onChange:s=>F(s.target.value)}),e.jsx(h,{size:"icon",variant:"ghost","aria-label":"Sort amount",onClick:()=>H(!C),children:e.jsx(de,{size:16})}),e.jsx(h,{size:"icon",variant:"ghost","aria-label":"Refresh payments",onClick:y,children:e.jsx(re,{size:16})})]})]}),e.jsx("div",{className:"rounded-xl border bg-background",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(P,{children:[e.jsx(x,{children:"ID"}),e.jsx(x,{children:"User"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Source"}),e.jsx(x,{children:"Amount"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsxs(ne,{children:[R.map(s=>e.jsxs(P,{children:[e.jsx(u,{children:e.jsx("span",{className:"item-name-hover inline-flex items-center gap-2 cursor-pointer",title:xe(s),role:"button",tabIndex:0,onClick:()=>z(s),children:s.id})}),e.jsx(u,{children:e.jsxs("span",{className:"item-name-hover inline-flex items-center gap-2 cursor-pointer",title:he(s),children:[e.jsx("img",{src:Y(s),alt:s.user.username||"User",className:"h-7 w-7 rounded-full object-cover",onError:r=>{r.currentTarget.onerror=null,r.currentTarget.src="/avatar.png"}}),me(s.user?`${s.user.first_name} ${s.user.last_name}`:"—",14)]})}),e.jsx(u,{children:e.jsx(L,{className:ue[s.type],children:s.type})}),e.jsx(u,{children:e.jsx(L,{className:oe[s.status],children:s.status})}),e.jsx(u,{children:s.source}),e.jsxs(u,{children:["$",s.amount]}),e.jsxs(u,{className:"flex justify-end gap-1",children:[e.jsx(h,{size:"icon",variant:"ghost","aria-label":"View payment",onClick:()=>z(s),children:e.jsx(ie,{size:16})}),e.jsx(h,{size:"icon",variant:"ghost","aria-label":"Edit payment",onClick:()=>Z(s),children:e.jsx(ce,{size:16})})]})]},s.id)),!V&&R.length===0&&e.jsx(P,{children:e.jsx(u,{colSpan:7,className:"text-center py-10 text-muted-foreground",children:"No payments found"})})]})]})}),e.jsx($,{open:M,onOpenChange:B,children:e.jsxs(T,{className:"max-w-3xl",children:[e.jsxs(E,{children:[e.jsx(k,{children:"Payment Details"}),e.jsx(I,{children:"Read-only"})]}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",l.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Reference:"})," ",l.reference_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"User:"})," ",l.user?.first_name," ",l.user?.last_name]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",l.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",l.status]}),e.jsxs("div",{children:[e.jsx("b",{children:"Source:"})," ",l.source]}),e.jsxs("div",{children:[e.jsx("b",{children:"Amount:"})," $",l.amount]}),e.jsxs("div",{children:[e.jsx("b",{children:"Due:"})," ",new Date(l.due_date).toLocaleString()]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("b",{children:"Description:"})," ",l.description||"—"]})]})]})}),e.jsx($,{open:W,onOpenChange:A,children:e.jsxs(T,{className:"max-w-xl",children:[e.jsxs(E,{children:[e.jsx(k,{children:"Edit Payment"}),e.jsx(I,{children:"Editable fields only"})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Status"}),e.jsxs(v,{value:i.status,onValueChange:s=>j({...i,status:s}),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(S,{children:[e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Source"}),e.jsx(m,{value:i.source,onChange:s=>j({...i,source:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Due Date"}),e.jsx(m,{type:"datetime-local",value:i.due_date?.slice(0,16),onChange:s=>j({...i,due_date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(_,{children:"Description"}),e.jsx(m,{value:i.description||"",onChange:s=>j({...i,description:s.target.value})})]}),e.jsx(h,{className:"w-full",onClick:J,children:"Save Changes"})]})]})}),e.jsx($,{open:G,onOpenChange:D,children:e.jsxs(T,{className:"max-w-xl",children:[e.jsxs(E,{children:[e.jsx(k,{children:"Add Payment"}),e.jsx(I,{children:"Create a new payment"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(m,{type:"number",placeholder:"User ID",value:a.user_id,onChange:s=>o({...a,user_id:s.target.value})}),e.jsx(m,{type:"number",placeholder:"Amount",value:a.amount,onChange:s=>o({...a,amount:s.target.value})}),e.jsxs(v,{value:a.type,onValueChange:s=>o({...a,type:s}),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(S,{children:[e.jsx(d,{value:"income",children:"Income"}),e.jsx(d,{value:"expense",children:"Expense"})]})]}),e.jsxs(v,{value:a.status,onValueChange:s=>o({...a,status:s}),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(S,{children:[e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs(v,{value:a.source,onValueChange:s=>o({...a,source:s}),children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(S,{children:[e.jsx(d,{value:"cash",children:"Cash"}),e.jsx(d,{value:"bank",children:"Bank"})]})]}),e.jsx(m,{type:"datetime-local",value:a.due_date,onChange:s=>o({...a,due_date:s.target.value})}),e.jsx(m,{placeholder:"Description",value:a.description,onChange:s=>o({...a,description:s.target.value})}),e.jsx(h,{className:"w-full",onClick:K,children:"Create Payment"})]})]})})]})}function he(t){if(!t)return"";const n=t.user||{};return[`User ID : ${n.id??"N/A"}`,`Real User ID : ${n.real_user_id??"N/A"}`,`Username : ${n.username??"N/A"}`,`Phone Number : ${n.phone_number??"N/A"}`,`Email : ${n.email??"N/A"}`,`Verified ByAadmin : ${n.verified_by_admin??"N/A"}`,`Gender : ${n.gender??"N/A"}`,`Birth Date : ${je(n.birth_date??"N/A")}`,`City : ${n.city??"N/A"}`,`Bio : ${n.bio??"N/A"}`,`Role : ${n.role??"N/A"}`].join(`
`)}function xe(t){return t?[`User ID : ${t.user_id??"N/A"}`,`Name : ${t.name??"N/A"}`,`Issue Date : ${O(t.issue_date??"N/A")}`,`Due Date : ${O(t.due_date??"N/A")}`,`Reference ID : ${t.reference_id??"N/A"}`,`Description : ${t.description??"N/A"}`].join(`
`):""}function je(t){if(!t)return"N/A";const n=new Date(t);return Number.isNaN(n.getTime())?String(t):n.toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}function O(t){if(!t)return"N/A";const n=new Date(t);return Number.isNaN(n.getTime())?String(t):n.toLocaleString("en-US",{timeZone:"Asia/Beirut",month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0})}export{ze as default};
