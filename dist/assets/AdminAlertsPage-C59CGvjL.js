import{c as T,r,J as B,t as h,E,j as e,B as n,G as L}from"./index-DbvXYXc0.js";import{C as z,b as R,c as F,a as V}from"./card-6tZ6FSP9.js";import{B as G}from"./badge-De3gxj8m.js";import{S as C,a as v,b,d as k,e as i}from"./select-895Ag1Vf.js";import{B as w}from"./bell-B1cSwKnk.js";import{C as I}from"./check-check-DZSXyF6p.js";import{L as K}from"./loader-circle-zgEhsu46.js";import{K as $}from"./key-round-Wdy0QvLf.js";import{U as D}from"./user-check-CXyQ1CX7.js";import{C as H}from"./chevron-right-DaEW3pZI.js";import"./index-UZKPKpE4.js";import"./index-CB20-cGd.js";import"./Combination-B6rQ859v.js";import"./index-9AnY3iUi.js";import"./index-DXYwaiuf.js";import"./index-D66kppzp.js";import"./index-ddclwrTJ.js";import"./index-P5EQzgSd.js";import"./check-nqnuVgMJ.js";const J={profile_completed:{label:"Profile completed",icon:D,color:"bg-emerald-100 text-emerald-800 border-emerald-300"},new_otp:{label:"New OTP sent",icon:$,color:"bg-amber-100 text-amber-800 border-amber-300"}};function ue(){const f=T(),[g,j]=r.useState([]),[l,S]=r.useState({current_page:1,last_page:1,per_page:20,total:0}),[N,m]=r.useState(0),[P,_]=r.useState(!1),[p,U]=r.useState(!1),[o,A]=r.useState(20),[c,d]=r.useState(1),u=r.useCallback(async()=>{_(!0);try{const a={per_page:o,page:c};p&&(a.unread_only=!0);const t=await B(a),s=t.data?.notifications??t.data,O=s?.data??(Array.isArray(s)?s:[]);j(O),S({current_page:s?.current_page??1,last_page:s?.last_page??1,per_page:s?.per_page??o,total:s?.total??0}),t.data?.unread_count!=null&&m(t.data.unread_count)}catch(a){h.error(a.response?.data?.message||"Failed to load notifications"),j([])}finally{_(!1)}},[c,o,p]),x=r.useCallback(async()=>{try{const a=await E(),t=a.data?.unread_count??a.data?.count??0;m(t)}catch{m(0)}},[]);r.useEffect(()=>{u()},[u]),r.useEffect(()=>{x()},[x]);const y=async a=>{try{await L(a?{notification_ids:a}:{mark_all:!0}),h.success(a?"Marked as read.":"All marked as read."),u(),x()}catch(t){h.error(t.response?.data?.message||"Failed to mark as read")}},M=a=>{const t=a.type,s=a.data||{};t==="profile_completed"&&s.user_id?f("/admin/real-user-data",{state:{highlightUserId:s.user_id}}):t==="new_otp"&&f("/admin/otps")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(w,{className:"w-6 h-6"}),"My Alerts"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Profile completed and new OTP notifications. Mark as read and open user or OTPs from here."}),e.jsxs(z,{children:[e.jsxs(R,{children:[e.jsx(F,{className:"text-sm",children:"Notifications"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 pt-2",children:[e.jsxs(C,{value:p?"unread":"all",onValueChange:a=>{U(a==="unread"),d(1)},children:[e.jsx(v,{className:"w-36",children:e.jsx(b,{})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"All"}),e.jsx(i,{value:"unread",children:"Unread only"})]})]}),e.jsxs(C,{value:String(o),onValueChange:a=>{A(Number(a)),d(1)},children:[e.jsx(v,{className:"w-24",children:e.jsx(b,{})}),e.jsxs(k,{children:[e.jsx(i,{value:"10",children:"10"}),e.jsx(i,{value:"20",children:"20"}),e.jsx(i,{value:"50",children:"50"})]})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>y(),children:[e.jsx(I,{className:"w-4 h-4 mr-1"}),"Mark all read"]}),N>0&&e.jsxs(G,{variant:"secondary",children:["Unread: ",N]})]})]}),e.jsxs(V,{children:[P?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(K,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):g.length===0?e.jsx("p",{className:"text-center py-8 text-muted-foreground",children:"No notifications"}):e.jsx("ul",{className:"space-y-2",children:g.map(a=>{const t=J[a.type]||{label:a.type,icon:w,color:"bg-muted"},s=t.icon;return e.jsxs("li",{className:`flex items-center gap-3 rounded-lg border p-3 ${a.is_read?"bg-card":"bg-primary/5 border-primary/20"}`,children:[e.jsx("div",{className:`rounded-full p-2 ${t.color}`,children:e.jsx(s,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:a.title||t.label}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.notification_text??a.message??""}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.created_at?new Date(a.created_at).toLocaleString():""})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!a.is_read&&e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>y([a.id]),children:"Mark read"}),(a.type==="profile_completed"||a.type==="new_otp")&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>M(a),children:["Open",e.jsx(H,{className:"w-4 h-4 ml-1"})]})]})]},a.id)})}),l.last_page>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Page ",l.current_page," of ",l.last_page," Â· Total ",l.total]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",disabled:c<=1,onClick:()=>d(a=>a-1),children:"Previous"}),e.jsx(n,{variant:"outline",size:"sm",disabled:c>=l.last_page,onClick:()=>d(a=>a+1),children:"Next"})]})]})]})]})]})}export{ue as default};
