{"version":3,"file":"AdminAlertsPage-C59CGvjL.js","sources":["../../src/pages/admin/AdminAlertsPage.jsx"],"sourcesContent":["/**\n * Super Admin Alerts\n * Lists notifications received by the super admin (GET /api/notifications):\n * - profile_completed: user completed profile -> link to user / real-user-data\n * - new_otp: OTP sent -> link to OTPs page\n * Unread count, mark as read (single or all).\n */\n\nimport React, { useEffect, useState, useCallback } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { getNotifications, getUnreadNotificationsCount, markNotificationsAsRead } from \"@/lib/api\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Bell, Loader2, UserCheck, KeyRound, CheckCheck, ChevronRight } from \"lucide-react\";\nimport { toast } from \"sonner\";\n\nconst TYPE_CONFIG = {\n  profile_completed: {\n    label: \"Profile completed\",\n    icon: UserCheck,\n    color: \"bg-emerald-100 text-emerald-800 border-emerald-300\",\n  },\n  new_otp: {\n    label: \"New OTP sent\",\n    icon: KeyRound,\n    color: \"bg-amber-100 text-amber-800 border-amber-300\",\n  },\n};\n\nexport default function AdminAlertsPage() {\n  const navigate = useNavigate();\n  const [list, setList] = useState([]);\n  const [meta, setMeta] = useState({ current_page: 1, last_page: 1, per_page: 20, total: 0 });\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [loading, setLoading] = useState(false);\n  const [unreadOnly, setUnreadOnly] = useState(false);\n  const [perPage, setPerPage] = useState(20);\n  const [page, setPage] = useState(1);\n\n  const fetchList = useCallback(async () => {\n    setLoading(true);\n    try {\n      const params = { per_page: perPage, page };\n      if (unreadOnly) params.unread_only = true;\n      const res = await getNotifications(params);\n      const payload = res.data?.notifications ?? res.data;\n      const data = payload?.data ?? (Array.isArray(payload) ? payload : []);\n      setList(data);\n      setMeta({\n        current_page: payload?.current_page ?? 1,\n        last_page: payload?.last_page ?? 1,\n        per_page: payload?.per_page ?? perPage,\n        total: payload?.total ?? 0,\n      });\n      if (res.data?.unread_count != null) setUnreadCount(res.data.unread_count);\n    } catch (err) {\n      toast.error(err.response?.data?.message || \"Failed to load notifications\");\n      setList([]);\n    } finally {\n      setLoading(false);\n    }\n  }, [page, perPage, unreadOnly]);\n\n  const fetchUnreadCount = useCallback(async () => {\n    try {\n      const res = await getUnreadNotificationsCount();\n      const count = res.data?.unread_count ?? res.data?.count ?? 0;\n      setUnreadCount(count);\n    } catch {\n      setUnreadCount(0);\n    }\n  }, []);\n\n  useEffect(() => {\n    fetchList();\n  }, [fetchList]);\n\n  useEffect(() => {\n    fetchUnreadCount();\n  }, [fetchUnreadCount]);\n\n  const handleMarkRead = async (notificationIds) => {\n    try {\n      await markNotificationsAsRead(notificationIds ? { notification_ids: notificationIds } : { mark_all: true });\n      toast.success(notificationIds ? \"Marked as read.\" : \"All marked as read.\");\n      fetchList();\n      fetchUnreadCount();\n    } catch (err) {\n      toast.error(err.response?.data?.message || \"Failed to mark as read\");\n    }\n  };\n\n  const handleNavigate = (notification) => {\n    const type = notification.type;\n    const data = notification.data || {};\n    if (type === \"profile_completed\" && data.user_id) {\n      navigate(\"/admin/real-user-data\", { state: { highlightUserId: data.user_id } });\n    } else if (type === \"new_otp\") {\n      navigate(\"/admin/otps\");\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n        <Bell className=\"w-6 h-6\" />\n        My Alerts\n      </h1>\n      <p className=\"text-sm text-muted-foreground\">\n        Profile completed and new OTP notifications. Mark as read and open user or OTPs from here.\n      </p>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-sm\">Notifications</CardTitle>\n          <div className=\"flex flex-wrap items-center gap-3 pt-2\">\n            <Select value={unreadOnly ? \"unread\" : \"all\"} onValueChange={(v) => { setUnreadOnly(v === \"unread\"); setPage(1); }}>\n              <SelectTrigger className=\"w-36\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All</SelectItem>\n                <SelectItem value=\"unread\">Unread only</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={String(perPage)} onValueChange={(v) => { setPerPage(Number(v)); setPage(1); }}>\n              <SelectTrigger className=\"w-24\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"10\">10</SelectItem>\n                <SelectItem value=\"20\">20</SelectItem>\n                <SelectItem value=\"50\">50</SelectItem>\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" size=\"sm\" onClick={() => handleMarkRead()}>\n              <CheckCheck className=\"w-4 h-4 mr-1\" />\n              Mark all read\n            </Button>\n            {unreadCount > 0 && (\n              <Badge variant=\"secondary\">Unread: {unreadCount}</Badge>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {loading ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : list.length === 0 ? (\n            <p className=\"text-center py-8 text-muted-foreground\">No notifications</p>\n          ) : (\n            <ul className=\"space-y-2\">\n              {list.map((n) => {\n                const config = TYPE_CONFIG[n.type] || { label: n.type, icon: Bell, color: \"bg-muted\" };\n                const Icon = config.icon;\n                return (\n                  <li\n                    key={n.id}\n                    className={`flex items-center gap-3 rounded-lg border p-3 ${!n.is_read ? \"bg-primary/5 border-primary/20\" : \"bg-card\"}`}\n                  >\n                    <div className={`rounded-full p-2 ${config.color}`}>\n                      <Icon className=\"w-4 h-4\" />\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium\">{n.title || config.label}</p>\n                      <p className=\"text-sm text-muted-foreground truncate\">\n                        {n.notification_text ?? n.message ?? \"\"}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {n.created_at ? new Date(n.created_at).toLocaleString() : \"\"}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {!n.is_read && (\n                        <Button variant=\"ghost\" size=\"sm\" onClick={() => handleMarkRead([n.id])}>\n                          Mark read\n                        </Button>\n                      )}\n                      {(n.type === \"profile_completed\" || n.type === \"new_otp\") && (\n                        <Button variant=\"outline\" size=\"sm\" onClick={() => handleNavigate(n)}>\n                          Open\n                          <ChevronRight className=\"w-4 h-4 ml-1\" />\n                        </Button>\n                      )}\n                    </div>\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n          {meta.last_page > 1 && (\n            <div className=\"flex justify-between items-center mt-4 text-sm\">\n              <span className=\"text-muted-foreground\">\n                Page {meta.current_page} of {meta.last_page} Â· Total {meta.total}\n              </span>\n              <div className=\"flex gap-2\">\n                <Button variant=\"outline\" size=\"sm\" disabled={page <= 1} onClick={() => setPage((p) => p - 1)}>\n                  Previous\n                </Button>\n                <Button variant=\"outline\" size=\"sm\" disabled={page >= meta.last_page} onClick={() => setPage((p) => p + 1)}>\n                  Next\n                </Button>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["TYPE_CONFIG","UserCheck","KeyRound","AdminAlertsPage","navigate","useNavigate","list","setList","useState","meta","setMeta","unreadCount","setUnreadCount","loading","setLoading","unreadOnly","setUnreadOnly","perPage","setPerPage","page","setPage","fetchList","useCallback","params","res","getNotifications","payload","data","err","toast","fetchUnreadCount","getUnreadNotificationsCount","count","useEffect","handleMarkRead","notificationIds","markNotificationsAsRead","handleNavigate","notification","type","jsxs","jsx","Bell","Card","CardHeader","CardTitle","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","Button","CheckCheck","Badge","CardContent","Loader2","n","config","Icon","ChevronRight","p"],"mappings":"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"}