import{d as oe,i as ce,c as de,u as me,r as o,j as e,B as x,H as G,M as W,a as ue,L as xe,C as Y,b,t as c}from"./index-DbvXYXc0.js";import{C as g,a as j}from"./card-6tZ6FSP9.js";import{B as C}from"./badge-De3gxj8m.js";import{S}from"./separator-Cq3bSvoa.js";import{D as pe,b as he,c as fe,d as ge,e as je}from"./dialog-CvL19ZOf.js";import{I as A}from"./input-Bf8YvsU0.js";import{L as _}from"./label-DMFTECDG.js";import{C as ve}from"./CarCard-DeNaLndm.js";import{A as J}from"./arrow-left-Bfp2vJNH.js";import{S as K}from"./star-BJn2oNt2.js";import{U as be}from"./users-E8rCSFRH.js";import{F as Ne}from"./fuel-CAXBRakv.js";import{S as ye}from"./settings-C8YQ_pBF.js";import{G as ke}from"./gauge-Df0GzuMn.js";import{C as we}from"./circle-check-CPW3N-42.js";import"./index-AD6gynWr.js";import"./index-UZKPKpE4.js";import"./index-9AnY3iUi.js";import"./Combination-B6rQ859v.js";import"./index-DE3TGyh9.js";import"./message-square-LR42VQJg.js";import"./eye--wIqRW1l.js";import"./arrow-right-Deh_fvqM.js";const De=[["path",{d:"M10 12h.01",key:"1kxr2c"}],["path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14",key:"36qu9e"}],["path",{d:"M2 20h20",key:"owomy5"}]],Ce=oe("door-closed",De),Ze=()=>{const{id:d}=ce(),m=de();me();const[a,R]=o.useState(null),[Q,L]=o.useState(!0),[p,N]=o.useState(!1),[$,M]=o.useState(0),[P,y]=o.useState(!1),[l,h]=o.useState({pickupDate:"",returnDate:"",location:"",reason:""}),[T,E]=o.useState(!1),[B,I]=o.useState(!1),[q,H]=o.useState([]),U=o.useMemo(()=>new Date().toISOString().slice(0,16),[]),V=o.useMemo(()=>a?.images?.length?a.images[Math.min($,a.images.length-1)]:"",[a,$]),X=s=>Array.isArray(s)?s:Array.isArray(s?.cars)?s.cars:Array.isArray(s?.favorites)?s.favorites:Array.isArray(s?.data)?s.data:[],Z=(s,r)=>{const i=String(r);return s.some(t=>t==null?!1:typeof t=="string"||typeof t=="number"?String(t)===i:String(t.id??t.car_id??t.car?.id)===i)};o.useEffect(()=>{let s=!0;return(async()=>{L(!0);try{const t=(await b.get(`/cars/${d}`)).data.car,w=t.feedbacks??[],te=w.length>0?(w.reduce((u,f)=>u+f.rating,0)/w.length).toFixed(1):null,z={id:t.id,brand:t.make,model:t.model,year:t.year,type:t.car_category,seats:t.seats,doors:t.doors,transmission:t.transmission,fuelType:t.fuel_type,mileage:t.mileage,drive:t.wheels_drive,location:t.live_location?.address??"N/A",price:Number(t.daily_rate),holidayRate:Number(t.holiday_rate),rating:te,reviews:w.length,features:t.features??[],description:t.notes??"",images:[t.main_image_url,t.front_image_url,t.back_image_url,t.left_image_url,t.right_image_url].filter(Boolean),deliveryAvailable:!!t.delivery_available};if(!s)return;if(R(z),M(0),localStorage.getItem("authToken")||localStorage.getItem("token")){I(!0);try{const u=await b.get("/cars/favorites/list"),f=X(u.data);if(!s)return;N(Z(f,z.id))}catch{if(!s)return;N(!1)}finally{s&&I(!1)}}else I(!1);try{const u=await b.get("/cars"),f=u.data?.cars??u.data?.data??[],re=(Array.isArray(f)?f:[]).filter(n=>String(n.id)!==String(t.id)).slice(0,3).map(n=>{const D=n.feedbacks??[],le=D.length>0?(D.reduce((ie,ne)=>ie+(Number(ne.rating)||0),0)/D.length).toFixed(1):null;return{id:n.id,brand:n.make,make:n.make,model:n.model,year:n.year,type:n.car_category,category:n.car_category,price:Number(n.daily_rate),image:n.main_image_url,rating:le,reviews:D.length,seats:n.seats,doors:n.doors,fuel_type:n.fuel_type,fuelType:n.fuel_type}});s&&H(re)}catch{s&&H([])}}catch(i){console.error("Car fetch error:",i),c.error("Failed to load car details."),s&&R(null)}finally{s&&L(!1)}})(),window.scrollTo(0,0),()=>{s=!1}},[d]),o.useEffect(()=>{!P||!a||a.deliveryAvailable||h(s=>({...s,location:a.location||"N/A"}))},[P,a]);const k=(()=>{if(!l.pickupDate||!l.returnDate)return 0;const s=new Date(l.pickupDate),r=new Date(l.returnDate),i=Math.ceil((r-s)/(1e3*60*60*24));return i>0?i:0})(),ee=a?k*a.price:0,O=async()=>{if(!a||B)return;if(!(localStorage.getItem("authToken")||localStorage.getItem("token"))){c.error("Please log in to save favorites.");return}const r=!p;N(r),window.dispatchEvent(new Event("favoritesUpdated"));try{await b.post(`/cars/${a.id}/favorite`),c.success(r?"Added to favorites":"Removed from favorites")}catch(i){console.error("Favorite toggle error:",i),N(!r),window.dispatchEvent(new Event("favoritesUpdated")),c.error("Failed to update favorite. Please try again.")}},ae=()=>{if(!a)return!1;if(a.deliveryAvailable&&!l.location.trim())return c.error("Please enter pickup location."),!1;if(!l.pickupDate)return c.error("Please select pickup date/time."),!1;if(!l.returnDate)return c.error("Please select return date/time."),!1;const s=new Date(l.pickupDate);return new Date(l.returnDate)<=s?(c.error("Return date must be after pickup date."),!1):!0},se=async s=>{if(s.preventDefault(),!!ae()){E(!0);try{const r={car_id:a.id,start_datetime:l.pickupDate,end_datetime:l.returnDate,pickup_location:a.deliveryAvailable?l.location:a.location,reason_of_booking:l.reason};(await b.post("/bookings",r)).status===201?(c.success("Booking request submitted successfully! We'll contact you shortly.",{duration:5e3}),y(!1),h({pickupDate:"",returnDate:"",location:"",reason:""})):c.error("Unexpected response from server. Please try again.")}catch(r){console.error("Booking error:",r);let i="Failed to submit booking request. Please try again.";if(r.response){if(r.response.status===400)i=r.response.data.message||i;else if(r.response.status===422){const t=r.response.data.errors;i=Object.values(t).flat().join(`
`)}}c.error(i,{duration:5e3})}finally{E(!1)}}};return Q?e.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading car details..."})]})}):a?e.jsxs("div",{className:"min-h-screen pt-20 bg-background",children:[e.jsx("div",{className:"sticky top-16 z-40 border-b bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between gap-3",children:[e.jsxs(x,{variant:"ghost",onClick:()=>m("/cars"),"aria-label":"Back to cars",children:[e.jsx(J,{className:"w-5 h-5 mr-2","aria-hidden":"true"}),"Back"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:p?"secondary":"outline",onClick:O,"aria-label":p?"Remove from favorites":"Add to favorites",disabled:B,children:[e.jsx(G,{className:`w-4 h-4 mr-2 ${p?"fill-primary text-primary":""}`,"aria-hidden":"true"}),p?"Saved":"Save"]}),e.jsx(x,{onClick:()=>y(!0),className:"bg-gradient-to-r from-teal-600 to-cyan-600 text-white",children:"Book Now"})]})]})}),e.jsxs("div",{className:"container mx-auto px-4 py-6 grid lg:grid-cols-12 gap-6",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-6",children:[e.jsx(g,{className:"overflow-hidden",children:e.jsxs(j,{className:"p-0",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-[16/9] bg-muted",children:V?e.jsx("img",{src:`/api/storage/${V}`,alt:`${a.brand} ${a.model}`,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-muted-foreground",children:"No images available"})}),a.type&&e.jsx("div",{className:"absolute left-4 top-4",children:e.jsx(C,{className:"rounded-full",children:a.type})}),a.rating&&e.jsxs("div",{className:"absolute right-4 top-4 rounded-full bg-background/80 backdrop-blur px-3 py-1 flex items-center gap-2 border",children:[e.jsx(K,{className:"w-4 h-4 fill-yellow-500 text-yellow-500","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-semibold",children:a.rating}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.reviews,")"]})]})]}),a.images?.length>1&&e.jsx("div",{className:"p-4 border-t",children:e.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-6 md:grid-cols-7 gap-2",children:a.images.map((s,r)=>e.jsx("button",{onClick:()=>M(r),className:`relative rounded-lg overflow-hidden border transition ${$===r?"ring-2 ring-primary border-transparent":"hover:border-primary/40"}`,"aria-label":`View image ${r+1}`,children:e.jsx("img",{src:`/api/storage/${s}`,alt:`Thumbnail ${r+1}`,className:"h-14 w-full object-cover",loading:"lazy"})},`${s}-${r}`))})})]})}),e.jsx(g,{children:e.jsxs(j,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold tracking-tight",children:[a.brand," ",a.model," ",e.jsxs("span",{className:"text-muted-foreground font-semibold",children:["(",a.year,")"]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2",children:[e.jsx(Se,{icon:e.jsx(W,{className:"w-4 h-4"}),label:a.location}),e.jsx(C,{variant:"secondary",className:"rounded-full",children:a.deliveryAvailable?"Delivery available":"Pickup only"})]})]}),e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Starting from"}),e.jsxs("p",{className:"text-3xl font-bold",children:["$",a.price,e.jsx("span",{className:"text-sm font-semibold text-muted-foreground",children:"/day"})]}),Number.isFinite(a.holidayRate)&&a.holidayRate>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Holiday: ",e.jsxs("span",{className:"font-semibold",children:["$",a.holidayRate]})]})]})]}),e.jsx(S,{}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(v,{icon:be,label:"Seats",value:a.seats??"N/A"}),e.jsx(v,{icon:Ce,label:"Doors",value:a.doors??"N/A"}),e.jsx(v,{icon:Ne,label:"Fuel",value:a.fuelType??"N/A"}),e.jsx(v,{icon:ye,label:"Transmission",value:a.transmission??"N/A"}),e.jsx(v,{icon:ke,label:"Mileage",value:a.mileage?`${a.mileage} km`:"N/A"}),e.jsx(v,{icon:ue,label:"Drive",value:a.drive??"N/A"})]})]})}),e.jsx(g,{children:e.jsxs(j,{className:"p-5 space-y-3",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Description"}),e.jsx("p",{className:"text-sm leading-relaxed text-muted-foreground",children:a.description?.trim()?a.description:"No description provided."})]})}),a.features?.length>0&&e.jsx(g,{children:e.jsxs(j,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold",children:"Features"}),e.jsxs(C,{variant:"secondary",className:"rounded-full",children:[a.features.length," included"]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 gap-3",children:a.features.map((s,r)=>e.jsxs("div",{className:"flex items-start gap-2 rounded-lg border p-3",children:[e.jsx(we,{className:"w-4 h-4 text-primary mt-0.5","aria-hidden":"true"}),e.jsx("span",{className:"text-sm",children:s})]},`${s}-${r}`))})]})})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsx(g,{className:"sticky top-28",children:e.jsxs(j,{className:"p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(C,{className:"rounded-full w-fit",children:a.type||"Car"}),e.jsxs("h2",{className:"text-lg font-semibold leading-tight",children:[a.brand," ",a.model]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Price: ",e.jsxs("span",{className:"font-semibold",children:["$",a.price,"/day"]})]})]}),a.rating&&e.jsxs("div",{className:"rounded-xl border px-3 py-2 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(K,{className:"w-4 h-4 fill-yellow-500 text-yellow-500","aria-hidden":"true"}),e.jsx("span",{className:"font-semibold",children:a.rating})]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:[a.reviews," reviews"]})]})]}),e.jsx(S,{}),e.jsxs("div",{className:"rounded-xl border bg-muted/30 p-4 space-y-2",children:[e.jsx(F,{label:"Pickup type",value:a.deliveryAvailable?"Delivery":"Pickup only"}),e.jsx(F,{label:"Car location",value:a.location}),e.jsx(F,{label:"Fuel",value:a.fuelType??"N/A"}),e.jsx(F,{label:"Transmission",value:a.transmission??"N/A"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{className:"flex-1 bg-gradient-to-r from-teal-600 to-cyan-600 text-white",onClick:()=>y(!0),children:"Book Now"}),e.jsx(x,{variant:"outline",onClick:O,"aria-label":p?"Remove from favorites":"Add to favorites",disabled:B,children:e.jsx(G,{className:`w-4 h-4 ${p?"fill-primary text-primary":""}`,"aria-hidden":"true"})})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground leading-relaxed",children:"Submit a booking request and our team will confirm availability with you."})]})})})]}),q.length>0&&e.jsxs("div",{className:"container mx-auto px-4 py-6 border-t",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"You might also like"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:q.map(s=>e.jsx(ve,{car:s},s.id))}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx(x,{variant:"outline",asChild:!0,children:e.jsx(xe,{to:"/cars",children:"View all cars"})})})]}),e.jsx(pe,{open:P,onOpenChange:y,children:e.jsxs(he,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsxs(ge,{className:"text-xl",children:["Book ",a.brand," ",a.model]}),e.jsx(je,{className:"text-sm",children:a.deliveryAvailable?"Choose pickup location and rental dates.":"Delivery is not available for this car. Pickup is at the car location."})]}),e.jsxs("form",{onSubmit:se,className:"space-y-4 mt-2",children:[a.deliveryAvailable?e.jsxs("div",{children:[e.jsx(_,{htmlFor:"location",className:"text-xs",children:"Pickup Location *"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(A,{id:"location",required:!0,value:l.location,onChange:s=>h({...l,location:s.target.value}),placeholder:"City, Airport, or Address",className:"pl-8 h-9 text-sm"})]})]}):e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Pickup location"}),e.jsx("p",{className:"text-sm font-semibold",children:a.location||"N/A"}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:"Pickup is at the car location."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"pickupDate",className:"text-xs",children:"Start Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(A,{id:"pickupDate",type:"datetime-local",required:!0,value:l.pickupDate,onChange:s=>h(r=>({...r,pickupDate:s.target.value,returnDate:r.returnDate&&new Date(r.returnDate)<=new Date(s.target.value)?"":r.returnDate})),min:U,className:"pl-8 h-9 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"returnDate",className:"text-xs",children:"End Date *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted-foreground"}),e.jsx(A,{id:"returnDate",type:"datetime-local",required:!0,value:l.returnDate,onChange:s=>h({...l,returnDate:s.target.value}),min:l.pickupDate||U,className:"pl-8 h-9 text-sm"})]})]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"reason",className:"text-xs",children:"Reason (optional)"}),e.jsx(A,{id:"reason",value:l.reason,onChange:s=>h({...l,reason:s.target.value}),placeholder:"Vacation, business trip, wedding...",className:"h-9 text-sm"})]}),e.jsx(S,{}),e.jsxs("div",{className:"rounded-lg border bg-muted/30 p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Daily rate"}),e.jsxs("span",{className:"font-medium",children:["$",a.price,"/day"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Days"}),e.jsx("span",{className:"font-medium",children:k>0?k:"--"})]}),e.jsx(S,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-semibold",children:"Estimated total"}),e.jsx("span",{className:"text-2xl font-bold text-teal-600 dark:text-teal-400",children:k>0?`$${ee}`:"--"})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Final confirmation depends on availability and terms."})]}),e.jsx(x,{type:"submit",className:"w-full bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-700 hover:to-cyan-700 font-semibold h-10 text-sm",disabled:T,children:T?"Submitting...":"Confirm Booking Request"})]})]})})]}):e.jsx("div",{className:"min-h-screen pt-20 flex items-center justify-center p-4 bg-background",children:e.jsx(g,{className:"max-w-md w-full",children:e.jsxs(j,{className:"p-6 text-center space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Car not found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"The vehicle you're looking for doesn't exist or was removed."}),e.jsxs(x,{onClick:()=>m("/cars"),className:"w-full",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Back to Cars"]})]})})})},Se=({icon:d,label:m})=>e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full border bg-background px-3 py-1 text-xs text-muted-foreground",children:[e.jsx("span",{"aria-hidden":"true",children:d}),e.jsx("span",{className:"truncate max-w-[260px]",children:m})]}),v=({icon:d,label:m,value:a})=>e.jsx("div",{className:"rounded-xl border p-4 bg-background hover:bg-muted/30 transition",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(d,{className:"w-5 h-5","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:m}),e.jsx("p",{className:"font-semibold",children:a})]})]})}),F=({label:d,value:m})=>e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:d}),e.jsx("span",{className:"text-xs font-medium text-right",children:m})]});export{Ze as CarDetailPage};
