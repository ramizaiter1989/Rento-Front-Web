{"version":3,"file":"ClientBookingChat-D6Hc8Uvi.js","sources":["../../src/pages/ClientBookingChat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport Echo from 'laravel-echo';\r\nimport Pusher from 'pusher-js';\r\nimport {\r\n  MessageCircle, Send, Phone, Mail, Calendar, Car, Check, CheckCheck,\r\n  Paperclip, Search, Smile, X, ChevronRight, Shield\r\n} from 'lucide-react';\r\nimport api from '@/lib/axios';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n\r\nconst COLORS = {\r\n  darkBlue: '#0E4C81',\r\n  teal: '#008C95',\r\n  limeGreen: '#8AC640',\r\n  darkBlueDim: 'rgba(14, 76, 129, 0.1)',\r\n  tealDim: 'rgba(0, 140, 149, 0.1)',\r\n  limeGreenDim: 'rgba(138, 198, 64, 0.1)',\r\n};\r\n\r\nexport function ClientBookingChat() {\r\n  const [bookings, setBookings] = useState([]);\r\n  const [selectedBooking, setSelectedBooking] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingBookings, setLoadingBookings] = useState(true);\r\n  const [typing, setTyping] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n\r\n  const chatContainerRef = useRef(null);\r\n  const messagesEndRef = useRef(null);\r\n  const echoRef = useRef(null);\r\n  const currentUserId = useRef(null);\r\n  const typingTimeoutRef = useRef(null);\r\n\r\n  const [token] = useState(() => localStorage.getItem('token'));\r\n\r\n  // ✅ Normalize incoming broadcast payload to match your UI expectations\r\n  const normalizeIncomingMessage = (payload, bookingId) => {\r\n    const createdAt =\r\n      payload?.created_at ??\r\n      payload?.createdAt ??\r\n      payload?.data?.created_at ??\r\n      null;\r\n\r\n    // backend might send is_read boolean instead of read_at\r\n    const readAt =\r\n      payload?.read_at ??\r\n      payload?.data?.read_at ??\r\n      (payload?.is_read ? createdAt : null);\r\n\r\n    return {\r\n      id: payload?.id ?? payload?.data?.id ?? `rt-${Date.now()}`,\r\n      booking_id: payload?.booking_id ?? payload?.data?.booking_id ?? bookingId,\r\n      sender_id: payload?.sender_id ?? payload?.data?.sender_id ?? payload?.sender?.id,\r\n      receiver_id: payload?.receiver_id ?? payload?.data?.receiver_id ?? null,\r\n      message: payload?.message ?? payload?.data?.message ?? '',\r\n      read_at: readAt,\r\n      created_at: createdAt,\r\n      sender: payload?.sender ?? payload?.data?.sender ?? null,\r\n    };\r\n  };\r\n\r\n  /** ------------------- INIT ECHO + PROFILE ------------------- **/\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setError('Authentication required. Please log in.');\r\n      return;\r\n    }\r\n\r\n    window.Pusher = Pusher;\r\n\r\n    echoRef.current = new Echo({\r\n      broadcaster: 'pusher',\r\n      key: import.meta.env.VITE_PUSHER_APP_KEY,\r\n      cluster: import.meta.env.VITE_PUSHER_APP_CLUSTER,\r\n      forceTLS: true,\r\n      encrypted: true,\r\n      enabledTransports: ['ws', 'wss'],\r\n      authEndpoint: `${import.meta.env.VITE_API_BASE_URL}/broadcasting/auth`,\r\n      auth: {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n          Accept: 'application/json',\r\n        },\r\n      },\r\n    });\r\n\r\n    // ✅ CONNECTION LOGS\r\n    const pusher = echoRef.current.connector.pusher;\r\n\r\n    pusher.connection.bind('initialized', () => console.log('[PUSHER] initialized'));\r\n    pusher.connection.bind('connecting', () => console.log('[PUSHER] connecting...'));\r\n    pusher.connection.bind('connected', () => console.log('[PUSHER] ✅ connected'));\r\n    pusher.connection.bind('disconnected', () => console.log('[PUSHER] disconnected'));\r\n    pusher.connection.bind('unavailable', () => console.log('[PUSHER] unavailable'));\r\n    pusher.connection.bind('failed', () => console.log('[PUSHER] ❌ failed'));\r\n    pusher.connection.bind('error', (err) => console.error('[PUSHER] error:', err));\r\n\r\n    console.log('[ECHO] authEndpoint:', `${import.meta.env.VITE_API_BASE_URL}/broadcasting/auth`);\r\n    console.log('[ECHO] cluster:', import.meta.env.VITE_PUSHER_APP_CLUSTER);\r\n    console.log('[ECHO] key:', import.meta.env.VITE_PUSHER_APP_KEY);\r\n\r\n    // Optional: debug pusher errors\r\n    try {\r\n      echoRef.current.connector?.pusher?.connection?.bind('error', (err) => {\r\n        console.error('Pusher connection error:', err);\r\n      });\r\n    } catch {}\r\n\r\n    api.get('/profile')\r\n      .then(({ data }) => {\r\n        currentUserId.current = data.user?.id;\r\n        console.log('Current user ID:', currentUserId.current);\r\n      })\r\n      .catch((err) => {\r\n        console.error('Failed to fetch profile:', err);\r\n        setError('Failed to load user profile');\r\n      });\r\n\r\n    return () => {\r\n      echoRef.current?.disconnect();\r\n    };\r\n  }, [token]);\r\n\r\n  /** ------------------- FETCH CLIENT BOOKINGS ------------------- **/\r\n  useEffect(() => {\r\n    if (token) fetchBookings();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [token]);\r\n\r\n  const fetchBookings = async () => {\r\n    setLoadingBookings(true);\r\n    setError(null);\r\n    try {\r\n      // ✅ Your response shape is: { bookings: { data: [...] } }\r\n      const { data } = await api.get('/bookings');\r\n      const all = data?.bookings?.data ?? [];\r\n      // Only show confirmed (or accepted) bookings in chat\r\n      const confirmedOnly = all.filter(\r\n        (b) => b.booking_request_status === 'confirmed' || b.booking_request_status === 'accepted'\r\n      );\r\n      setBookings(confirmedOnly);\r\n    } catch (err) {\r\n      console.error('Failed to fetch bookings:', err);\r\n      setError('Failed to load bookings');\r\n      setBookings([]);\r\n    } finally {\r\n      setLoadingBookings(false);\r\n    }\r\n  };\r\n\r\n  /** ------------------- SCROLL ------------------- **/\r\n  const scrollToBottom = () => {\r\n    const container = chatContainerRef.current;\r\n    if (!container) return;\r\n    container.scrollTop = container.scrollHeight;\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  /** ------------------- LOAD MESSAGES ------------------- **/\r\n  const loadMessages = async (bookingId) => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const { data } = await api.get(`/bookings/${bookingId}/chat`);\r\n      const messagesArray = data?.data?.data ?? data?.data?.messages ?? data?.messages ?? [];\r\n      setMessages(messagesArray);\r\n\r\n      // Mark unread messages as read (messages from other user)\r\n      messagesArray.forEach((msg) => {\r\n        if (!msg.read_at && msg.sender_id !== currentUserId.current) {\r\n          markMessageAsRead(bookingId, msg.id);\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error('Failed to load messages:', err);\r\n      setError('Failed to load messages');\r\n      setMessages([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  /** ------------------- ECHO REAL-TIME ------------------- **/\r\n  useEffect(() => {\r\n    if (!selectedBooking?.id || !echoRef.current) return;\r\n\r\n    const bookingId = selectedBooking.id;\r\n\r\n    // Echo private('booking.1') => Pusher channel is actually \"private-booking.1\"\r\n    const pusherChannelName = `private-booking.${bookingId}`;\r\n\r\n    console.log('[ECHO] subscribing to:', pusherChannelName);\r\n\r\n    const pusher = echoRef.current.connector.pusher;\r\n\r\n    // ✅ subscribe manually to capture subscription status\r\n    const raw = pusher.subscribe(pusherChannelName);\r\n\r\n    raw.bind('pusher:subscription_succeeded', () => {\r\n      console.log('[PUSHER] ✅ subscription_succeeded:', pusherChannelName);\r\n    });\r\n\r\n    raw.bind('pusher:subscription_error', (status) => {\r\n      console.error('[PUSHER] ❌ subscription_error:', pusherChannelName, 'status:', status);\r\n      console.error('-> If status=403, your /broadcasting/auth or channels.php auth is rejecting the user.');\r\n    });\r\n\r\n    const channel = echoRef.current.private(`booking.${bookingId}`);\r\n\r\n    const handleMessageSent = (payload) => {\r\n      const normalized = normalizeIncomingMessage(payload, bookingId);\r\n      // Dedupe: don't add if we already have this message (e.g. added from API after send)\r\n      setMessages((prev) => {\r\n        const exists = prev.some((m) => String(m.id) === String(normalized.id));\r\n        if (exists) return prev;\r\n        return [...prev, normalized];\r\n      });\r\n      if (normalized.sender_id && normalized.sender_id !== currentUserId.current) {\r\n        markMessageAsRead(bookingId, normalized.id);\r\n      }\r\n    };\r\n\r\n    channel.listen('.message.sent', handleMessageSent);\r\n    channel.listen('message.sent', handleMessageSent);\r\n\r\n\r\n    // ✅ typing whisper (you already whisper; this is the receiver side)\r\n    channel.listenForWhisper('typing', (e) => {\r\n      if (e?.user_id && e.user_id !== currentUserId.current) {\r\n        setTyping(true);\r\n        if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n        typingTimeoutRef.current = setTimeout(() => setTyping(false), 3000);\r\n      }\r\n    });\r\n\r\n    channel.listen('.message.read', (e) => console.log('[ECHO] message.read:', e));\r\n\r\n    loadMessages(bookingId);\r\n\r\n    return () => {\r\n      console.log('[ECHO] leaving:', pusherChannelName);\r\n      echoRef.current?.leave(`booking.${bookingId}`);\r\n      pusher.unsubscribe(pusherChannelName);\r\n    };\r\n  }, [selectedBooking?.id]);\r\n\r\n  /** ------------------- SEND MESSAGE ------------------- **/\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMessage.trim() || !selectedBooking?.id) return;\r\n\r\n    const bookingId = selectedBooking.id;\r\n    const messageText = newMessage.trim();\r\n    setNewMessage('');\r\n\r\n    try {\r\n      const { data } = await api.post(`/bookings/${bookingId}/chat`, {\r\n        booking_id: bookingId,\r\n        message: messageText,\r\n      });\r\n\r\n      const saved = data?.data ?? data?.message;\r\n      if (saved) setMessages((prev) => [...prev, saved]);\r\n    } catch (err) {\r\n      console.error('Failed to send message:', err);\r\n      setError('Failed to send message');\r\n      setNewMessage(messageText);\r\n    }\r\n  };\r\n\r\n  /** ------------------- MARK READ ------------------- **/\r\n  const markMessageAsRead = async (bookingId, messageId) => {\r\n    try {\r\n      await api.post(`/bookings/${bookingId}/chat/mark-read`, {\r\n        message_id: messageId,\r\n      });\r\n    } catch (err) {\r\n      console.error('Failed to mark message as read:', err);\r\n    }\r\n  };\r\n\r\n  /** ------------------- UNREAD COUNTS (PER BOOKING) ------------------- **/\r\n  const fetchUnreadCounts = async () => {\r\n    try {\r\n      if (!bookings?.length) return;\r\n\r\n      const results = await Promise.all(\r\n        bookings.map(async (booking) => {\r\n          try {\r\n            const { data } = await api.get(`/bookings/${booking.id}/chat/unread-count`);\r\n\r\n            const count =\r\n              data?.data?.unread_count ??\r\n              data?.data ??\r\n              data?.unread_count ??\r\n              0;\r\n\r\n            return { id: booking.id, count: Number(count) || 0 };\r\n          } catch (e) {\r\n            console.error(`Failed unread count for booking ${booking.id}:`, e);\r\n            return { id: booking.id, count: 0 };\r\n          }\r\n        })\r\n      );\r\n\r\n      const countsById = Object.fromEntries(results.map((r) => [r.id, r.count]));\r\n\r\n      setBookings((prev) =>\r\n        prev.map((b) => ({\r\n          ...b,\r\n          unread_count: countsById[b.id] ?? 0,\r\n        }))\r\n      );\r\n    } catch (err) {\r\n      console.error('Failed to fetch unread counts:', err);\r\n    }\r\n  };\r\n\r\n  // run unread counts periodically (and once after bookings loaded)\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    if (bookings.length) fetchUnreadCounts();\r\n    const interval = setInterval(fetchUnreadCounts, 10000);\r\n    return () => clearInterval(interval);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [token, bookings.length]);\r\n\r\n  /** ------------------- TYPING INDICATOR ------------------- **/\r\n  const handleTyping = () => {\r\n    if (!selectedBooking?.id) return;\r\n\r\n    const bookingId = selectedBooking.id;\r\n\r\n    api.post(`/bookings/${bookingId}/chat/typing`)\r\n      .catch((err) => console.error('Failed to send typing indicator:', err));\r\n\r\n    if (echoRef.current) {\r\n      echoRef.current.private(`booking.${bookingId}`).whisper('typing', {\r\n        user_id: currentUserId.current,\r\n      });\r\n    }\r\n\r\n    if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n\r\n    typingTimeoutRef.current = setTimeout(() => {\r\n      setTyping(false);\r\n    }, 3000);\r\n  };\r\n\r\n  /** ------------------- TIME FORMAT ------------------- **/\r\n  const formatTime = (dateString) => {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    if (Number.isNaN(date.getTime())) return '';\r\n\r\n    const now = new Date();\r\n    const diffInMinutes = Math.floor((now - date) / 60000);\r\n\r\n    if (diffInMinutes < 1) return 'Just now';\r\n    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;\r\n    const diffInHours = Math.floor(diffInMinutes / 60);\r\n    if (diffInHours < 24) return `${diffInHours}h ago`;\r\n    const diffInDays = Math.floor(diffInHours / 24);\r\n    if (diffInDays < 7) return `${diffInDays}d ago`;\r\n\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n  };\r\n\r\n  const formatDateTime = (dateString) => {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    if (Number.isNaN(date.getTime())) return '';\r\n    return date.toLocaleDateString('en-US', {\r\n      month: 'short',\r\n      day: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n  };\r\n\r\n  /** ------------------- FILTER BOOKINGS ------------------- **/\r\n  const filteredBookings = bookings.filter((booking) => {\r\n    if (!searchQuery) return true;\r\n    const query = searchQuery.toLowerCase();\r\n\r\n    const agentName = `${booking.car?.agent?.first_name || ''} ${booking.car?.agent?.last_name || ''}`.toLowerCase();\r\n    const carName = `${booking.car?.make || ''} ${booking.car?.model || ''}`.toLowerCase();\r\n\r\n    return agentName.includes(query) || carName.includes(query);\r\n  });\r\n\r\n  /** ------------------- JSX ------------------- **/\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50 dark:from-black dark:via-gray-900 dark:to-gray-950 pt-20\">\r\n      <div className=\"container mx-auto px-4 py-6\">\r\n\r\n        {/* Header */}\r\n        <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} className=\"mb-6\">\r\n          <div className=\"flex items-center gap-3 mb-2\">\r\n            <div\r\n              className=\"w-12 h-12 rounded-xl flex items-center justify-center shadow-lg\"\r\n              style={{ background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` }}\r\n            >\r\n              <MessageCircle className=\"w-6 h-6 text-white\" />\r\n            </div>\r\n            <div>\r\n              <h1\r\n                className=\"text-3xl font-bold bg-clip-text text-transparent\"\r\n                style={{ backgroundImage: `linear-gradient(135deg, ${COLORS.darkBlue}, ${COLORS.teal}, ${COLORS.limeGreen})` }}\r\n              >\r\n                My Bookings Chat\r\n              </h1>\r\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">Message your car agent</p>\r\n            </div>\r\n          </div>\r\n        </motion.div>\r\n\r\n        {/* Error Banner */}\r\n        <AnimatePresence>\r\n          {error && (\r\n            <motion.div\r\n              initial={{ opacity: 0, y: -10 }}\r\n              animate={{ opacity: 1, y: 0 }}\r\n              exit={{ opacity: 0, y: -10 }}\r\n              className=\"mb-4 p-4 rounded-xl border-2\"\r\n              style={{ background: 'rgba(220, 38, 38, 0.1)', borderColor: '#DC2626' }}\r\n            >\r\n              <p className=\"text-red-800 dark:text-red-200 flex items-center gap-2\">\r\n                <X className=\"w-5 h-5\" />\r\n                {error}\r\n              </p>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4 h-[calc(100vh-180px)]\">\r\n\r\n          {/* Bookings List */}\r\n          <div className=\"lg:col-span-1 bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700\">\r\n\r\n            {/* Search */}\r\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Search conversations...\"\r\n                  value={searchQuery}\r\n                  onChange={(e) => setSearchQuery(e.target.value)}\r\n                  className=\"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 dark:text-white text-sm\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* List */}\r\n            <div className=\"flex-1 overflow-y-auto\">\r\n              {loadingBookings ? (\r\n                <div className=\"flex justify-center items-center h-full\">\r\n                  <div\r\n                    className=\"animate-spin rounded-full h-10 w-10 border-4 border-t-transparent\"\r\n                    style={{ borderColor: COLORS.tealDim, borderTopColor: 'transparent' }}\r\n                  />\r\n                </div>\r\n              ) : filteredBookings.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center h-full p-8 text-gray-400\">\r\n                  <MessageCircle className=\"w-16 h-16 mb-3\" style={{ color: COLORS.teal, opacity: 0.3 }} />\r\n                  <p className=\"text-center font-medium\">No bookings found</p>\r\n                  <p className=\"text-xs text-center mt-1\">Book a car to start chatting</p>\r\n                </div>\r\n              ) : (\r\n                filteredBookings.map((booking) => {\r\n                  const agent = booking.car?.agent;\r\n                  const avatar = agent?.profile_picture\r\n                    ? `/api/storage/${agent.profile_picture}`\r\n                    : '/default-avatar.png';\r\n\r\n                  return (\r\n                    <motion.div\r\n                      key={booking.id}\r\n                      whileHover={{ x: 5 }}\r\n                      onClick={() => setSelectedBooking(booking)}\r\n                      className={`p-4 border-b border-gray-200 dark:border-gray-700 cursor-pointer transition-all ${\r\n                        selectedBooking?.id === booking.id\r\n                          ? 'border-l-4'\r\n                          : 'hover:bg-gray-50 dark:hover:bg-gray-700'\r\n                      }`}\r\n                      style={selectedBooking?.id === booking.id ? { background: COLORS.tealDim, borderLeftColor: COLORS.teal } : {}}\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <div className=\"relative\">\r\n                          <img\r\n                            src={avatar}\r\n                            alt={agent?.first_name || 'Agent'}\r\n                            className=\"w-12 h-12 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                          />\r\n                          {(booking.unread_count ?? 0) > 0 && (\r\n                            <motion.div\r\n                              animate={{ scale: [1, 1.2, 1] }}\r\n                              transition={{ duration: 1, repeat: Infinity }}\r\n                              className=\"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center shadow-lg\"\r\n                              style={{ background: COLORS.limeGreen }}\r\n                            >\r\n                              <span className=\"text-xs text-white font-bold\">{booking.unread_count}</span>\r\n                            </motion.div>\r\n                          )}\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 min-w-0\">\r\n                          <div className=\"flex items-center justify-between mb-1\">\r\n                            <h3 className=\"font-semibold text-gray-900 dark:text-white truncate flex items-center gap-1\">\r\n                              {agent?.first_name || 'N/A'} {agent?.last_name || ''}\r\n                              {agent?.verified_by_admin && (\r\n                                <Shield className=\"w-3 h-3\" style={{ color: COLORS.teal }} />\r\n                              )}\r\n                            </h3>\r\n                            {(booking.unread_count ?? 0) > 0 && (\r\n                              <ChevronRight className=\"w-4 h-4\" style={{ color: COLORS.teal }} />\r\n                            )}\r\n                          </div>\r\n                          <p className=\"text-xs text-gray-600 dark:text-gray-400 truncate flex items-center gap-1\">\r\n                            <Car className=\"w-3 h-3\" />\r\n                            {booking.car?.make || 'N/A'} {booking.car?.model || ''}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </motion.div>\r\n                  );\r\n                })\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Chat Area */}\r\n          <div className=\"lg:col-span-2 bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700\">\r\n            {selectedBooking ? (\r\n              <>\r\n                {/* Chat Header */}\r\n                <div\r\n                  className=\"p-4 text-white relative overflow-hidden\"\r\n                  style={{ background: `linear-gradient(135deg, ${COLORS.darkBlue}, ${COLORS.teal}, ${COLORS.limeGreen})` }}\r\n                >\r\n                  <div className=\"absolute top-0 right-0 w-48 h-48 bg-white/10 rounded-full blur-3xl\"></div>\r\n                  <div className=\"absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full blur-2xl\"></div>\r\n\r\n                  <div className=\"relative z-10\">\r\n                    <div className=\"flex items-center justify-between mb-3\">\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <img\r\n                          src={\r\n                            selectedBooking.car?.agent?.profile_picture\r\n                              ? `/api/storage/${selectedBooking.car.agent.profile_picture}`\r\n                              : '/default-avatar.png'\r\n                          }\r\n                          alt={selectedBooking.car?.agent?.first_name || 'Agent'}\r\n                          className=\"w-12 h-12 rounded-full object-cover border-2 border-white shadow-lg\"\r\n                        />\r\n                        <div>\r\n                          <h2 className=\"text-lg font-bold flex items-center gap-2\">\r\n                            {selectedBooking.car?.agent?.first_name || 'N/A'} {selectedBooking.car?.agent?.last_name || ''}\r\n                            {selectedBooking.car?.agent?.verified_by_admin && <Shield className=\"w-4 h-4\" />}\r\n                          </h2>\r\n                          <p className=\"text-xs opacity-90\">Car Agent</p>\r\n                        </div>\r\n                      </div>\r\n\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {selectedBooking.car?.agent?.phone_number && (\r\n                          <motion.a\r\n                            whileHover={{ scale: 1.1 }}\r\n                            whileTap={{ scale: 0.9 }}\r\n                            href={`tel:${selectedBooking.car.agent.phone_number}`}\r\n                            className=\"p-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors\"\r\n                          >\r\n                            <Phone className=\"w-4 h-4\" />\r\n                          </motion.a>\r\n                        )}\r\n                        {selectedBooking.car?.agent?.email && (\r\n                          <motion.a\r\n                            whileHover={{ scale: 1.1 }}\r\n                            whileTap={{ scale: 0.9 }}\r\n                            href={`mailto:${selectedBooking.car.agent.email}`}\r\n                            className=\"p-2 bg-white/20 backdrop-blur-sm rounded-xl hover:bg-white/30 transition-colors\"\r\n                          >\r\n                            <Mail className=\"w-4 h-4\" />\r\n                          </motion.a>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"p-3 bg-white/10 backdrop-blur-sm rounded-xl\">\r\n                      <div className=\"grid grid-cols-2 gap-3 text-sm\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Car className=\"w-4 h-4\" />\r\n                          <span className=\"truncate\">{selectedBooking.car?.make || 'N/A'} {selectedBooking.car?.model || ''}</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Calendar className=\"w-4 h-4\" />\r\n                          <span className=\"truncate\">\r\n                            {selectedBooking.start_datetime ? formatDateTime(selectedBooking.start_datetime) : 'N/A'}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Messages */}\r\n                <div\r\n                  ref={chatContainerRef}\r\n                  className=\"flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50/50 to-white dark:from-gray-900/50 dark:to-gray-800\"\r\n                  style={{ maxHeight: 'calc(100vh - 450px)' }}\r\n                >\r\n                  {loading ? (\r\n                    <div className=\"flex justify-center items-center h-full\">\r\n                      <div\r\n                        className=\"animate-spin rounded-full h-10 w-10 border-4 border-t-transparent\"\r\n                        style={{ borderColor: COLORS.tealDim, borderTopColor: 'transparent' }}\r\n                      />\r\n                    </div>\r\n                  ) : messages.length === 0 ? (\r\n                    <div className=\"flex flex-col items-center justify-center h-full text-gray-400\">\r\n                      <div className=\"w-20 h-20 rounded-full flex items-center justify-center mb-4\" style={{ background: COLORS.tealDim }}>\r\n                        <MessageCircle className=\"w-10 h-10\" style={{ color: COLORS.teal }} />\r\n                      </div>\r\n                      <p className=\"text-lg font-medium\">No messages yet</p>\r\n                      <p className=\"text-sm\">Start the conversation!</p>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      {messages.map((message, index) => {\r\n                        const isMe =\r\n                          message.sender_id === currentUserId.current ||\r\n                          message.sender?.id === currentUserId.current;\r\n\r\n                        const prev = messages[index - 1];\r\n                        const showAvatar = index === 0 || prev?.sender_id !== message.sender_id;\r\n\r\n                        return (\r\n                          <motion.div\r\n                            key={message.id}\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            className={`flex items-end gap-2 ${isMe ? 'justify-end' : 'justify-start'}`}\r\n                          >\r\n                            {!isMe && showAvatar && (\r\n                              <img\r\n                                src={\r\n                                  message.sender?.profile_picture\r\n                                    ? `/api/storage/${message.sender.profile_picture}`\r\n                                    : '/default-avatar.png'\r\n                                }\r\n                                alt={message.sender?.first_name || 'User'}\r\n                                className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                              />\r\n                            )}\r\n                            {!isMe && !showAvatar && <div className=\"w-8\" />}\r\n\r\n                            <div className={`flex flex-col ${isMe ? 'items-end' : 'items-start'} max-w-[70%]`}>\r\n                              <motion.div\r\n                                whileHover={{ scale: 1.02 }}\r\n                                className={`rounded-2xl px-4 py-2 shadow-md ${\r\n                                  isMe\r\n                                    ? 'text-white rounded-br-none'\r\n                                    : 'bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-bl-none border border-gray-200 dark:border-gray-600'\r\n                                }`}\r\n                                style={isMe ? { background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` } : {}}\r\n                              >\r\n                                <p className=\"text-sm whitespace-pre-wrap break-words leading-relaxed\">{message.message}</p>\r\n                              </motion.div>\r\n\r\n                              <div className=\"flex items-center gap-1 mt-1 px-1\">\r\n                                <span className=\"text-xs text-gray-500 dark:text-gray-400\">{formatTime(message.created_at)}</span>\r\n                                {isMe && (\r\n                                  <span>\r\n                                    {message.read_at ? (\r\n                                      <CheckCheck className=\"w-3 h-3\" style={{ color: COLORS.teal }} />\r\n                                    ) : (\r\n                                      <Check className=\"w-3 h-3 text-gray-400\" />\r\n                                    )}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n\r\n                            {isMe && showAvatar && (\r\n                              <img\r\n                                src={\r\n                                  message.sender?.profile_picture\r\n                                    ? `/api/storage/${message.sender.profile_picture}`\r\n                                    : '/default-avatar.png'\r\n                                }\r\n                                alt={message.sender?.first_name || 'You'}\r\n                                className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                              />\r\n                            )}\r\n                            {isMe && !showAvatar && <div className=\"w-8\" />}\r\n                          </motion.div>\r\n                        );\r\n                      })}\r\n                      <div ref={messagesEndRef} />\r\n                    </>\r\n                  )}\r\n\r\n                  {/* Typing */}\r\n                  <AnimatePresence>\r\n                    {typing && (\r\n                      <motion.div\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: 10 }}\r\n                        className=\"flex items-center gap-2\"\r\n                      >\r\n                        <img\r\n                          src={\r\n                            selectedBooking.car?.agent?.profile_picture\r\n                              ? `/api/storage/${selectedBooking.car.agent.profile_picture}`\r\n                              : '/default-avatar.png'\r\n                          }\r\n                          alt={selectedBooking.car?.agent?.first_name || 'Agent'}\r\n                          className=\"w-8 h-8 rounded-full object-cover ring-2 ring-white dark:ring-gray-700\"\r\n                        />\r\n                        <div className=\"bg-white dark:bg-gray-700 rounded-2xl rounded-bl-none px-4 py-3 border border-gray-200 dark:border-gray-600\">\r\n                          <div className=\"flex gap-1\">\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.teal, animationDelay: '0ms' }} />\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.darkBlue, animationDelay: '150ms' }} />\r\n                            <div className=\"w-2 h-2 rounded-full animate-bounce\" style={{ background: COLORS.limeGreen, animationDelay: '300ms' }} />\r\n                          </div>\r\n                        </div>\r\n                      </motion.div>\r\n                    )}\r\n                  </AnimatePresence>\r\n                </div>\r\n\r\n                {/* Input */}\r\n                <div className=\"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\r\n                  <div className=\"flex items-end gap-2\">\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.1 }}\r\n                      whileTap={{ scale: 0.9 }}\r\n                      className=\"p-2 rounded-xl transition-colors\"\r\n                      style={{ background: COLORS.tealDim, color: COLORS.teal }}\r\n                      type=\"button\"\r\n                    >\r\n                      <Paperclip className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.1 }}\r\n                      whileTap={{ scale: 0.9 }}\r\n                      className=\"p-2 rounded-xl transition-colors\"\r\n                      style={{ background: COLORS.limeGreenDim, color: COLORS.limeGreen }}\r\n                      type=\"button\"\r\n                    >\r\n                      <Smile className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n\r\n                    <div className=\"flex-1 relative\">\r\n                      <textarea\r\n                        value={newMessage}\r\n                        onChange={(e) => {\r\n                          setNewMessage(e.target.value);\r\n                          // handleTyping();\r\n                        }}\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter' && !e.shiftKey) {\r\n                            e.preventDefault();\r\n                            sendMessage(e);\r\n                          }\r\n                        }}\r\n                        placeholder=\"Type your message...\"\r\n                        rows={1}\r\n                        className=\"w-full px-4 py-3 border-2 border-gray-200 dark:border-gray-600 rounded-xl focus:outline-none focus:ring-2 dark:bg-gray-700 dark:text-white resize-none\"\r\n                      />\r\n                    </div>\r\n\r\n                    <motion.button\r\n                      whileHover={{ scale: 1.05 }}\r\n                      whileTap={{ scale: 0.95 }}\r\n                      onClick={sendMessage}\r\n                      disabled={!newMessage.trim()}\r\n                      className=\"p-3 rounded-xl text-white font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl\"\r\n                      style={{ background: `linear-gradient(135deg, ${COLORS.teal}, ${COLORS.darkBlue})` }}\r\n                      type=\"button\"\r\n                    >\r\n                      <Send className=\"w-5 h-5\" />\r\n                    </motion.button>\r\n                  </div>\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <div className=\"flex-1 flex flex-col items-center justify-center\">\r\n                <motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className=\"text-center\">\r\n                  <div\r\n                    className=\"w-24 h-24 rounded-full flex items-center justify-center mb-6 mx-auto\"\r\n                    style={{ background: `linear-gradient(135deg, ${COLORS.tealDim}, ${COLORS.limeGreenDim})` }}\r\n                  >\r\n                    <MessageCircle className=\"w-12 h-12\" style={{ color: COLORS.teal }} />\r\n                  </div>\r\n                  <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Select a Booking</h3>\r\n                  <p className=\"text-gray-600 dark:text-gray-400\">Choose a conversation to start chatting</p>\r\n                </motion.div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["COLORS","ClientBookingChat","bookings","setBookings","useState","selectedBooking","setSelectedBooking","messages","setMessages","newMessage","setNewMessage","loading","setLoading","loadingBookings","setLoadingBookings","typing","setTyping","error","setError","searchQuery","setSearchQuery","chatContainerRef","useRef","messagesEndRef","echoRef","currentUserId","typingTimeoutRef","token","normalizeIncomingMessage","payload","bookingId","createdAt","readAt","useEffect","Pusher","Echo","pusher","err","api","data","fetchBookings","confirmedOnly","b","scrollToBottom","container","loadMessages","messagesArray","msg","markMessageAsRead","pusherChannelName","raw","status","channel","handleMessageSent","normalized","prev","m","e","sendMessage","messageText","saved","messageId","fetchUnreadCounts","results","booking","count","countsById","r","interval","formatTime","dateString","date","diffInMinutes","diffInHours","diffInDays","formatDateTime","filteredBookings","query","agentName","carName","jsxs","jsx","motion","MessageCircle","AnimatePresence","X","Search","agent","avatar","Shield","ChevronRight","Car","Fragment","Phone","Mail","Calendar","message","index","isMe","showAvatar","CheckCheck","Check","Paperclip","Smile","Send"],"mappings":"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"}