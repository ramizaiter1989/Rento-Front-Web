{"version":3,"file":"AdminCarsPage-2GbL4ich.js","sources":["../../src/pages/admin/AdminCarsPage.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useState } from \"react\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport api from \"@/lib/axios\";\r\nimport { getCars, getCar, updateCar, updateCarPhoto, updateCarAcceptReject, downloadCarImage, deleteCar as deleteCarApi, getAgencies } from \"@/lib/adminApi\";\r\nimport {\r\n  Search,\r\n  Car,\r\n  Download,\r\n  Check,\r\n  X,\r\n  Eye,\r\n  Trash2,\r\n  Edit,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  MapPin,\r\n  Navigation,\r\n  Building2,\r\n} from \"lucide-react\";\r\n\r\n\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\n\r\nimport {\r\n  Select,\r\n  SelectTrigger,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n// Start Tony Update\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\n// End Tony Update\r\nconst PER_PAGE = 20;\r\n\r\n// Lebanese governorates / regions for address dropdown (same as Add Car)\r\nconst ADDRESS_OPTIONS = [\r\n  { label: \"Select region...\", value: \"\" },\r\n  { label: \"Beirut\", value: \"Beirut\" },\r\n  { label: \"Mount Lebanon\", value: \"Mount Lebanon\" },\r\n  { label: \"North\", value: \"North\" },\r\n  { label: \"South\", value: \"South\" },\r\n  { label: \"Bekaa\", value: \"Bekaa\" },\r\n  { label: \"Baalbek\", value: \"Baalbek\" },\r\n  { label: \"Keserwan\", value: \"Keserwan\" },\r\n  { label: \"Nabatieh\", value: \"Nabatieh\" },\r\n  { label: \"Akkar\", value: \"Akkar\" },\r\n];\r\n\r\nfunction parseGoogleMapsLink(url) {\r\n  if (!url || typeof url !== \"string\") return null;\r\n  const trimmed = url.trim();\r\n  const atMatch = trimmed.match(/@(-?\\d+\\.?\\d*),(-?\\d+\\.?\\d*)/);\r\n  if (atMatch) return { lat: parseFloat(atMatch[1]), lng: parseFloat(atMatch[2]) };\r\n  const qMatch = trimmed.match(/[?&]q=(-?\\d+\\.?\\d*),(-?\\d+\\.?\\d*)/);\r\n  if (qMatch) return { lat: parseFloat(qMatch[1]), lng: parseFloat(qMatch[2]) };\r\n  const llMatch = trimmed.match(/(?:!3d|!4d|!1d)(-?\\d+\\.?\\d*)/g);\r\n  if (llMatch && llMatch.length >= 2) {\r\n    const lat = parseFloat(llMatch[0].replace(/\\D/g, \"\"));\r\n    const lng = parseFloat(llMatch[1].replace(/\\D/g, \"\"));\r\n    if (!isNaN(lat) && !isNaN(lng)) return { lat, lng };\r\n  }\r\n  return null;\r\n}\r\nconst STATUS_OPTIONS = [\r\n  { value: \"all\", label: \"All Status\" },\r\n  { value: \"available\", label: \"Available\" },\r\n  { value: \"not_available\", label: \"Not Available\" },\r\n  { value: \"rented\", label: \"Rented\" },\r\n  { value: \"maintenance\", label: \"Maintenance\" },\r\n];\r\nconst CAR_ACCEPTED_OPTIONS = [\r\n  { value: \"all\", label: \"All\" },\r\n  { value: \"true\", label: \"Accepted\" },\r\n  { value: \"false\", label: \"Not Accepted\" },\r\n];\r\nconst IS_PRIVATE_OPTIONS = [\r\n  { value: \"all\", label: \"All\" },\r\n  { value: \"true\", label: \"Private\" },\r\n  { value: \"false\", label: \"Public\" },\r\n];\r\n\r\nconst AdminCarsPage = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const [cars, setCars] = useState([]);\r\n  const [meta, setMeta] = useState({ current_page: 1, last_page: 1, per_page: PER_PAGE, total: 0 });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n\r\n  // server-side filters (API params)\r\n  const [page, setPage] = useState(1);\r\n  const [statusFilter, setStatusFilter] = useState(\"all\");\r\n  const [carAcceptedFilter, setCarAcceptedFilter] = useState(\"all\");\r\n  const [isPrivateFilter, setIsPrivateFilter] = useState(\"all\");\r\n  const [agentIdFilter, setAgentIdFilter] = useState(\"\");\r\n  const [agents, setAgents] = useState([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n\r\n  // Sync agent_id from URL (e.g. from Agencies page click)\r\n  useEffect(() => {\r\n    const agentId = searchParams.get(\"agent_id\");\r\n    if (agentId != null && agentId !== \"\") {\r\n      setAgentIdFilter(agentId);\r\n    }\r\n  }, [searchParams]);\r\n\r\n  // Load agencies list once for agent-name dropdown filter\r\n  useEffect(() => {\r\n    const fetchAgents = async () => {\r\n      try {\r\n        const res = await getAgencies({\r\n          per_page: 500,\r\n          sort_by: \"username\",\r\n          sort_order: \"asc\",\r\n        });\r\n        const payload = res.data?.agencies ?? res.data;\r\n        const data = payload?.data ?? [];\r\n        setAgents(Array.isArray(data) ? data : []);\r\n      } catch (err) {\r\n        console.error(\"Failed to load agencies for cars filter\", err);\r\n      }\r\n    };\r\n    fetchAgents();\r\n  }, []);\r\n\r\n  // client-side filters (in-memory on current page)\r\n  const [categories, setCategories] = useState([]);\r\n  const [status, setStatus] = useState([]);\r\n  const [sort, setSort] = useState(\"newest\");\r\n  const [showFilters, setShowFilters] = useState(false);\r\n\r\n  // Start Tony Update\r\n  // Modal states\r\n  const [selectedItem, setSelectedItem] = useState(null);\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [modalType, setModalType] = useState(\"\");\r\n\r\n  const { toast } = useToast();\r\n  const [editingCar, setEditingCar] = useState(null);\r\n  // Confirmation dialog state\r\n  const [confirmDialog, setConfirmDialog] = useState({\r\n    open: false,\r\n    title: \"\",\r\n    message: \"\",\r\n    onConfirm: null,\r\n  });\r\n\r\n  const [yearFrom, setYearFrom] = useState(\"\");\r\n  const [yearTo, setYearTo] = useState(\"\");\r\n\r\n  const [rateFrom, setRateFrom] = useState(\"\");\r\n  const [rateTo, setRateTo] = useState(\"\");\r\n\r\n\r\n\r\n//agent logo helper\r\n  const DEFAULT_AGENT_LOGO = \"/avatar.png\";\r\n\r\nconst getAgentLogo = (agent) => {\r\n  if (!agent?.profile_picture) return DEFAULT_AGENT_LOGO;\r\n\r\n  if (agent.profile_picture.startsWith(\"http\")) {\r\n    return agent.profile_picture;\r\n  }\r\n\r\n  const cleaned = agent.profile_picture.startsWith(\"/\")\r\n    ? agent.profile_picture.slice(1)\r\n    : agent.profile_picture;\r\n\r\n  return `${storageBase}${cleaned}`;\r\n};\r\n\r\n\r\n  // End Tony Update\r\n  /* ============================\r\n     Fetch cars (server-side filters + pagination)\r\n  ============================ */\r\n  const fetchCars = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = {\r\n        per_page: PER_PAGE,\r\n        page,\r\n        ...(statusFilter && statusFilter !== \"all\" && { status: statusFilter }),\r\n        ...(carAcceptedFilter && carAcceptedFilter !== \"all\" && { car_accepted: carAcceptedFilter }),\r\n        ...(isPrivateFilter && isPrivateFilter !== \"all\" && { is_private: isPrivateFilter }),\r\n        ...(agentIdFilter && { agent_id: Number(agentIdFilter) }),\r\n        // ...(searchQuery && searchQuery.trim() && { search: searchQuery.trim() }),\r\n      };\r\n      const res = await getCars(params);\r\n      const data = res.data || res;\r\n      const list = Array.isArray(data.cars) ? data.cars : data.cars?.data ?? [];\r\n      const pagination = data.meta || (data.cars && { total: data.cars.total, current_page: data.cars.current_page ?? page, last_page: data.cars.last_page ?? 1, per_page: data.cars.per_page ?? PER_PAGE }) || meta;\r\n      setCars(list);\r\n      setMeta((m) => ({ ...m, ...pagination, total: pagination.total ?? m.total, current_page: pagination.current_page ?? page, last_page: pagination.last_page ?? m.last_page, per_page: pagination.per_page ?? PER_PAGE }));\r\n    } catch (err) {\r\n      if (err.response?.status === 403) {\r\n        toast({ title: \"Access denied\", description: \"Super admin access required\", variant: \"destructive\" });\r\n      } else if (err.response?.status === 401) {\r\n        toast({ title: \"Unauthorized\", description: \"Please log in again\", variant: \"destructive\" });\r\n      } else {\r\n        console.error(\"Failed to load cars\", err);\r\n        toast({ title: \"Error\", description: \"Failed to load cars\", variant: \"destructive\" });\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [page, statusFilter, carAcceptedFilter, isPrivateFilter, agentIdFilter, searchQuery]);\r\n\r\n  useEffect(() => {\r\n    fetchCars();\r\n  }, [fetchCars]);\r\n\r\n  // Fetch car details (single car). Returns full car or null on error.\r\n  const fetchCarDetails = async (id) => {\r\n    try {\r\n      const res = await getCar(id);\r\n      const data = res.data || res;\r\n      return data?.car ?? data ?? null;\r\n    } catch (error) {\r\n      if (error.response?.status === 403) {\r\n        toast({ title: \"Access denied\", description: \"Super admin access required\", variant: \"destructive\" });\r\n      } else if (error.response?.status === 404) {\r\n        toast({ title: \"Full details unavailable\", description: \"Showing list data (GET /admin/cars/{id} returned 404).\", variant: \"destructive\" });\r\n      } else {\r\n        toast({ title: \"Error\", description: \"Failed to fetch car details\", variant: \"destructive\" });\r\n      }\r\n      return null;\r\n    }\r\n  };\r\n\r\n  // Open view modal: show list car immediately, then try to load full details in background\r\n  const openViewCar = (listCar) => {\r\n    setSelectedItem(listCar);\r\n    setModalType(\"view-car\");\r\n    setModalOpen(true);\r\n    fetchCarDetails(listCar.id).then((full) => {\r\n      if (full) setSelectedItem(full);\r\n    });\r\n  };\r\n\r\n  // Open edit modal: show list car immediately, then try to load full details in background.\r\n  // When full details arrive, merge into current state so we don't overwrite user's in-progress edits (focus loss).\r\n  const openEditCar = (listCar) => {\r\n    setSelectedItem(listCar);\r\n    setEditingCar({ ...listCar });\r\n    setModalType(\"edit-car\");\r\n    setModalOpen(true);\r\n    fetchCarDetails(listCar.id).then((full) => {\r\n      if (full) {\r\n        setSelectedItem(full);\r\n        setEditingCar((prev) => (prev && prev.id === full.id ? { ...full, ...prev } : { ...full }));\r\n      }\r\n    });\r\n  };\r\n\r\n  const FALLBACK_IMG = \"/car-avatar.png\";\r\n\r\n  // Car images: /api/storage/{database-url} â€” display and download from this URI\r\n  const storageBase = useMemo(() => {\r\n    const base = import.meta.env.VITE_API_URL || \"\";\r\n    if (!base) return \"/api/storage/\";\r\n    const b = base.trim().replace(/\\/+$/, \"\").replace(/\\/api\\/api\\/?$/, \"\");\r\n    return `${b}/api/storage/`;\r\n  }, []);\r\n  const getStorageUrl = (path) => {\r\n    if (!path) return null;\r\n    if (path.startsWith(\"http\")) return path;\r\n    const clean = path.startsWith(\"/\") ? path.slice(1) : path;\r\n    return `${storageBase}${clean}`;\r\n  };\r\n  const imgUrl = (path) => getStorageUrl(path) || FALLBACK_IMG;\r\n\r\n  const showConfirmDialog = (title, message, onConfirm) => {\r\n    setConfirmDialog({\r\n      open: true,\r\n      title,\r\n      message,\r\n      onConfirm,\r\n    });\r\n  };\r\n  const acceptCar = async (car) => {\r\n    try {\r\n      const res = await updateCarAcceptReject(car.id, true);\r\n      const data = res.data || res;\r\n      const updated = data?.car ?? data ?? { ...car, car_accepted: true };\r\n      setCars((prev) => prev.map((c) => (c.id === car.id ? { ...c, car_accepted: true } : c)));\r\n      if (selectedItem?.id === car.id) setSelectedItem(updated);\r\n      if (editingCar?.id === car.id) setEditingCar(updated);\r\n      toast({ title: \"Success\", description: \"Car accepted successfully\" });\r\n    } catch (e) {\r\n      if (e.response?.status === 403) {\r\n        toast({ title: \"Access denied\", description: \"Super admin access required\", variant: \"destructive\" });\r\n      } else {\r\n        toast({ title: \"Error\", description: e.response?.data?.message || \"Failed to accept car\", variant: \"destructive\" });\r\n      }\r\n    }\r\n  };\r\n\r\n  const rejectCar = async (car) => {\r\n    try {\r\n      const res = await updateCarAcceptReject(car.id, false);\r\n      const data = res.data || res;\r\n      const updated = data?.car ?? data ?? { ...car, car_accepted: false };\r\n      setCars((prev) => prev.map((c) => (c.id === car.id ? { ...c, car_accepted: false } : c)));\r\n      if (selectedItem?.id === car.id) setSelectedItem(updated);\r\n      if (editingCar?.id === car.id) setEditingCar(updated);\r\n      toast({ title: \"Success\", description: \"Car rejected successfully\" });\r\n    } catch (e) {\r\n      if (e.response?.status === 403) {\r\n        toast({ title: \"Access denied\", description: \"Super admin access required\", variant: \"destructive\" });\r\n      } else {\r\n        toast({ title: \"Error\", description: e.response?.data?.message || \"Failed to reject car\", variant: \"destructive\" });\r\n      }\r\n    }\r\n  };\r\n\r\n  const deleteCar = async (id) => {\r\n    try {\r\n      await deleteCarApi(id);\r\n      toast({ title: \"Success\", description: \"Car deleted successfully\" });\r\n      fetchCars();\r\n      setModalOpen(false);\r\n    } catch (error) {\r\n      toast({ title: \"Error\", description: \"Failed to delete car\", variant: \"destructive\" });\r\n    }\r\n  };\r\n\r\n  const toNumber = (v) => {\r\n    if (v === null || v === undefined || v === \"\") return NaN;\r\n\r\n    if (typeof v === \"number\") return v;\r\n\r\n    const cleaned = String(v).replace(/[^0-9.]/g, \"\");\r\n    const n = Number(cleaned);\r\n\r\n    return Number.isNaN(n) ? NaN : n;\r\n  };\r\n\r\n  // End tony Update\r\n  /* ============================\r\n     Filter + sort\r\n  ============================ */\r\n  const filteredCars = useMemo(() => {\r\n  let data = [...cars];\r\n\r\n  // ðŸ”Ž GLOBAL SEARCH (car + agent)\r\n  if (searchQuery && searchQuery.trim()) {\r\n    const q = searchQuery.toLowerCase().trim();\r\n\r\n    data = data.filter((car) =>\r\n      JSON.stringify(car)\r\n        .toLowerCase()\r\n        .includes(q)\r\n    );\r\n  }\r\n\r\n  // categories (multi)\r\n  if (categories.length > 0) {\r\n    const catLower = categories.map((x) => String(x).toLowerCase());\r\n    data = data.filter((c) => catLower.includes((c.car_category || \"\").toLowerCase()));\r\n  }\r\n\r\n  // status (reserved / available)\r\n  if (status.length > 0) {\r\n    data = data.filter((c) => status.includes(c.status));\r\n  }\r\n\r\n  // year range\r\n  const from = yearFrom ? Number(yearFrom) : null;\r\n  const to = yearTo ? Number(yearTo) : null;\r\n\r\n  if (from !== null || to !== null) {\r\n    data = data.filter((c) => {\r\n      const y = Number(c.year);\r\n      if (Number.isNaN(y)) return false;\r\n\r\n      if (from !== null && y < from) return false;\r\n      if (to !== null && y > to) return false;\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  // daily rate range\r\n  const rFrom = rateFrom !== \"\" ? toNumber(rateFrom) : null;\r\n  const rTo = rateTo !== \"\" ? toNumber(rateTo) : null;\r\n\r\n  if (rFrom !== null || rTo !== null) {\r\n    data = data.filter((c) => {\r\n      const rate = toNumber(c.daily_rate);\r\n      if (Number.isNaN(rate)) return false;\r\n\r\n      if (rFrom !== null && !Number.isNaN(rFrom) && rate < rFrom)\r\n        return false;\r\n      if (rTo !== null && !Number.isNaN(rTo) && rate > rTo)\r\n        return false;\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  // sort\r\n  if (sort === \"newest\") {\r\n    data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));\r\n  }\r\n\r\n  if (sort === \"price\") {\r\n    data.sort((a, b) => {\r\n      const ar = toNumber(a.daily_rate);\r\n      const br = toNumber(b.daily_rate);\r\n      if (Number.isNaN(ar) && Number.isNaN(br)) return 0;\r\n      if (Number.isNaN(ar)) return 1;\r\n      if (Number.isNaN(br)) return -1;\r\n      return ar - br;\r\n    });\r\n  }\r\n\r\n  if (sort === \"year_asc\" || sort === \"year_desc\") {\r\n    data.sort((a, b) => {\r\n      const ay = Number(a.year);\r\n      const by = Number(b.year);\r\n      if (Number.isNaN(ay) && Number.isNaN(by)) return 0;\r\n      if (Number.isNaN(ay)) return 1;\r\n      if (Number.isNaN(by)) return -1;\r\n      return sort === \"year_asc\" ? ay - by : by - ay;\r\n    });\r\n  }\r\n\r\n  if (sort === \"views_asc\" || sort === \"views_desc\") {\r\n    data.sort((a, b) => {\r\n      const av = Number(a.views_count);\r\n      const bv = Number(b.views_count);\r\n      if (Number.isNaN(av) && Number.isNaN(bv)) return 0;\r\n      if (Number.isNaN(av)) return 1;\r\n      if (Number.isNaN(bv)) return -1;\r\n      return sort === \"views_asc\" ? av - bv : bv - av;\r\n    });\r\n  }\r\n\r\n  return data;\r\n}, [\r\n  cars,\r\n  searchQuery,   // âœ… IMPORTANT\r\n  categories,\r\n  status,\r\n  sort,\r\n  yearFrom,\r\n  yearTo,\r\n  rateFrom,\r\n  rateTo,\r\n]);\r\n\r\n\r\n\r\n\r\n  /* ============================\r\n     Render\r\n  ============================ */\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <h1 className=\"text-2xl font-bold\">Cars</h1>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\r\n        <div className=\"flex flex-wrap items-center gap-2\">\r\n          <div className=\"relative w-full sm:w-72\">\r\n            <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n            <Input\r\n              placeholder=\"Search make, model, plate, color...\"\r\n              className=\"pl-9 h-9\"\r\n              value={searchQuery}\r\n              onChange={(e) => {\r\n                setSearchQuery(e.target.value);\r\n                setPage(1);\r\n              }}\r\n            />\r\n          </div>\r\n          <Select\r\n            value={agentIdFilter || \"all\"}\r\n            onValueChange={(v) => {\r\n              const next = v === \"all\" ? \"\" : v;\r\n              setAgentIdFilter(next);\r\n              setPage(1);\r\n            }}\r\n          >\r\n            <SelectTrigger className=\"h-9 w-[200px]\">\r\n              <SelectValue placeholder=\"Filter by agency\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"all\">All agencies</SelectItem>\r\n              {agents.map((agent) => (\r\n                <SelectItem key={agent.id} value={String(agent.id)}>\r\n                  {agent.username\r\n                    || (agent.first_name && agent.last_name\r\n                      ? `${agent.first_name} ${agent.last_name}`\r\n                      : `Agency #${agent.id}`)}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n          <Select\r\n            value={statusFilter}\r\n            onValueChange={(v) => {\r\n              setStatusFilter(v);\r\n              setPage(1);\r\n            }}\r\n          >\r\n            <SelectTrigger className=\"h-9 w-[140px]\">\r\n              <SelectValue placeholder=\"Status\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {STATUS_OPTIONS.map((op) => (\r\n                <SelectItem key={op.value} value={op.value}>{op.label}</SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n          <Select\r\n            value={carAcceptedFilter}\r\n            onValueChange={(v) => {\r\n              setCarAcceptedFilter(v);\r\n              setPage(1);\r\n            }}\r\n          >\r\n            <SelectTrigger className=\"h-9 w-[130px]\">\r\n              <SelectValue placeholder=\"Accepted\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {CAR_ACCEPTED_OPTIONS.map((op) => (\r\n                <SelectItem key={op.value} value={op.value}>{op.label}</SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n          <Select\r\n            value={isPrivateFilter}\r\n            onValueChange={(v) => {\r\n              setIsPrivateFilter(v);\r\n              setPage(1);\r\n            }}\r\n          >\r\n            <SelectTrigger className=\"h-9 w-[110px]\">\r\n              <SelectValue placeholder=\"Visibility\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {IS_PRIVATE_OPTIONS.map((op) => (\r\n                <SelectItem key={op.value} value={op.value}>{op.label}</SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-3\">\r\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n            <Car className=\"h-4 w-4\" />\r\n            <span className=\"font-semibold text-foreground\">{meta.total}</span>\r\n            <span>cars</span>\r\n          </div>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setShowFilters((p) => !p)}>\r\n            More filters\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ADVANCED FILTERS */}\r\n      {showFilters && (\r\n        <div className=\"mt-3 rounded-lg border bg-background p-3\">\r\n          <div className=\"flex flex-wrap gap-3 items-end\">\r\n\r\n            {/* Sort */}\r\n            <Select value={sort} onValueChange={setSort}>\r\n              <SelectTrigger className=\"h-9 w-[180px]\">\r\n                <SelectValue placeholder=\"Sort\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"newest\">Newest</SelectItem>\r\n                <SelectItem value=\"price\">Price â†‘</SelectItem>\r\n                <SelectItem value=\"year_asc\">Year â†‘</SelectItem>\r\n                <SelectItem value=\"year_desc\">Year â†“</SelectItem>\r\n                <SelectItem value=\"views_asc\">Views â†‘</SelectItem>\r\n                <SelectItem value=\"views_desc\">Views â†“</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            {/* Category */}\r\n            <Select\r\n              value={categories[0] ?? \"all\"}\r\n              onValueChange={(v) =>\r\n                v === \"all\" ? setCategories([]) : setCategories([v])\r\n              }\r\n            >\r\n              <SelectTrigger className=\"h-9 w-[160px]\">\r\n                <SelectValue placeholder=\"Category\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">All Categories</SelectItem>\r\n                <SelectItem value=\"sedan\">Sedan</SelectItem>\r\n                <SelectItem value=\"hatchback\">Hatchback</SelectItem>\r\n                <SelectItem value=\"coupe\">Coupe</SelectItem>\r\n                <SelectItem value=\"suv\">SUV</SelectItem>\r\n                <SelectItem value=\"crossover\">Crossover</SelectItem>\r\n                <SelectItem value=\"wagon\">Wagon</SelectItem>\r\n                <SelectItem value=\"pickup\">Pickup</SelectItem>\r\n                <SelectItem value=\"minivan\">Minivan</SelectItem>\r\n                <SelectItem value=\"convertible\">Convertible</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            {/* Status */}\r\n            <Select\r\n              value={status[0] ?? \"all\"}\r\n              onValueChange={(v) =>\r\n                v === \"all\" ? setStatus([]) : setStatus([v])\r\n              }\r\n            >\r\n              <SelectTrigger className=\"h-9 w-[150px]\">\r\n                <SelectValue placeholder=\"Status\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">All Status</SelectItem>\r\n                <SelectItem value=\"available\">Available</SelectItem>\r\n                <SelectItem value=\"reserved\">Reserved</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            {/* Year */}\r\n            <Input\r\n              type=\"number\"\r\n              placeholder=\"Year from\"\r\n              className=\"h-9 w-[120px]\"\r\n              value={yearFrom}\r\n              onChange={(e) => setYearFrom(e.target.value)}\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              placeholder=\"Year to\"\r\n              className=\"h-9 w-[120px]\"\r\n              value={yearTo}\r\n              onChange={(e) => setYearTo(e.target.value)}\r\n            />\r\n\r\n            {/* Rate */}\r\n            <Input\r\n              type=\"number\"\r\n              placeholder=\"Rate from\"\r\n              className=\"h-9 w-[120px]\"\r\n              value={rateFrom}\r\n              onChange={(e) => setRateFrom(e.target.value)}\r\n            />\r\n            <Input\r\n              type=\"number\"\r\n              placeholder=\"Rate to\"\r\n              className=\"h-9 w-[120px]\"\r\n              value={rateTo}\r\n              onChange={(e) => setRateTo(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n\r\n      {/* Table */}\r\n      {loading ? (\r\n  <p className=\"text-muted-foreground\">Loading cars...</p>\r\n) : (\r\n  <>\r\n    {/* GRID */}\r\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4\">\r\n      {filteredCars.map((car) => (\r\n        <div\r\n          key={car.id}\r\n          className={`\r\n  border rounded-lg p-3 transition-all duration-300\r\n  ${\r\n    car.car_accepted\r\n      ? \"bg-green-500/10 border-green-500/40 hover:bg-green-500/20 shadow-[0_0_10px_rgba(34,197,94,0.4)]\"\r\n      : \"bg-red-500/10 border-red-500/40 hover:bg-red-500/20 shadow-[0_0_10px_rgba(239,68,68,0.4)]\"\r\n  }\r\n`}\r\n\r\n  \r\n        >\r\n          {/* IMAGE */}\r\n<div className=\"relative h-36 mb-2 overflow-hidden rounded-md\">\r\n  <img\r\n    src={imgUrl(car.main_image_url)}\r\n    alt={car.make}\r\n    className=\"w-full h-full object-cover\"\r\n  />\r\n\r\n {/* Agent Logo + Username */}\r\n          <div className=\"absolute bottom-2 right-2 z-20 flex flex-col items-end gap-0.5\">\r\n            {car.agent?.profile_picture ? (\r\n              <img\r\n                src={\r\n                  car.agent.profile_picture.startsWith(\"http\")\r\n                    ? car.agent.profile_picture\r\n                    : `https://rento-lb.com/api/storage/${car.agent.profile_picture.replace(/^\\/?storage\\//, \"\")}`\r\n                }\r\n                alt={car.agent?.username}\r\n                className=\"w-8 h-8 rounded-full border-2 border-white shadow-md bg-white object-cover\"\r\n                onError={(e) => {\r\n                  e.currentTarget.onerror = null;\r\n                  e.currentTarget.src = \"/avatar.png\";\r\n                }}\r\n              />\r\n            ) : (\r\n              <div className=\"w-8 h-8 rounded-full border-2 border-white shadow-md bg-muted flex items-center justify-center\">\r\n                <Car className=\"w-4 h-4 text-muted-foreground\" />\r\n              </div>\r\n            )}\r\n            {(car.agent?.username != null && car.agent.username !== \"\") && (\r\n              <span className=\"text-[10px] font-medium text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)] bg-black/50 px-1.5 py-0.5 rounded max-w-[80px] truncate\" title={car.agent.username}>\r\n                @{car.agent.username}\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n\r\n</div>\r\n\r\n          {/* TITLE */}\r\n          <h3 className=\"font-semibold text-sm\">\r\n            {car.make} {car.model}\r\n          </h3>\r\n\r\n          {/* BASIC INFO */}\r\n          <div className=\"text-xs text-muted-foreground mt-1 space-y-1\">\r\n            <div>Year: {car.year}</div>\r\n            <div>Rate: ${car.daily_rate}</div>\r\n            <div>Agent: {car.agent?.username || \"â€”\"}</div>\r\n            <div>Views: {car.views_count}</div>\r\n          </div>\r\n\r\n          {/* STATUS */}\r\n          <div className=\"mt-2 flex flex-wrap gap-1\">\r\n            <Badge variant=\"outline\">{car.car_category}</Badge>\r\n\r\n            {car.status === \"available\" && (\r\n              <Badge className=\"bg-green-600\">Available</Badge>\r\n            )}\r\n\r\n            {car.car_accepted ? (\r\n  <Badge className=\"bg-green-500/20 text-green-700 border-green-500/40\">\r\n    Accepted\r\n  </Badge>\r\n) : (\r\n  <Badge className=\"bg-red-500/20 text-red-700 border-red-500/40\">\r\n    Rejected\r\n  </Badge>\r\n)}\r\n\r\n          </div>\r\n\r\n          {/* ACTIONS */}\r\n          <div className=\"flex items-center justify-between mt-3\">\r\n            <div className=\"flex gap-1\">\r\n              <Button\r\n                size=\"icon\"\r\n                variant=\"ghost\"\r\n                onClick={() => openViewCar(car)}\r\n              >\r\n                <Eye className=\"w-4 h-4\" />\r\n              </Button>\r\n\r\n              <Button\r\n                size=\"icon\"\r\n                variant=\"ghost\"\r\n                onClick={() => openEditCar(car)}\r\n              >\r\n                <Edit className=\"w-4 h-4\" />\r\n              </Button>\r\n\r\n              <Button\r\n                size=\"icon\"\r\n                variant=\"ghost\"\r\n                onClick={() =>\r\n                  showConfirmDialog(\r\n                    \"Delete Car\",\r\n                    \"Are you sure you want to delete this car?\",\r\n                    () => deleteCar(car.id)\r\n                  )\r\n                }\r\n              >\r\n                <Trash2 className=\"w-4 h-4 text-red-500\" />\r\n              </Button>\r\n            </div>\r\n\r\n            {!car.car_accepted ? (\r\n              <Button\r\n                size=\"sm\"\r\n                className=\"h-7 text-xs\"\r\n                onClick={() => acceptCar(car)}\r\n              >\r\n                Accept\r\n              </Button>\r\n            ) : (\r\n              <Button\r\n                size=\"sm\"\r\n                variant=\"outline\"\r\n                className=\"h-7 text-xs\"\r\n                onClick={() => rejectCar(car)}\r\n              >\r\n                Reject\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n\r\n    {/* EMPTY */}\r\n    {filteredCars.length === 0 && (\r\n      <div className=\"text-center text-muted-foreground mt-10\">\r\n        No cars found\r\n      </div>\r\n    )}\r\n\r\n    {/* PAGINATION */}\r\n    {/* SERVER PAGINATION */}\r\n{meta.last_page > 1 && (\r\n  <div className=\"flex flex-col items-center gap-3 mt-10\">\r\n\r\n    <div className=\"text-sm text-muted-foreground\">\r\n      Showing page <span className=\"font-semibold text-foreground\">\r\n        {meta.current_page}\r\n      </span>{\" \"}\r\n      of <span className=\"font-semibold text-foreground\">\r\n        {meta.last_page}\r\n      </span>{\" \"}\r\n      ({meta.total} cars)\r\n    </div>\r\n\r\n    <div className=\"flex items-center gap-2 flex-wrap justify-center\">\r\n\r\n      {/* PREVIOUS */}\r\n      <Button\r\n        variant=\"outline\"\r\n        size=\"sm\"\r\n        disabled={meta.current_page <= 1}\r\n        onClick={() => setPage((p) => p - 1)}\r\n      >\r\n        <ChevronLeft size={16} />\r\n      </Button>\r\n\r\n      {/* PAGE NUMBERS */}\r\n      {Array.from(\r\n        { length: meta.last_page },\r\n        (_, i) => i + 1\r\n      )\r\n        .filter(\r\n          (p) =>\r\n            p === 1 ||\r\n            p === meta.last_page ||\r\n            Math.abs(p - meta.current_page) <= 2\r\n        )\r\n        .map((p, index, arr) => (\r\n          <Button\r\n            key={p}\r\n            size=\"sm\"\r\n            variant={p === meta.current_page ? \"default\" : \"outline\"}\r\n            onClick={() => setPage(p)}\r\n          >\r\n            {p}\r\n          </Button>\r\n        ))}\r\n\r\n      {/* NEXT */}\r\n      <Button\r\n        variant=\"outline\"\r\n        size=\"sm\"\r\n        disabled={meta.current_page >= meta.last_page}\r\n        onClick={() => setPage((p) => p + 1)}\r\n      >\r\n        <ChevronRight size={16} />\r\n      </Button>\r\n\r\n    </div>\r\n  </div>\r\n)}\r\n\r\n  </>\r\n)}\r\n\r\n      <Dialog open={modalOpen} onOpenChange={setModalOpen}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>\r\n              {modalType === \"view-car\" ? \"Car Details\" : \"Edit Car\"}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n\r\n          {!selectedItem ? (\r\n            <p className=\"text-muted-foreground\">Loading...</p>\r\n          ) : modalType === \"view-car\" ? (\r\n            <CarDetailsView\r\n              car={selectedItem}\r\n              imgUrl={imgUrl}\r\n              getStorageUrl={getStorageUrl}\r\n              onEdit={() => {\r\n                setEditingCar({ ...selectedItem });\r\n                setModalType(\"edit-car\");\r\n              }}\r\n              onClose={() => setModalOpen(false)}\r\n              onAccept={() => acceptCar(selectedItem)}\r\n              onReject={() => rejectCar(selectedItem)}\r\n            />\r\n          ) : (\r\n            editingCar && (\r\n              <EditCarView\r\n                car={editingCar}\r\n                setCar={setEditingCar}\r\n                imgUrl={imgUrl}\r\n                onClose={() => setModalType(\"view-car\")}\r\n                onSaved={(updated) => {\r\n                  setSelectedItem(updated);\r\n                  setEditingCar({ ...updated });\r\n                  setModalType(\"view-car\");\r\n                }}\r\n              />\r\n            )\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminCarsPage;\r\n\r\n// Start Tony Update\r\nfunction carTooltip(car) {\r\n  return [\r\n    `Car ID: ${car.id ?? \"N/A\"}`,\r\n    `Agent ID : ${car.agent_id ?? \"N/A\"}`,\r\n    `Status: ${car.status ?? \"N/A\"}`,\r\n    `year: ${car.year ?? \"N/A\"}`,\r\n    `Car_category: ${car.car_category ?? \"N/A\"}`,\r\n    `Color: ${car.color ?? \"N/A\"}`,\r\n    `Seats: ${car.seats ?? \"N/A\"}`,\r\n    `Doors: ${car.doors ?? \"N/A\"}`,\r\n    `Cylinder number: ${car.cylinder_number ?? \"N/A\"}`,\r\n    `Transmission: ${car.transmission ?? \"N/A\"}`,\r\n    `wheels drive: ${car.wheels_drive ?? \"N/A\"}`,\r\n    `Daily rate: ${car.daily_rate ?? \"N/A\"}`,\r\n    `License plate: ${car.license_plate ?? \"N/A\"}`,\r\n  ].join(\"\\n\");\r\n}\r\nexport async function openCarView(\r\n  id,\r\n  fetchCarDetails,\r\n  setSelectedItem,\r\n  setModalType,\r\n  setModalOpen,\r\n) {\r\n  const fullDetails = await fetchCarDetails(id);\r\n  if (fullDetails) {\r\n    setSelectedItem(fullDetails);\r\n    setModalType(\"view-car\");\r\n    setModalOpen(true);\r\n  }\r\n}\r\n\r\nfunction agentTooltip(car) {\r\n  const agent = car?.agent;\r\n  if (!agent) return \"No agent\";\r\n  return [\r\n    `ID : ${agent.id ?? \"N/A\"}`,\r\n    `Phone number : ${agent.phone_number ?? \"N/A\"}`,\r\n    `Email : ${agent.email ?? \"N/A\"}`,\r\n    `Verified by admin : ${agent.verified_by_admin ?? \"N/A\"}`,\r\n    `Gender : ${agent.gender ?? \"N/A\"}`,\r\n    `Birth date : ${formatDateOnly(agent.birth_date ?? \"N/A\")}`,\r\n    `City : ${agent.city ?? \"N/A\"}`,\r\n    `Bio : ${agent.bio ?? \"N/A\"}`,\r\n    `Created at : ${formatDateTime(agent.created_at ?? \"N/A\")}`,\r\n    `Updated at : ${formatDateTime(agent.updated_at ?? \"N/A\")}`,\r\n  ].join(\"\\n\");\r\n}\r\n\r\nfunction formatDateOnly(value) {\r\n  if (!value) return \"N/A\";\r\n  const d = new Date(value);\r\n  if (Number.isNaN(d.getTime())) return String(value);\r\n  return d.toLocaleDateString(\"en-US\", {\r\n    month: \"numeric\",\r\n    day: \"numeric\",\r\n    year: \"numeric\",\r\n  });\r\n}\r\n\r\nfunction formatDateTime(value) {\r\n  if (!value) return \"N/A\";\r\n  const d = new Date(value);\r\n  if (Number.isNaN(d.getTime())) return String(value);\r\n\r\n  return d.toLocaleString(\"en-US\", {\r\n    timeZone: \"Asia/Beirut\",\r\n    month: \"numeric\",\r\n    day: \"numeric\",\r\n    year: \"numeric\",\r\n    hour: \"numeric\",\r\n    minute: \"2-digit\",\r\n    second: \"2-digit\",\r\n    hour12: true,\r\n  });\r\n}\r\n\r\nfunction RelatedSection({ title, items, renderItem }) {\r\n  const list = Array.isArray(items) ? items : [];\r\n  if (list.length === 0) return null;\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      <div className=\"text-sm font-semibold\">{title} ({list.length})</div>\r\n      <ul className=\"text-sm text-muted-foreground list-disc list-inside space-y-0.5 max-h-24 overflow-y-auto\">\r\n        {list.slice(0, 10).map((item, idx) => (\r\n          <li key={item?.id ?? idx}>{renderItem(item)}</li>\r\n        ))}\r\n        {list.length > 10 && <li>â€¦ and {list.length - 10} more</li>}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction CarDetailsView({\r\n  car,\r\n  imgUrl,\r\n  getStorageUrl,\r\n  onEdit,\r\n  onClose,\r\n  onAccept,\r\n  onReject,\r\n}) {\r\n  const agent = car?.agent || null;\r\n\r\n  const money = (v) => {\r\n    if (!v) return \"N/A\";\r\n    const n = Number(v);\r\n    if (Number.isNaN(n)) return v;\r\n    return `$${n.toFixed(2)}`;\r\n  };\r\n\r\n  const InfoItem = ({ label, value }) => (\r\n    <div className=\"flex flex-col\">\r\n      <span className=\"text-xs text-muted-foreground uppercase tracking-wide\">\r\n        {label}\r\n      </span>\r\n      <span className=\"text-sm font-medium text-foreground\">\r\n        {value ?? \"N/A\"}\r\n      </span>\r\n    </div>\r\n  );\r\n\r\n  const YesNoBadge = ({ value }) =>\r\n    value ? (\r\n      <Badge className=\"bg-green-500/20 text-green-700 border-green-500/40\">\r\n        Yes\r\n      </Badge>\r\n    ) : (\r\n      <Badge className=\"bg-red-500/20 text-red-700 border-red-500/40\">\r\n        No\r\n      </Badge>\r\n    );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n\r\n      {/* HERO SECTION */}\r\n      <div className=\"relative rounded-xl overflow-hidden border\">\r\n        <img\r\n          src={imgUrl(car.main_image_url)}\r\n          alt={car.make}\r\n          className=\"w-full h-[260px] object-cover\"\r\n        />\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent\" />\r\n\r\n        <div className=\"absolute bottom-4 left-6 text-white\">\r\n          <h2 className=\"text-2xl font-bold\">\r\n            {car.make} {car.model}\r\n          </h2>\r\n          <div className=\"flex gap-2 mt-2\">\r\n            <Badge className=\"bg-white/20 backdrop-blur text-white\">\r\n              {car.car_category}\r\n            </Badge>\r\n            {car.car_accepted ? (\r\n              <Badge className=\"bg-green-600\">Accepted</Badge>\r\n            ) : (\r\n              <Badge className=\"bg-red-600\">Rejected</Badge>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* MAIN DETAILS GRID */}\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 p-4 rounded-xl border bg-background shadow-sm\">\r\n        <InfoItem label=\"Year\" value={car.year} />\r\n        <InfoItem label=\"Color\" value={car.color} />\r\n        <InfoItem label=\"Transmission\" value={car.transmission} />\r\n        <InfoItem label=\"Fuel Type\" value={car.fuel_type} />\r\n        <InfoItem label=\"Seats\" value={car.seats} />\r\n        <InfoItem label=\"Doors\" value={car.doors} />\r\n        <InfoItem label=\"Daily Rate\" value={money(car.daily_rate)} />\r\n        <InfoItem label=\"Status\" value={car.status} />\r\n      </div>\r\n\r\n      {/* EXTRA INFO */}\r\n      <div className=\"grid md:grid-cols-2 gap-6\">\r\n\r\n        {/* Car Info Card */}\r\n        <div className=\"rounded-xl border p-4 space-y-3 bg-background shadow-sm\">\r\n          <h3 className=\"font-semibold text-lg\">Car Information</h3>\r\n          <InfoItem label=\"License Plate\" value={car.license_plate} />\r\n          <InfoItem label=\"Mileage\" value={car.mileage} />\r\n          <InfoItem label=\"Cylinder\" value={car.cylinder_number} />\r\n          <InfoItem label=\"Min Rental Days\" value={car.min_rental_days} />\r\n          <div className=\"flex gap-4 pt-2\">\r\n            <div>\r\n              <span className=\"text-xs text-muted-foreground\">Accepted</span>\r\n              <YesNoBadge value={car.car_accepted} />\r\n            </div>\r\n            <div>\r\n              <span className=\"text-xs text-muted-foreground\">Private</span>\r\n              <YesNoBadge value={car.is_private} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Agent Card */}\r\n        <div className=\"rounded-xl border p-4 space-y-3 bg-background shadow-sm\">\r\n          <h3 className=\"font-semibold text-lg\">Agent</h3>\r\n          <InfoItem label=\"Username\" value={agent?.username} />\r\n          <InfoItem label=\"Phone\" value={agent?.phone_number} />\r\n          <InfoItem label=\"Email\" value={agent?.email} />\r\n          <InfoItem label=\"City\" value={agent?.city} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* FEATURES */}\r\n      {car.features?.length > 0 && (\r\n        <div className=\"rounded-xl border p-4 bg-background shadow-sm\">\r\n          <h3 className=\"font-semibold mb-3\">Features</h3>\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            {car.features.map((f, i) => (\r\n              <Badge key={i} variant=\"outline\">\r\n                {typeof f === \"string\" ? f : f.name}\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* NOTES */}\r\n      {car.notes && (\r\n        <div className=\"rounded-xl border p-4 bg-background shadow-sm\">\r\n          <h3 className=\"font-semibold mb-2\">Notes</h3>\r\n          <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\r\n            {car.notes}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* ACTIONS */}\r\n      <div className=\"flex gap-3 pt-4\">\r\n        {!car.car_accepted && (\r\n          <Button\r\n            className=\"bg-green-600 hover:bg-green-700\"\r\n            onClick={onAccept}\r\n          >\r\n            Accept Car\r\n          </Button>\r\n        )}\r\n\r\n        {car.car_accepted && (\r\n          <Button\r\n            variant=\"destructive\"\r\n            onClick={onReject}\r\n          >\r\n            Reject Car\r\n          </Button>\r\n        )}\r\n\r\n        <Button className=\"flex-1\" onClick={onEdit}>\r\n          Edit Car\r\n        </Button>\r\n\r\n        <Button variant=\"outline\" onClick={onClose}>\r\n          Close\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst IMAGE_TYPES = [\r\n  { type: \"main\", label: \"Main\", fullKey: \"main_image_full_url\", pathKey: \"main_image_url\" },\r\n  { type: \"front\", label: \"Front\", fullKey: \"front_image_full_url\", pathKey: \"front_image_url\" },\r\n  { type: \"back\", label: \"Back\", fullKey: \"back_image_full_url\", pathKey: \"back_image_url\" },\r\n  { type: \"left\", label: \"Left\", fullKey: \"left_image_full_url\", pathKey: \"left_image_url\" },\r\n  { type: \"right\", label: \"Right\", fullKey: \"right_image_full_url\", pathKey: \"right_image_url\" },\r\n];\r\n\r\n// Stable row components (defined outside EditCarView so they don't remount on every render and steal focus)\r\nfunction EditInputRow({ label, type = \"text\", disabled = false, value = \"\", onChange }) {\r\n  const handleChange = (e) => {\r\n    const v = e.target.value;\r\n    onChange(type === \"number\" ? (v === \"\" ? \"\" : Number(v)) : v);\r\n  };\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      <div className=\"text-xs text-muted-foreground\">{label}</div>\r\n      <Input type={type} value={value} onChange={handleChange} disabled={disabled} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction EditSelectRow({ label, options, emptySentinel, value = \"\", onValueChange }) {\r\n  const displayValue = emptySentinel ? (value ?? \"\") || emptySentinel : String(value ?? \"\");\r\n  const handleSelect = (v) => onValueChange(emptySentinel && v === emptySentinel ? \"\" : v);\r\n  return (\r\n    <div className=\"space-y-1\">\r\n      <div className=\"text-xs text-muted-foreground\">{label}</div>\r\n      <Select value={displayValue} onValueChange={handleSelect}>\r\n        <SelectTrigger>\r\n          <SelectValue placeholder=\"Select...\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          {options.map((op) => {\r\n            const val = op.value === \"\" || op.value == null ? (emptySentinel || \"__none__\") : String(op.value);\r\n            return (\r\n              <SelectItem key={val} value={val}>\r\n                {op.label}\r\n              </SelectItem>\r\n            );\r\n          })}\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction EditToggleRow({ label, value, onChange }) {\r\n  return (\r\n    <div className=\"flex items-center justify-between gap-3 py-2\">\r\n      <div className=\"text-sm\">{label}</div>\r\n      <button\r\n        type=\"button\"\r\n        role=\"switch\"\r\n        aria-checked={!!value}\r\n        onClick={() => onChange(!value)}\r\n        className={[\r\n          \"relative inline-flex h-5 w-10 items-center rounded-full transition-colors\",\r\n          value ? \"bg-teal-600\" : \"bg-muted\",\r\n          \"focus:outline-none focus:ring-2 focus:ring-teal-500/40\",\r\n        ].join(\" \")}\r\n      >\r\n        <span\r\n          className={[\r\n            \"inline-block h-4 w-4 transform rounded-full bg-white transition-transform\",\r\n            value ? \"translate-x-5\" : \"translate-x-1\",\r\n            \"shadow\",\r\n          ].join(\" \")}\r\n        />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction AdminEditLocationSection({ car, setVal }) {\r\n  const { toast } = useToast();\r\n  const [googleLink, setGoogleLink] = useState(\"\");\r\n  const [showMapModal, setShowMapModal] = useState(false);\r\n  const [tempMapLocation, setTempMapLocation] = useState(null);\r\n\r\n  const loc = car?.live_location || { address: \"\", latitude: 0, longitude: 0 };\r\n  const hasLocation = loc.latitude && loc.longitude && (Number(loc.latitude) !== 0 || Number(loc.longitude) !== 0);\r\n\r\n  const updateLoc = (updates) => setVal(\"live_location\", { ...loc, ...updates });\r\n\r\n  const applyGoogleLink = () => {\r\n    const coords = parseGoogleMapsLink(googleLink);\r\n    if (coords) {\r\n      updateLoc({ latitude: coords.lat, longitude: coords.lng });\r\n      toast({ title: \"Coordinates applied\" });\r\n    } else {\r\n      toast({ title: \"Could not parse link\", description: \"Paste a valid Google Maps URL with coordinates\", variant: \"destructive\" });\r\n    }\r\n  };\r\n\r\n  const useCurrentLocation = () => {\r\n    if (!navigator.geolocation) {\r\n      toast({ title: \"Geolocation not supported\", variant: \"destructive\" });\r\n      return;\r\n    }\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos) => {\r\n        updateLoc({ latitude: pos.coords.latitude, longitude: pos.coords.longitude });\r\n        toast({ title: \"Current location set\" });\r\n      },\r\n      () => toast({ title: \"Could not get location\", variant: \"destructive\" })\r\n    );\r\n  };\r\n\r\n  const useOfficeLocation = () => {\r\n    const agentLoc = car?.agent?.location;\r\n    if (agentLoc && (agentLoc.lat != null || agentLoc.latitude != null)) {\r\n      const lat = agentLoc.latitude ?? agentLoc.lat ?? 33.8547;\r\n      const lng = agentLoc.longitude ?? agentLoc.lng ?? 35.8623;\r\n      updateLoc({ latitude: lat, longitude: lng });\r\n      toast({ title: \"Office location set\" });\r\n    } else {\r\n      toast({ title: \"No office location\", description: \"Car agent has no location set\", variant: \"destructive\" });\r\n    }\r\n  };\r\n\r\n  const openMapPicker = () => {\r\n    setTempMapLocation({ latitude: loc.latitude || 33.8547, longitude: loc.longitude || 35.8623 });\r\n    setShowMapModal(true);\r\n  };\r\n\r\n  const confirmMapLocation = () => {\r\n    if (tempMapLocation) {\r\n      updateLoc({ latitude: tempMapLocation.latitude, longitude: tempMapLocation.longitude });\r\n      toast({ title: \"Location set from map\" });\r\n    }\r\n    setShowMapModal(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      <div className=\"text-sm font-semibold flex items-center gap-2\">\r\n        <MapPin className=\"w-4 h-4\" />\r\n        Location &amp; Address (same as Add Car)\r\n      </div>\r\n      <div className=\"space-y-4 p-4 rounded-lg border bg-muted/30\">\r\n        <div>\r\n          <div className=\"text-xs text-muted-foreground mb-1\">Address (region)</div>\r\n          <Select\r\n            value={loc.address || \"__empty__\"}\r\n            onValueChange={(v) => updateLoc({ address: v === \"__empty__\" ? \"\" : v })}\r\n          >\r\n            <SelectTrigger>\r\n              <SelectValue placeholder=\"Select region...\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"__empty__\">Select region...</SelectItem>\r\n              {ADDRESS_OPTIONS.filter((o) => o.value).map((o) => (\r\n                <SelectItem key={o.value} value={o.value}>{o.label}</SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n        <div>\r\n          <div className=\"text-xs text-muted-foreground mb-1\">Paste Google Maps link (to set coordinates)</div>\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              placeholder=\"e.g. https://www.google.com/maps/@33.89,35.50 or maps.app.goo.gl/...\"\r\n              value={googleLink}\r\n              onChange={(e) => setGoogleLink(e.target.value)}\r\n              className=\"flex-1\"\r\n            />\r\n            <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={applyGoogleLink}>\r\n              Apply\r\n            </Button>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={useCurrentLocation}>\r\n            <Navigation className=\"w-4 h-4 mr-2\" />\r\n            Use Current Location\r\n          </Button>\r\n          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={openMapPicker}>\r\n            <MapPin className=\"w-4 h-4 mr-2\" />\r\n            Select on Map\r\n          </Button>\r\n          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={useOfficeLocation}>\r\n            <Building2 className=\"w-4 h-4 mr-2\" />\r\n            Office location\r\n          </Button>\r\n        </div>\r\n        {hasLocation ? (\r\n          <div className=\"text-sm text-muted-foreground\">\r\n            Location set: Lat {loc.latitude} â€¢ Lng {loc.longitude}\r\n          </div>\r\n        ) : (\r\n          <div className=\"text-xs text-muted-foreground\">No coordinates set yet.</div>\r\n        )}\r\n      </div>\r\n\r\n      <Dialog open={showMapModal} onOpenChange={setShowMapModal}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Select location on map</DialogTitle>\r\n          </DialogHeader>\r\n          {tempMapLocation && (\r\n            <AdminLocationMap\r\n              center={tempMapLocation}\r\n              selectedLocation={tempMapLocation}\r\n              onLocationSelect={(lat, lng) => setTempMapLocation({ latitude: lat, longitude: lng })}\r\n            />\r\n          )}\r\n          <div className=\"flex gap-2 justify-end\">\r\n            <Button variant=\"outline\" onClick={() => setShowMapModal(false)}>Cancel</Button>\r\n            <Button onClick={confirmMapLocation}>Confirm</Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction AdminLocationMap({ center, selectedLocation, onLocationSelect }) {\r\n  const mapRef = React.useRef(null);\r\n  const markerRef = React.useRef(null);\r\n  const mapId = \"admin-edit-car-location-map\";\r\n  React.useEffect(() => {\r\n    if (!window.L || mapRef.current) return;\r\n    const lat = parseFloat(center?.latitude) || 33.8547;\r\n    const lng = parseFloat(center?.longitude) || 35.8623;\r\n    const map = window.L.map(mapId).setView([lat, lng], 13);\r\n    window.L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", { attribution: \"Â© OpenStreetMap\" }).addTo(map);\r\n    const marker = window.L.marker([lat, lng], { draggable: true }).addTo(map);\r\n    marker.on(\"dragend\", (e) => {\r\n      const pos = e.target.getLatLng();\r\n      onLocationSelect(pos.lat, pos.lng);\r\n    });\r\n    map.on(\"click\", (e) => {\r\n      marker.setLatLng(e.latlng);\r\n      onLocationSelect(e.latlng.lat, e.latlng.lng);\r\n    });\r\n    mapRef.current = map;\r\n    markerRef.current = marker;\r\n  }, []);\r\n  return <div id={mapId} className=\"w-full h-[300px] rounded-md\" />;\r\n}\r\n\r\nfunction EditCarView({ car, setCar, imgUrl, onClose, onSaved }) {\r\n  const { toast } = useToast();\r\n  const [replacing, setReplacing] = useState(null);\r\n  const fileInputRefs = React.useRef({});\r\n\r\n  const setVal = (key, value) => setCar((p) => ({ ...p, [key]: value }));\r\n\r\n  const displayUrl = (fullUrlKey, pathKey) => {\r\n    const full = car?.[fullUrlKey];\r\n    if (full) return full;\r\n    return imgUrl(car?.[pathKey]);\r\n  };\r\n\r\n  const handleReplaceImage = async (imageType, file) => {\r\n    if (!file || !car?.id) return;\r\n    setReplacing(imageType);\r\n    try {\r\n      const res = await updateCarPhoto(car.id, file, imageType);\r\n      const data = res.data || res;\r\n      const updated = data?.car ?? data ?? car;\r\n      setCar(updated);\r\n      toast({ title: \"Image updated\", description: `${imageType} image replaced successfully` });\r\n    } catch (e) {\r\n      const msg = e.response?.data?.errors?.image?.[0] || e.response?.data?.message || \"Failed to replace image\";\r\n      toast({ title: \"Error\", description: msg, variant: \"destructive\" });\r\n    } finally {\r\n      setReplacing(null);\r\n      if (fileInputRefs.current[imageType]) fileInputRefs.current[imageType].value = \"\";\r\n    }\r\n  };\r\n\r\n  const money = (v) => {\r\n    if (v === null || v === undefined || v === \"\") return \"\";\r\n    const n = Number(v);\r\n    if (Number.isNaN(n)) return v;\r\n    return n;\r\n  };\r\n\r\n  const listToBadges = (arr) => {\r\n    if (!Array.isArray(arr) || arr.length === 0)\r\n      return <div className=\"text-sm text-muted-foreground\">N/A</div>;\r\n\r\n    return (\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        {arr.map((x, idx) => (\r\n          <Badge key={idx} variant=\"outline\">\r\n            {typeof x === \"string\" ? x : (x?.name ?? JSON.stringify(x))}\r\n          </Badge>\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const save = async () => {\r\n    try {\r\n      const payload = {\r\n        make: car.make,\r\n        model: car.model,\r\n        year: car.year,\r\n        cylinder_number: car.cylinder_number === \"__none__\" || car.cylinder_number === \"\" ? undefined : car.cylinder_number,\r\n        license_plate: car.license_plate,\r\n        color: car.color,\r\n        mileage: car.mileage,\r\n        fuel_type: car.fuel_type,\r\n        transmission: car.transmission,\r\n        wheels_drive: car.wheels_drive,\r\n        car_category: car.car_category,\r\n        seats: car.seats,\r\n        doors: car.doors,\r\n        daily_rate: money(car.daily_rate),\r\n        holiday_rate: money(car.holiday_rate),\r\n        is_deposit: !!car.is_deposit,\r\n        deposit: money(car.deposit),\r\n        status: car.status,\r\n        car_accepted: !!car.car_accepted,\r\n        is_private: !!car.is_private,\r\n        is_delivered: !!car.is_delivered,\r\n        delivery_fees: money(car.delivery_fees),\r\n        with_driver: !!car.with_driver,\r\n        driver_fees: money(car.driver_fees),\r\n        max_driving_mileage: car.max_driving_mileage != null && car.max_driving_mileage !== \"\" ? Number(car.max_driving_mileage) : undefined,\r\n        min_rental_days: car.min_rental_days,\r\n        notes: car.notes,\r\n        agent_id: car.agent_id != null && car.agent_id !== \"\" ? Number(car.agent_id) : undefined,\r\n        insurance_expiry: car.insurance_expiry || undefined,\r\n        registration_expiry: car.registration_expiry || undefined,\r\n        views_count: car.views_count != null && car.views_count !== \"\" ? Number(car.views_count) : undefined,\r\n        clicks_count: car.clicks_count != null && car.clicks_count !== \"\" ? Number(car.clicks_count) : undefined,\r\n        search_count: car.search_count != null && car.search_count !== \"\" ? Number(car.search_count) : undefined,\r\n      };\r\n      const loc = car?.live_location;\r\n      const locAddr = loc?.address ?? \"\";\r\n      const locLat = loc?.latitude ?? loc?.lat ?? \"\";\r\n      const locLng = loc?.longitude ?? loc?.lng ?? \"\";\r\n      if (locAddr || (locLat !== \"\" && locLng !== \"\")) {\r\n        payload.live_location = {\r\n          address: String(locAddr || \"\"),\r\n          latitude: locLat !== \"\" ? Number(locLat) : 0,\r\n          longitude: locLng !== \"\" ? Number(locLng) : 0,\r\n        };\r\n      }\r\n      const res = await updateCar(car.id, payload);\r\n      const data = res.data || res;\r\n      const updated = data?.car ?? data ?? car;\r\n      toast({ title: \"Saved\", description: \"Car updated successfully\" });\r\n      onSaved?.(updated);\r\n    } catch (e) {\r\n      if (e.response?.status === 422 && e.response?.data?.errors) {\r\n        const msg = Object.entries(e.response.data.errors).map(([k, v]) => `${k}: ${(v || []).join(\", \")}`).join(\"; \");\r\n        toast({ title: \"Validation Error\", description: msg || \"Invalid data\", variant: \"destructive\" });\r\n      } else {\r\n        toast({ title: \"Error\", description: \"Failed to update car\", variant: \"destructive\" });\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-10 gap-y-3\">\r\n        <EditInputRow label=\"ID\" value={car?.id ?? \"\"} onChange={() => {}} disabled />\r\n        <EditInputRow label=\"Make\" value={car?.make ?? \"\"} onChange={(v) => setVal(\"make\", v)} />\r\n        <EditInputRow label=\"Model\" value={car?.model ?? \"\"} onChange={(v) => setVal(\"model\", v)} />\r\n        <EditInputRow label=\"Year\" value={car?.year ?? \"\"} onChange={(v) => setVal(\"year\", v)} type=\"number\" />\r\n        <EditSelectRow label=\"Cylinder\" value={car?.cylinder_number ?? \"\"} onValueChange={(v) => setVal(\"cylinder_number\", v)} emptySentinel=\"__none__\" options={[{ label: \"â€”\", value: \"\" }, { label: \"4\", value: \"4\" }, { label: \"6\", value: \"6\" }, { label: \"8\", value: \"8\" }, { label: \"10\", value: \"10\" }, { label: \"12\", value: \"12\" }]} />\r\n\r\n        <EditInputRow label=\"License Plate\" value={car?.license_plate ?? \"\"} onChange={(v) => setVal(\"license_plate\", v)} />\r\n        <EditInputRow label=\"Color\" value={car?.color ?? \"\"} onChange={(v) => setVal(\"color\", v)} />\r\n\r\n        <EditInputRow label=\"Mileage\" value={car?.mileage ?? \"\"} onChange={(v) => setVal(\"mileage\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Fuel Type\" value={car?.fuel_type ?? \"\"} onChange={(v) => setVal(\"fuel_type\", v)} />\r\n\r\n        <EditInputRow label=\"Transmission\" value={car?.transmission ?? \"\"} onChange={(v) => setVal(\"transmission\", v)} />\r\n        <EditInputRow label=\"Wheels Drive\" value={car?.wheels_drive ?? \"\"} onChange={(v) => setVal(\"wheels_drive\", v)} />\r\n\r\n        <EditSelectRow label=\"Category\" value={car?.car_category ?? \"\"} onValueChange={(v) => setVal(\"car_category\", v)} emptySentinel=\"__none__\" options={[{ label: \"â€”\", value: \"\" }, { label: \"Sedan\", value: \"Sedan\" }, { label: \"Hatchback\", value: \"Hatchback\" }, { label: \"Coupe\", value: \"Coupe\" }, { label: \"SUV\", value: \"SUV\" }, { label: \"Crossover\", value: \"Crossover\" }, { label: \"Wagon\", value: \"Wagon\" }, { label: \"Pickup\", value: \"Pickup\" }, { label: \"Minivan\", value: \"Minivan\" }, { label: \"Convertible\", value: \"Convertible\" }]} />\r\n\r\n        <EditInputRow label=\"Seats\" value={car?.seats ?? \"\"} onChange={(v) => setVal(\"seats\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Doors\" value={car?.doors ?? \"\"} onChange={(v) => setVal(\"doors\", v)} type=\"number\" />\r\n\r\n        <EditInputRow label=\"Daily Rate\" value={car?.daily_rate ?? \"\"} onChange={(v) => setVal(\"daily_rate\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Holiday Rate\" value={car?.holiday_rate ?? \"\"} onChange={(v) => setVal(\"holiday_rate\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Deposit\" value={car?.deposit ?? \"\"} onChange={(v) => setVal(\"deposit\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Delivery Fees\" value={car?.delivery_fees ?? \"\"} onChange={(v) => setVal(\"delivery_fees\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Driver Fees\" value={car?.driver_fees ?? \"\"} onChange={(v) => setVal(\"driver_fees\", v)} type=\"number\" />\r\n\r\n        <EditInputRow label=\"Min Rental Days\" value={car?.min_rental_days ?? \"\"} onChange={(v) => setVal(\"min_rental_days\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Max Driving Mileage\" value={car?.max_driving_mileage ?? \"\"} onChange={(v) => setVal(\"max_driving_mileage\", v)} type=\"number\" />\r\n\r\n        <EditInputRow label=\"Agent ID (reassign owner)\" value={car?.agent_id ?? \"\"} onChange={(v) => setVal(\"agent_id\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Insurance Expiry\" value={car?.insurance_expiry ?? \"\"} onChange={(v) => setVal(\"insurance_expiry\", v)} type=\"date\" />\r\n        <EditInputRow label=\"Registration Expiry\" value={car?.registration_expiry ?? \"\"} onChange={(v) => setVal(\"registration_expiry\", v)} type=\"date\" />\r\n\r\n        <EditInputRow label=\"Views Count\" value={car?.views_count ?? \"\"} onChange={(v) => setVal(\"views_count\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Clicks Count\" value={car?.clicks_count ?? \"\"} onChange={(v) => setVal(\"clicks_count\", v)} type=\"number\" />\r\n        <EditInputRow label=\"Search Count\" value={car?.search_count ?? \"\"} onChange={(v) => setVal(\"search_count\", v)} type=\"number\" />\r\n      </div>\r\n\r\n      <div className=\"border-t pt-3\" />\r\n      <AdminEditLocationSection car={car} setVal={setVal} />\r\n\r\n      <div className=\"border-t pt-3\" />\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"text-sm font-semibold\">Features</div>\r\n        {listToBadges(car?.features)}\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <div className=\"text-sm font-semibold\">Add-ons</div>\r\n        {listToBadges(car?.add_ons)}\r\n      </div>\r\n\r\n      <div className=\"border-t pt-3\" />\r\n\r\n      <div className=\"space-y-3\">\r\n        <div className=\"text-sm font-semibold\">Car Images</div>\r\n\r\n        <div className=\"space-y-1\">\r\n          <div className=\"flex items-center justify-between gap-2\">\r\n            <span className=\"text-muted-foreground\">Main</span>\r\n            <div className=\"flex items-center gap-1\">\r\n              <input\r\n                ref={(el) => (fileInputRefs.current.main = el)}\r\n                type=\"file\"\r\n                accept=\"image/jpeg,image/jpg,image/png\"\r\n                className=\"hidden\"\r\n                onChange={(e) => { const f = e.target.files?.[0]; if (f) handleReplaceImage(\"main\", f); }}\r\n              />\r\n              <Button type=\"button\" variant=\"outline\" size=\"sm\" disabled={replacing === \"main\"} onClick={() => fileInputRefs.current.main?.click()}>\r\n                {replacing === \"main\" ? \"Uploadingâ€¦\" : \"Replace\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n          <a href={displayUrl(\"main_image_full_url\", \"main_image_url\")} target=\"_blank\" rel=\"noreferrer\">\r\n            <img src={displayUrl(\"main_image_full_url\", \"main_image_url\")} alt=\"Main\" className=\"w-full max-h-[260px] object-cover rounded-md border\" />\r\n          </a>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\r\n          {IMAGE_TYPES.filter((t) => t.type !== \"main\").map(({ type, label, fullKey, pathKey }) => (\r\n            <div key={type} className=\"space-y-1\">\r\n              <div className=\"flex items-center justify-between gap-1\">\r\n                <span className=\"text-muted-foreground\">{label}</span>\r\n                <input\r\n                  ref={(el) => (fileInputRefs.current[type] = el)}\r\n                  type=\"file\"\r\n                  accept=\"image/jpeg,image/jpg,image/png\"\r\n                  className=\"hidden\"\r\n                  onChange={(e) => { const f = e.target.files?.[0]; if (f) handleReplaceImage(type, f); }}\r\n                />\r\n                <Button type=\"button\" variant=\"outline\" size=\"sm\" className=\"h-7 px-1\" disabled={replacing === type} onClick={() => fileInputRefs.current[type]?.click()}>\r\n                  {replacing === type ? \"â€¦\" : \"Replace\"}\r\n                </Button>\r\n              </div>\r\n              <a href={displayUrl(fullKey, pathKey)} target=\"_blank\" rel=\"noreferrer\">\r\n                <img src={displayUrl(fullKey, pathKey)} alt={label} className=\"h-[120px] w-full object-cover rounded-md border\" />\r\n              </a>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <EditSelectRow\r\n          label=\"Status\"\r\n          value={car?.status ?? \"\"}\r\n          onValueChange={(v) => setVal(\"status\", v)}\r\n          options={[\r\n            { label: \"Available\", value: \"available\" },\r\n            { label: \"Not Available\", value: \"not_available\" },\r\n            { label: \"Rented\", value: \"rented\" },\r\n            { label: \"Maintenance\", value: \"maintenance\" },\r\n          ]}\r\n        />\r\n\r\n        <div className=\"text-sm font-semibold\">Notes</div>\r\n        <textarea\r\n          className=\"w-full border rounded-md p-2 min-h-[90px]\"\r\n          value={car?.notes ?? \"\"}\r\n          onChange={(e) => setVal(\"notes\", e.target.value)}\r\n        />\r\n      </div>\r\n\r\n      <EditToggleRow label=\"Car Accepted\" value={car?.car_accepted} onChange={(v) => setVal(\"car_accepted\", v ? 1 : 0)} />\r\n      <EditToggleRow label=\"Is Private\" value={car?.is_private} onChange={(v) => setVal(\"is_private\", v ? 1 : 0)} />\r\n      <EditToggleRow label=\"Is Deposit\" value={car?.is_deposit} onChange={(v) => setVal(\"is_deposit\", v ? 1 : 0)} />\r\n      <EditToggleRow label=\"With Driver\" value={car?.with_driver} onChange={(v) => setVal(\"with_driver\", v ? 1 : 0)} />\r\n      <EditToggleRow label=\"Is Delivered\" value={car?.is_delivered} onChange={(v) => setVal(\"is_delivered\", v ? 1 : 0)} />\r\n\r\n      <div className=\"pt-3 flex gap-2\">\r\n        <Button className=\"flex-1\" onClick={save}>\r\n          Update Car\r\n        </Button>\r\n        <Button variant=\"outline\" className=\"w-28\" onClick={onClose}>\r\n          Cancel\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// End Tony Update"],"names":["PER_PAGE","ADDRESS_OPTIONS","parseGoogleMapsLink","url","trimmed","atMatch","qMatch","llMatch","lat","lng","STATUS_OPTIONS","CAR_ACCEPTED_OPTIONS","IS_PRIVATE_OPTIONS","AdminCarsPage","searchParams","useSearchParams","cars","setCars","useState","meta","setMeta","loading","setLoading","page","setPage","statusFilter","setStatusFilter","carAcceptedFilter","setCarAcceptedFilter","isPrivateFilter","setIsPrivateFilter","agentIdFilter","setAgentIdFilter","agents","setAgents","searchQuery","setSearchQuery","useEffect","agentId","res","getAgencies","data","err","categories","setCategories","status","setStatus","sort","setSort","showFilters","setShowFilters","selectedItem","setSelectedItem","modalOpen","setModalOpen","modalType","setModalType","toast","useToast","editingCar","setEditingCar","confirmDialog","setConfirmDialog","yearFrom","setYearFrom","yearTo","setYearTo","rateFrom","setRateFrom","rateTo","setRateTo","fetchCars","useCallback","params","getCars","list","pagination","m","fetchCarDetails","id","getCar","error","openViewCar","listCar","full","openEditCar","prev","FALLBACK_IMG","storageBase","useMemo","getStorageUrl","path","clean","imgUrl","showConfirmDialog","title","message","onConfirm","acceptCar","car","updateCarAcceptReject","updated","c","e","rejectCar","deleteCar","deleteCarApi","toNumber","v","cleaned","n","filteredCars","q","catLower","x","from","to","y","rFrom","rTo","rate","a","b","ar","br","ay","by","av","bv","jsxs","jsx","Search","Input","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","agent","op","Car","Button","p","Fragment","Badge","Eye","Edit","Trash2","ChevronLeft","_","i","index","arr","ChevronRight","Dialog","DialogContent","DialogHeader","DialogTitle","CarDetailsView","EditCarView","openCarView","fullDetails","onEdit","onClose","onAccept","onReject","money","InfoItem","label","value","YesNoBadge","f","IMAGE_TYPES","EditInputRow","type","disabled","onChange","handleChange","EditSelectRow","options","emptySentinel","onValueChange","displayValue","handleSelect","val","EditToggleRow","AdminEditLocationSection","setVal","googleLink","setGoogleLink","showMapModal","setShowMapModal","tempMapLocation","setTempMapLocation","loc","hasLocation","updateLoc","updates","applyGoogleLink","coords","useCurrentLocation","pos","useOfficeLocation","agentLoc","openMapPicker","confirmMapLocation","MapPin","o","Navigation","Building2","AdminLocationMap","center","selectedLocation","onLocationSelect","mapRef","React","markerRef","mapId","map","marker","setCar","onSaved","replacing","setReplacing","fileInputRefs","key","displayUrl","fullUrlKey","pathKey","handleReplaceImage","imageType","file","updateCarPhoto","msg","listToBadges","idx","save","payload","locAddr","locLat","locLng","updateCar","k","el","fullKey"],"mappings":"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"}